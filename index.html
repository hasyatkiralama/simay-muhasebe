<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simay YatÃ§Ä±lÄ±k â€” Muhasebe</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & ROOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0b1623;
  --bg2:#101f30;
  --bg3:#162436;
  --teal:#0b7a6e;
  --teal2:#18b4a2;
  --teal3:#a8ece6;
  --gold:#be8a20;
  --gold2:#e8b84b;
  --gold3:#f8e4a0;
  --green:#156b3a;
  --green2:#22c55e;
  --red:#b83030;
  --red2:#f87171;
  --blue:#1a4a7a;
  --blue2:#60a5fa;
  --ink:#c8daea;
  --ink2:#8aa0b4;
  --ink3:#4a6070;
  --border:rgba(255,255,255,0.065);
  --glass:rgba(255,255,255,0.03);
  --glass2:rgba(255,255,255,0.055);
  --shadow:0 4px 24px rgba(0,0,0,0.3);
}
html{font-size:13px;scroll-behavior:smooth}
body{
  background:var(--bg);
  color:var(--ink);
  font-family:'DM Sans',sans-serif;
  min-height:100vh;
  overflow-x:hidden;
}

/* BG ATMOSPHERE */
body::before{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 80% 60% at -5% -10%,rgba(11,122,110,0.18) 0%,transparent 55%),
    radial-gradient(ellipse 60% 50% at 105% 110%,rgba(26,74,122,0.15) 0%,transparent 55%),
    radial-gradient(ellipse 40% 40% at 50% 50%,rgba(190,138,32,0.04) 0%,transparent 70%);
}
body::after{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background-image:linear-gradient(rgba(255,255,255,0.008) 1px,transparent 1px),
                   linear-gradient(90deg,rgba(255,255,255,0.008) 1px,transparent 1px);
  background-size:48px 48px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app{display:flex;min-height:100vh;position:relative;z-index:1}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#sidebar{
  width:230px;flex-shrink:0;
  background:rgba(10,18,28,0.9);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;
  position:sticky;top:0;height:100vh;
  overflow-y:auto;
  backdrop-filter:blur(12px);
}
.sb-logo{
  padding:24px 20px 20px;
  border-bottom:1px solid var(--border);
}
.sb-logo-mark{
  display:flex;align-items:center;gap:10px;margin-bottom:4px;
}
.sb-icon{
  width:34px;height:34px;
  background:linear-gradient(135deg,var(--teal),var(--teal2));
  border-radius:9px;
  display:flex;align-items:center;justify-content:center;
  font-size:16px;
  box-shadow:0 2px 12px rgba(11,122,110,0.4);
}
.sb-name{
  font-family:'Cormorant Garamond',serif;
  font-size:19px;font-weight:700;color:#e0eaf4;letter-spacing:-0.3px;
}
.sb-tagline{font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--ink3);margin-top:2px}

.sb-nav{flex:1;padding:10px 0}
.sb-section{
  font-size:8px;letter-spacing:3px;text-transform:uppercase;
  color:var(--ink3);padding:12px 20px 5px;font-weight:600;
}
.sb-item{
  display:flex;align-items:center;gap:10px;
  padding:9px 20px;cursor:pointer;
  font-size:12px;font-weight:500;color:var(--ink2);
  border-left:2px solid transparent;
  transition:all .18s;letter-spacing:0.2px;
  user-select:none;
}
.sb-item:hover{color:var(--ink);background:var(--glass2);border-left-color:var(--teal)}
.sb-item.active{color:var(--teal2);background:rgba(11,122,110,0.1);border-left-color:var(--teal2)}
.sb-item .si{font-size:15px;width:18px;text-align:center;opacity:.85}
.sb-badge{
  margin-left:auto;background:rgba(11,122,110,0.2);
  color:var(--teal2);border-radius:10px;
  padding:1px 7px;font-size:10px;font-weight:600;
}

.sb-footer{
  padding:14px 16px;
  border-top:1px solid var(--border);
}
.sb-card{
  background:rgba(190,138,32,0.08);
  border:1px solid rgba(190,138,32,0.2);
  border-radius:10px;padding:12px 14px;
}
.sb-card-lbl{font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:5px}
.sb-card-val{font-family:'Cormorant Garamond',serif;font-size:24px;font-weight:700;color:var(--gold2);line-height:1}
.sb-card-sub{font-size:10px;color:var(--green2);margin-top:4px;font-weight:500}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#main{flex:1;overflow-y:auto;min-width:0}
.page{display:none;padding:30px 32px 60px;animation:fadeIn .25s ease}
.page.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ph{
  display:flex;align-items:flex-start;justify-content:space-between;
  margin-bottom:26px;gap:16px;flex-wrap:wrap;
}
.ph-left h2{
  font-family:'Cormorant Garamond',serif;
  font-size:30px;font-weight:700;color:#e4eef6;letter-spacing:-0.5px;line-height:1.1;
}
.ph-left p{font-size:11px;color:var(--ink2);margin-top:4px}
.ph-actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:9px 16px;border-radius:8px;
  font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;
  cursor:pointer;border:none;transition:all .18s;
  letter-spacing:0.3px;white-space:nowrap;
}
.btn:active{transform:scale(0.97)}
.btn-teal{background:linear-gradient(135deg,var(--teal),var(--teal2));color:#fff;box-shadow:0 2px 10px rgba(11,122,110,0.35)}
.btn-teal:hover{filter:brightness(1.1);box-shadow:0 3px 14px rgba(11,122,110,0.5)}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));color:#1a1200;box-shadow:0 2px 10px rgba(190,138,32,0.3)}
.btn-gold:hover{filter:brightness(1.08)}
.btn-ghost{background:var(--glass2);color:var(--ink2);border:1px solid var(--border)}
.btn-ghost:hover{background:rgba(255,255,255,0.07);color:var(--ink);border-color:rgba(255,255,255,0.12)}
.btn-danger{background:rgba(184,48,48,0.12);color:var(--red2);border:1px solid rgba(184,48,48,0.2)}
.btn-danger:hover{background:rgba(184,48,48,0.22)}
.btn-sm{padding:5px 11px;font-size:10px}
.btn-xs{padding:3px 8px;font-size:9px;border-radius:5px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KPI STRIP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
.kpi{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:12px;padding:16px 15px;
  position:relative;overflow:hidden;
  transition:border-color .2s,transform .2s;
}
.kpi:hover{border-color:rgba(255,255,255,0.12);transform:translateY(-1px)}
.kpi::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--ka,var(--teal2))}
.kpi-lbl{font-size:8px;letter-spacing:2.5px;text-transform:uppercase;color:var(--ink3);margin-bottom:7px}
.kpi-val{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:700;line-height:1;color:var(--kc,#e4eef6)}
.kpi-sub{font-size:10px;color:var(--ink2);margin-top:5px}
.kpi-icon{position:absolute;right:14px;top:14px;font-size:20px;opacity:.15}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panel{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:14px;padding:20px;
  margin-bottom:16px;
}
.panel-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;gap:12px}
.panel-title{font-family:'Cormorant Garamond',serif;font-size:19px;font-weight:700;color:#e4eef6;line-height:1.1}
.panel-sub{font-size:10px;color:var(--ink2);margin-top:3px}
.grid-2{display:grid;grid-template-columns:1.5fr 1fr;gap:16px;margin-bottom:16px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:16px}
.grid-2-eq{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS / RING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prog-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--ink2);margin-bottom:5px}
.prog-track{height:7px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden}
.prog-fill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--teal),var(--gold2));transition:width 1s cubic-bezier(.23,1,.32,1)}

.ring-outer{position:relative;width:110px;height:110px;flex-shrink:0}
.ring-outer svg{transform:rotate(-90deg)}
.ring-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.ring-pct{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:var(--gold2);line-height:1}
.ring-lbl2{font-size:8px;letter-spacing:1.5px;color:var(--ink2);text-transform:uppercase;margin-top:1px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STACKED BAR CHART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bar-chart-wrap{display:flex;align-items:flex-end;gap:7px;height:160px;padding-bottom:2px}
.bcc{flex:1;display:flex;flex-direction:column;align-items:center;cursor:default}
.bc-stack{width:100%;height:140px;display:flex;flex-direction:column;justify-content:flex-end;gap:1px;position:relative}
.bc-seg{width:100%;border-radius:0;transition:opacity .15s;position:relative}
.bc-seg:hover{opacity:.78}
.bc-seg.seg-t{border-radius:3px 3px 0 0}
.bc-seg.seg-b{border-radius:0}
.bc-seg.seg-only{border-radius:3px}
.bc-seg.sim{background:linear-gradient(180deg,rgba(24,180,162,.9),rgba(11,122,110,.85))}
.bc-seg.ace{background:linear-gradient(180deg,rgba(232,184,75,.88),rgba(190,138,32,.82))}
.bc-tip{position:absolute;bottom:calc(100%+5px);left:50%;transform:translateX(-50%);
  background:rgba(8,16,26,.95);border:1px solid rgba(255,255,255,.09);
  border-radius:6px;padding:4px 8px;font-size:9px;white-space:nowrap;
  pointer-events:none;opacity:0;transition:opacity .12s;z-index:20}
.bc-seg:hover .bc-tip{opacity:1}
.bc-lbl{font-size:8px;color:var(--ink3);margin-top:5px;letter-spacing:.3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HORIZONTAL BARS (tekne/sorumlu)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hbar-row{margin-bottom:13px}
.hbar-head{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:4px}
.hbar-name{font-size:12px;font-weight:500}
.hbar-val{font-family:'Cormorant Garamond',serif;font-size:15px;font-weight:700}
.hbar-bg{height:4px;background:rgba(255,255,255,0.07);border-radius:2px;overflow:hidden}
.hbar-fill{height:100%;border-radius:2px;transition:width 1.2s cubic-bezier(.23,1,.32,1)}
.hbar-detail{font-size:9px;color:var(--ink2);margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DONUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.donut-wrap{position:relative;width:160px;height:160px;margin:4px auto 16px}
.donut-wrap svg{transform:rotate(-90deg)}
.donut-center{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.donut-big{font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:700;color:#e4eef6}
.donut-sm{font-size:9px;color:var(--ink2);letter-spacing:1px}
.donut-legend{display:flex;flex-direction:column;gap:10px}
.dl-item{display:flex;align-items:center;gap:8px}
.dl-bar{width:3px;height:32px;border-radius:2px;flex-shrink:0}
.dl-info{flex:1}
.dl-name{font-size:12px;font-weight:600}
.dl-sub{font-size:10px;color:var(--ink2);margin-top:1px}
.dl-pct{font-family:'Cormorant Garamond',serif;font-size:19px;font-weight:700}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tbl-outer{border:1px solid var(--border);border-radius:11px;overflow:hidden;margin-bottom:8px}
.tbl-scroll{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:11px}
thead tr{background:rgba(255,255,255,0.035)}
th{
  padding:10px 13px;text-align:left;
  font-size:8px;letter-spacing:2px;text-transform:uppercase;
  color:var(--ink3);font-weight:600;
  border-bottom:1px solid var(--border);white-space:nowrap;
}
tbody tr{border-bottom:1px solid rgba(255,255,255,0.03);transition:background .12s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:rgba(255,255,255,0.02)}
td{padding:10px 13px;vertical-align:middle;color:var(--ink)}
.td-actions{display:flex;gap:5px;padding:8px 13px}
.fw{font-weight:600}
.mono{font-family:'Cormorant Garamond',serif;font-size:13px;font-weight:700}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.badge{
  display:inline-block;padding:2px 8px;
  border-radius:20px;font-size:9px;font-weight:700;letter-spacing:.5px;
}
.b-simay{background:rgba(11,122,110,.18);color:var(--teal2);border:1px solid rgba(11,122,110,.3)}
.b-acente{background:rgba(190,138,32,.18);color:var(--gold2);border:1px solid rgba(190,138,32,.3)}
.b-gider{background:rgba(184,48,48,.15);color:var(--red2);border:1px solid rgba(184,48,48,.22)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.filter-bar{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
.fb{
  padding:5px 13px;border-radius:20px;font-size:10px;font-weight:600;
  cursor:pointer;border:1px solid var(--border);background:none;
  color:var(--ink2);transition:all .15s;font-family:'DM Sans',sans-serif;
}
.fb:hover,.fb.on{background:rgba(11,122,110,.14);color:var(--teal2);border-color:rgba(11,122,110,.3)}

/* SEARCH */
.search-wrap{position:relative;margin-bottom:14px}
.search-input{
  width:100%;background:var(--glass2);border:1px solid var(--border);
  border-radius:8px;padding:8px 12px 8px 34px;
  color:var(--ink);font-family:'DM Sans',sans-serif;font-size:12px;outline:none;
  transition:border-color .15s;
}
.search-input:focus{border-color:rgba(11,122,110,.5)}
.search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:14px;color:var(--ink3);pointer-events:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-bg{
  position:fixed;inset:0;
  background:rgba(5,11,20,.85);backdrop-filter:blur(6px);
  z-index:100;display:flex;align-items:center;justify-content:center;
  opacity:0;pointer-events:none;transition:opacity .2s;
}
.modal-bg.open{opacity:1;pointer-events:all}
.modal{
  background:var(--bg2);
  border:1px solid rgba(255,255,255,.09);
  border-radius:16px;
  padding:28px;
  width:min(660px,96vw);max-height:90vh;
  overflow-y:auto;
  transform:translateY(10px);transition:transform .2s;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
}
.modal-bg.open .modal{transform:none}
.modal-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
.modal-title{font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:#e4eef6}
.modal-close{background:none;border:none;color:var(--ink2);font-size:20px;cursor:pointer;padding:2px 6px;border-radius:5px;transition:all .15s;line-height:1}
.modal-close:hover{background:var(--glass2);color:var(--ink)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.form-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:13px}
.fg{display:flex;flex-direction:column;gap:4px}
.fg.span2{grid-column:span 2}
.fg label{font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600}
.fg input,.fg select,.fg textarea{
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,.09);
  border-radius:7px;padding:9px 11px;
  color:var(--ink);font-family:'DM Sans',sans-serif;font-size:12px;
  outline:none;transition:border-color .15s,background .15s;
}
.fg input:focus,.fg select:focus,.fg textarea:focus{
  border-color:rgba(11,122,110,.5);background:rgba(11,122,110,.05);
}
.fg select option{background:var(--bg2);color:var(--ink)}
.fg textarea{resize:vertical;min-height:56px}
.fg .calc-result{
  font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;
  color:var(--green2);
}
.form-footer{display:flex;justify-content:flex-end;gap:8px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toasts{position:fixed;bottom:24px;right:24px;z-index:200;display:flex;flex-direction:column;gap:6px}
.toast{
  background:var(--bg2);border:1px solid var(--border);border-radius:9px;
  padding:10px 16px;font-size:11px;font-weight:500;
  display:flex;align-items:center;gap:8px;min-width:220px;
  transform:translateX(20px);opacity:0;transition:all .22s;
  box-shadow:var(--shadow);pointer-events:none;
}
.toast.show{transform:none;opacity:1}
.toast.ok{border-left:2px solid var(--green2)}
.toast.err{border-left:2px solid var(--red2)}
.toast.info{border-left:2px solid var(--blue2)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUMMARY CARDS (net kÃ¢r bÃ¶lÃ¼mÃ¼)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.net-strip{
  background:linear-gradient(135deg,rgba(21,107,58,.18),rgba(11,122,110,.12));
  border:1px solid rgba(34,197,94,.18);
  border-radius:14px;padding:22px 28px;
  display:flex;align-items:center;flex-wrap:wrap;gap:0;
  margin-bottom:16px;
}
.ns-item{flex:1;text-align:center;padding:0 16px;min-width:120px}
.ns-div{width:1px;height:48px;background:var(--border);flex-shrink:0}
.ns-lbl{font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:7px}
.ns-val{font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:700;line-height:1}
.ns-sub{font-size:9px;color:var(--ink2);margin-top:3px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty-state{text-align:center;padding:44px 20px;color:var(--ink3)}
.es-icon{font-size:36px;opacity:.3;margin-bottom:10px}
.es-text{font-size:12px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.setting-row{
  display:flex;align-items:center;justify-content:space-between;
  padding:13px 0;border-bottom:1px solid var(--border);gap:16px;
}
.setting-row:last-child{border-bottom:none}
.sr-info .sr-lbl{font-size:13px;font-weight:500}
.sr-info .sr-sub{font-size:10px;color:var(--ink2);margin-top:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESERVATION PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rez-ay-sel{
  background:var(--glass2);border:1px solid var(--border);
  border-radius:8px;padding:7px 12px;
  color:var(--ink);font-family:'DM Sans',sans-serif;font-size:11px;
  outline:none;cursor:pointer;
}
.rez-ay-sel option{background:var(--bg2)}
.rez-month-block{margin-bottom:24px}
.rez-month-title{
  font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;
  color:#e4eef6;margin-bottom:12px;padding-bottom:8px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
}
.rez-month-count{font-family:'DM Sans',sans-serif;font-size:11px;color:var(--ink2);font-weight:400}
.rez-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:10px}
.rez-card{
  background:var(--glass);border:1px solid var(--border);
  border-radius:12px;padding:14px 16px;
  border-left:3px solid var(--teal2);
  transition:border-color .15s,transform .15s;
  cursor:default;
}
.rez-card:hover{border-color:rgba(255,255,255,.12);transform:translateY(-1px)}
.rez-card.ace{border-left-color:var(--gold2)}
.rez-card-top{display:flex;align-items:flex-start;justify-content:space-between;gap:8px;margin-bottom:8px}
.rez-card-name{font-size:13px;font-weight:600;color:#e4eef6}
.rez-card-tekne{font-size:10px;color:var(--ink2);margin-top:2px}
.rez-card-dates{font-size:10px;color:var(--teal3);white-space:nowrap}
.rez-card-meta{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
.rez-card-item{font-size:9px;color:var(--ink2);display:flex;align-items:center;gap:3px}
.rez-card-val{font-family:'Cormorant Garamond',serif;font-size:14px;font-weight:700;color:var(--teal2)}
.rez-card.ace .rez-card-val{color:var(--green2)}
.rez-card-liman{font-size:9px;color:var(--ink3);margin-top:4px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR YIL SEÃ‡Ä°CÄ°
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sb-yil-wrap{
  margin:0 12px 4px;
  padding:10px 12px;
  background:linear-gradient(135deg,rgba(11,122,110,0.12),rgba(26,74,122,0.08));
  border:1px solid rgba(11,122,110,0.22);
  border-radius:10px;
}
.sb-yil-lbl{font-size:8px;letter-spacing:2.5px;text-transform:uppercase;color:var(--ink3);margin-bottom:7px;font-weight:600}
.sb-yil-row{display:flex;align-items:center;gap:6px}
.sb-yil-btn{
  width:26px;height:26px;border:1px solid rgba(11,122,110,0.3);border-radius:7px;
  background:rgba(11,122,110,0.1);color:var(--teal2);
  font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .15s;flex-shrink:0;font-family:'DM Sans',sans-serif;line-height:1;
}
.sb-yil-btn:hover{background:rgba(11,122,110,0.25);border-color:rgba(11,122,110,0.5)}
.sb-yil-sel{
  flex:1;background:rgba(11,122,110,0.1);border:1px solid rgba(11,122,110,0.25);
  border-radius:7px;padding:4px 8px;color:var(--teal2);
  font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;outline:none;cursor:pointer;
  text-align:center;
}
.sb-yil-sel option{background:var(--bg2);color:var(--ink)}
body.light-mode .sb-yil-wrap{background:linear-gradient(135deg,rgba(7,122,109,0.07),rgba(26,74,122,0.05));border-color:rgba(7,122,109,0.2)}
body.light-mode .sb-yil-btn{background:rgba(7,122,109,0.08);border-color:rgba(7,122,109,0.25);color:#077a6d}
body.light-mode .sb-yil-btn:hover{background:rgba(7,122,109,0.18)}
body.light-mode .sb-yil-sel{background:rgba(7,122,109,0.08);border-color:rgba(7,122,109,0.2);color:#077a6d}
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIMAY MODAL â€” SM COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.simay-modal{ max-width:600px; }

/* Sections */
.sm-section{
  border-radius:12px;padding:18px 20px;margin-bottom:12px;
}
.sm-section-teal{
  background:rgba(11,122,110,0.05);
  border:1px solid rgba(11,122,110,0.16);
}
.sm-section-gold{
  background:rgba(190,138,32,0.05);
  border:1px solid rgba(190,138,32,0.16);
}
.sm-section-hd{
  display:flex;align-items:center;gap:9px;margin-bottom:16px;
}
.sm-section-icon{
  width:28px;height:28px;border-radius:8px;
  display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;
}
.sm-icon-teal{background:linear-gradient(135deg,var(--teal),var(--teal2));box-shadow:0 2px 8px rgba(11,122,110,0.3)}
.sm-icon-gold{background:linear-gradient(135deg,var(--gold),var(--gold2));box-shadow:0 2px 8px rgba(190,138,32,0.3)}
.sm-section-title{font-size:11px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase}
.sm-title-teal{color:var(--teal2)}
.sm-title-gold{color:var(--gold2)}

/* Rows â€” maks 2 sÃ¼tun */
.sm-row{display:flex;gap:14px;margin-bottom:12px;align-items:flex-start}
.sm-row:last-child{margin-bottom:0}
.sm-full{flex:1 1 100%}
.sm-half{flex:1 1 0;min-width:0}

/* Tarih grubu (baÅŸlangÄ±Ã§ â†’ bitiÅŸ â†’ sÃ¼re chip) */
.sm-date-group{
  display:flex;flex-wrap:wrap;align-items:flex-end;gap:6px;
  flex:1 1 0;min-width:0;
}
.sm-gun-chip-col{flex-basis:100%;display:flex;flex-direction:row;align-items:center;gap:8px;padding-top:4px}
.sm-date-arrow{
  color:var(--ink3);font-size:14px;padding-bottom:10px;flex-shrink:0;line-height:1;
}
/* sm-gun-chip-col merged above */
.sm-gun-lbl{font-size:8px;letter-spacing:1.5px;text-transform:uppercase;color:var(--ink3);margin-bottom:4px;font-weight:600}
.sm-gun-chip{
  background:linear-gradient(135deg,rgba(11,122,110,0.18),rgba(24,180,162,0.12));
  border:1px solid rgba(11,122,110,0.3);
  border-radius:8px;padding:7px 10px;
  font-family:'Cormorant Garamond',serif;font-size:15px;font-weight:700;
  color:var(--teal2);white-space:nowrap;min-width:52px;text-align:center;
  line-height:1.3;
}

/* Para birimi prefix input */
.sm-money-wrap{
  display:flex;align-items:stretch;
  border:1px solid rgba(255,255,255,0.09);
  border-radius:7px;overflow:hidden;
  transition:border-color .15s,box-shadow .15s;
  background:rgba(255,255,255,0.04);
}
.sm-money-wrap:focus-within{
  border-color:rgba(11,122,110,0.5);
  box-shadow:0 0 0 2px rgba(11,122,110,0.08);
}
.sm-currency{
  display:flex;align-items:center;justify-content:center;
  padding:0 10px;
  font-size:13px;font-weight:700;
  background:rgba(255,255,255,0.05);
  border-right:1px solid rgba(255,255,255,0.08);
  color:var(--ink2);flex-shrink:0;min-width:32px;
  font-family:'DM Sans',sans-serif;
  letter-spacing:0;
}
.sm-currency-teal{color:var(--teal2);background:rgba(11,122,110,0.08)}
.sm-currency-gold{color:var(--gold2);background:rgba(190,138,32,0.08)}
.sm-currency-green{color:var(--green2);background:rgba(21,107,58,0.08)}
.sm-currency-red{color:var(--red2);background:rgba(184,48,48,0.08)}
.sm-money-input{
  flex:1;background:transparent;border:none;
  padding:9px 11px;color:var(--ink);
  font-family:'DM Sans',sans-serif;font-size:12px;
  outline:none;min-width:0;
}
.sm-money-input::placeholder{color:var(--ink3)}
.sm-readonly{opacity:.85;cursor:default}
.sm-readonly:focus{outline:none;box-shadow:none}

/* Auto tag */
.sm-auto-tag{
  font-size:8px;letter-spacing:1px;text-transform:uppercase;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:4px;padding:1px 5px;
  color:var(--ink3);font-weight:500;margin-left:4px;
  vertical-align:middle;
}

/* Required star */
.req{color:var(--red2);font-size:10px;vertical-align:super;margin-left:1px}

/* USD info box */
.sm-info-box{
  display:flex;align-items:center;gap:8px;
  background:rgba(96,165,250,0.07);
  border:1px solid rgba(96,165,250,0.18);
  border-radius:8px;padding:9px 13px;
  margin-bottom:12px;font-size:11px;color:#7eb8f7;
  line-height:1.4;
}
.sm-info-box strong{color:#93c5fd}

/* Status bar â€” Ã¶deme + fatura, ayrÄ±ÅŸtÄ±rÄ±lmÄ±ÅŸ */
.sm-status-bar{
  display:flex;gap:0;margin-top:14px;
  padding-top:14px;
  border-top:1px solid rgba(190,138,32,0.14);
}
.sm-status-bar .fg{padding:0 12px}
.sm-status-bar .fg:first-child{padding-left:0}
.sm-status-bar .fg:last-child{padding-right:0}
.sm-status-divider{
  width:1px;background:rgba(255,255,255,0.07);flex-shrink:0;margin:0;
}

/* Light mode overrides for sm- components */
body.light-mode .sm-section-teal{background:rgba(7,122,109,0.04);border-color:rgba(7,122,109,0.15)}
body.light-mode .sm-section-gold{background:rgba(153,106,16,0.04);border-color:rgba(153,106,16,0.15)}
body.light-mode .sm-money-wrap{background:rgba(0,0,0,0.03);border-color:rgba(0,0,0,0.1)}
body.light-mode .sm-money-wrap:focus-within{border-color:rgba(7,122,109,0.4);box-shadow:0 0 0 2px rgba(7,122,109,0.06)}
body.light-mode .sm-currency{background:rgba(0,0,0,0.04);border-right-color:rgba(0,0,0,0.08);color:#5a7080}
body.light-mode .sm-currency-teal{color:#077a6d;background:rgba(7,122,109,0.07)}
body.light-mode .sm-currency-gold{color:#8a5f0a;background:rgba(153,106,16,0.07)}
body.light-mode .sm-currency-green{color:#0d7a38;background:rgba(13,122,56,0.07)}
body.light-mode .sm-currency-red{color:#b03030;background:rgba(176,48,48,0.07)}
body.light-mode .sm-money-input{color:#1a2a3a}
body.light-mode .sm-gun-chip{background:rgba(7,122,109,0.08);border-color:rgba(7,122,109,0.2);color:#077a6d}
body.light-mode .sm-auto-tag{background:rgba(0,0,0,0.05);border-color:rgba(0,0,0,0.08);color:#6a8090}
body.light-mode .sm-info-box{background:rgba(26,90,153,0.06);border-color:rgba(26,90,153,0.14);color:#1a5a99}
body.light-mode .sm-info-box strong{color:#1a4a88}
body.light-mode .sm-status-bar{border-top-color:rgba(153,106,16,0.12)}
body.light-mode .sm-status-divider{background:rgba(0,0,0,0.07)}
body.light-mode .sm-date-arrow{color:#8aa0b4}

.acente-section-hd{
  display:flex;align-items:center;gap:8px;
  font-size:11px;font-weight:600;letter-spacing:.5px;
  color:var(--ink2);margin-bottom:10px;margin-top:8px;
  padding:6px 10px;background:rgba(255,255,255,.03);
  border-radius:7px;border:1px solid var(--border);
}
.acente-section-icon{font-size:14px}

@media(max-width:960px){
  #sidebar{width:200px}
  .kpi-grid{grid-template-columns:repeat(2,1fr)}
  .grid-2,.grid-3,.grid-2-eq{grid-template-columns:1fr}
}
@media(max-width:680px){
  #sidebar{position:fixed;left:-200px;z-index:50;transition:left .25s;height:100vh}
  #sidebar.mob-open{left:0}
  .kpi-grid{grid-template-columns:1fr 1fr}
  .page{padding:20px 16px 50px}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login-screen{
  position:fixed;inset:0;z-index:10000;
  background:var(--bg);
  display:flex;align-items:center;justify-content:center;
}
#login-screen.hidden{display:none}
.login-box{
  background:var(--bg2);
  border:1px solid var(--border);
  border-radius:20px;
  padding:40px 44px;
  width:min(420px,94vw);
  box-shadow:0 24px 80px rgba(0,0,0,0.5);
  position:relative;
}
.login-logo{
  display:flex;align-items:center;gap:12px;
  margin-bottom:32px;justify-content:center;
}
.login-icon{
  width:46px;height:46px;
  background:linear-gradient(135deg,var(--teal),var(--teal2));
  border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;
  box-shadow:0 4px 16px rgba(11,122,110,0.4);
}
.login-title{
  font-family:'Cormorant Garamond',serif;
  font-size:28px;font-weight:700;color:#e4eef6;
}
.login-sub{
  text-align:center;font-size:11px;color:var(--ink3);
  margin-bottom:28px;letter-spacing:.5px;
}
.login-field{display:flex;flex-direction:column;gap:5px;margin-bottom:14px}
.login-field label{font-size:8px;letter-spacing:2.5px;text-transform:uppercase;color:var(--ink3);font-weight:600}
.login-field input{
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,.09);
  border-radius:9px;padding:11px 14px;
  color:var(--ink);font-family:'DM Sans',sans-serif;font-size:13px;
  outline:none;transition:border-color .15s,background .15s;
}
.login-field input:focus{border-color:rgba(11,122,110,.5);background:rgba(11,122,110,.05)}
.login-btn{
  width:100%;padding:12px;border-radius:9px;
  background:linear-gradient(135deg,var(--teal),var(--teal2));
  color:#fff;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;
  border:none;cursor:pointer;margin-top:8px;
  transition:filter .18s,transform .15s;
  letter-spacing:.3px;
}
.login-btn:hover{filter:brightness(1.1)}
.login-btn:active{transform:scale(0.98)}
.login-btn:disabled{opacity:.6;cursor:not-allowed}
.login-error{
  background:rgba(184,48,48,.12);
  border:1px solid rgba(184,48,48,.25);
  border-radius:8px;padding:9px 13px;
  color:var(--red2);font-size:11px;margin-top:12px;
  display:none;text-align:center;
}
.login-error.show{display:block}
.logout-btn{
  display:flex;align-items:center;gap:6px;
  padding:7px 13px;border-radius:7px;
  background:rgba(184,48,48,.1);color:var(--red2);
  border:1px solid rgba(184,48,48,.2);
  font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;
  cursor:pointer;transition:all .15s;
}
.logout-btn:hover{background:rgba(184,48,48,.2)}
.login-user{
  font-size:10px;color:var(--ink3);padding:8px 16px 0;
  text-align:center;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DETAY MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px 20px;margin-bottom:8px}
.detail-item{padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.04)}
.detail-lbl{font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:3px}
.detail-val{font-size:13px;font-weight:500;color:var(--ink)}
.detail-val.mono{font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700}
.detail-section{font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:#e4eef6;
  margin:16px 0 10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
tbody tr.clickable{cursor:pointer}
tbody tr.clickable:hover{background:rgba(11,122,110,0.06)!important}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIGHT MODE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
body.light-mode{
  --bg:#f0f4f8;
  --bg2:#ffffff;
  --bg3:#e8eef4;
  --ink:#1a2a3a;
  --ink2:#3a5060;
  --ink3:#6a8090;
  --border:rgba(0,0,0,0.1);
  --glass:rgba(0,0,0,0.02);
  --glass2:rgba(0,0,0,0.04);
  --shadow:0 4px 24px rgba(0,0,0,0.08);
  --teal:#0b7a6e;
  --teal2:#077a6d;
  --teal3:#065f55;
  --gold:#996a10;
  --gold2:#8a5f0a;
  --gold3:#6b4600;
  --green:#0a5a2a;
  --green2:#0d7a38;
  --red:#9a2020;
  --red2:#b03030;
  --blue:#1a4a7a;
  --blue2:#1a5a99;
}
body.light-mode::before{
  background:
    radial-gradient(ellipse 80% 60% at -5% -10%,rgba(11,122,110,0.08) 0%,transparent 55%),
    radial-gradient(ellipse 60% 50% at 105% 110%,rgba(26,74,122,0.06) 0%,transparent 55%);
}
body.light-mode::after{
  background-image:linear-gradient(rgba(0,0,0,0.03) 1px,transparent 1px),
                   linear-gradient(90deg,rgba(0,0,0,0.03) 1px,transparent 1px);
}
body.light-mode #sidebar{background:rgba(240,244,248,0.95)}
body.light-mode .fg input,body.light-mode .fg select,body.light-mode .fg textarea{
  background:rgba(0,0,0,0.04);border-color:rgba(0,0,0,0.12);color:var(--ink);
}
body.light-mode .modal{background:var(--bg2)}
body.light-mode .kpi{background:rgba(255,255,255,0.8)}
body.light-mode .panel{background:rgba(255,255,255,0.7)}
body.light-mode table thead tr{background:rgba(0,0,0,0.03)}
body.light-mode tbody tr:hover{background:rgba(0,0,0,0.02)}
body.light-mode .search-input{background:rgba(255,255,255,0.9);color:var(--ink)}
body.light-mode .rez-card{background:rgba(255,255,255,0.8)}
body.light-mode #login-screen{background:var(--bg)}
body.light-mode .login-box{background:var(--bg2)}
body.light-mode .login-field input{background:rgba(0,0,0,0.04);color:var(--ink)}
body.light-mode .net-strip{background:linear-gradient(135deg,rgba(21,107,58,0.08),rgba(11,122,110,0.06))}

/* Light mode â€” widget renkleri gÃ¶rÃ¼nÃ¼rlÃ¼k dÃ¼zeltmesi */
body.light-mode .kpi-lbl,body.light-mode .kpi-sub,body.light-mode .panel-sub,
body.light-mode .ns-lbl,body.light-mode .ns-sub,
body.light-mode th,body.light-mode .sb-section,body.light-mode .sb-tagline,
body.light-mode .detail-lbl,body.light-mode .ring-lbl2,body.light-mode .donut-sm{
  color:#5a7080;
}
body.light-mode .kpi-val,body.light-mode .panel-title,body.light-mode .ns-val,
body.light-mode .ring-pct,body.light-mode .donut-big,
body.light-mode h2,body.light-mode .modal-title,body.light-mode .sb-name,
body.light-mode .detail-section,body.light-mode .rez-month-title,
body.light-mode .sb-card-lbl{ color:#1a2a3a; }
body.light-mode .sb-item{color:#3a5060}
body.light-mode .sb-item:hover,body.light-mode .sb-item.active{color:#077a6d}
body.light-mode td{color:#1a2a3a}
body.light-mode .b-simay{background:rgba(7,122,109,0.1);color:#077a6d;border-color:rgba(7,122,109,0.25)}
body.light-mode .b-acente{background:rgba(153,106,16,0.1);color:#8a5f0a;border-color:rgba(153,106,16,0.25)}
body.light-mode .b-gider{background:rgba(176,48,48,0.1);color:#b03030;border-color:rgba(176,48,48,0.2)}
body.light-mode .f-bekliyor{background:rgba(26,90,153,0.1);color:#1a5a99;border-color:rgba(26,90,153,0.2)}
body.light-mode .f-odendi{background:rgba(13,122,56,0.1);color:#0d7a38;border-color:rgba(13,122,56,0.2)}
body.light-mode .f-kismi{background:rgba(153,106,16,0.1);color:#8a5f0a;border-color:rgba(153,106,16,0.2)}
body.light-mode .f-gecikti{background:rgba(176,48,48,0.1);color:#b03030;border-color:rgba(176,48,48,0.2)}
body.light-mode .acente-section-hd{background:rgba(0,0,0,0.03);color:#3a5060;border-color:rgba(0,0,0,0.08)}
body.light-mode .rez-card-dates{color:#077a6d}
body.light-mode .rez-card-liman{color:#6a8090}
body.light-mode .hbar-detail{color:#6a8090}
body.light-mode .bar-chart-wrap .bc-lbl{color:#6a8090}
body.light-mode .calc-result{color:#0d7a38 !important}
body.light-mode #fs-kalan,body.light-mode #fa-kalan{color:#b03030 !important}
body.light-mode .prog-labels{color:#3a5060}
body.light-mode #fs-usd-info{background:rgba(26,90,153,0.07);border-color:rgba(26,90,153,0.15);color:#1a5a99}
body.light-mode .sb-card-val{color:#8a5f0a}
body.light-mode .sb-card-sub{color:#0d7a38}
body.light-mode .modal-close{color:#3a5060}
body.light-mode .modal-close:hover{background:rgba(0,0,0,0.06);color:#1a2a3a}
body.light-mode .fg label{color:#5a7080}
body.light-mode .form-footer{border-top-color:rgba(0,0,0,0.08)}
body.light-mode .tbl-outer{border-color:rgba(0,0,0,0.1)}
body.light-mode tbody tr{border-bottom-color:rgba(0,0,0,0.05)}
.theme-toggle{display:flex;align-items:center;gap:8px;padding:8px 0}
.theme-switch{position:relative;width:40px;height:22px;cursor:pointer}
.theme-switch input{opacity:0;width:0;height:0}
.theme-slider{position:absolute;inset:0;background:rgba(255,255,255,0.1);border:1px solid var(--border);border-radius:22px;transition:.3s}
.theme-slider:before{content:'';position:absolute;height:16px;width:16px;left:3px;bottom:2px;background:var(--ink2);border-radius:50%;transition:.3s}
input:checked + .theme-slider{background:linear-gradient(135deg,var(--teal),var(--teal2))}
input:checked + .theme-slider:before{transform:translateX(18px);background:#fff}
.theme-lbl{font-size:11px;color:var(--ink2);font-weight:500}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FATURA DURUM BADGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.f-bekliyor{background:rgba(26,74,122,.18);color:var(--blue2);border:1px solid rgba(26,74,122,.3)}
.f-kismi{background:rgba(190,138,32,.18);color:var(--gold2);border:1px solid rgba(190,138,32,.3)}
.f-odendi{background:rgba(21,107,58,.18);color:var(--green2);border:1px solid rgba(21,107,58,.3)}
.f-gecikti{background:rgba(184,48,48,.18);color:var(--red2);border:1px solid rgba(184,48,48,.3)}
.f-iptal{background:rgba(74,96,112,.18);color:var(--ink2);border:1px solid rgba(74,96,112,.3)}
</style>
</head>
<body>
<div id="app">

<!-- â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â• -->
<aside id="sidebar">
  <div class="sb-logo">
    <div class="sb-logo-mark">
      <div class="sb-icon">â›µ</div>
      <div>
        <div class="sb-name">Simay</div>
      </div>
    </div>
    <div class="sb-tagline">YatÃ§Ä±lÄ±k Â· Muhasebe</div>
  </div>

  <nav class="sb-nav">
    <!-- YIL SEÃ‡Ä°CÄ° â€” Sidebar -->
    <div class="sb-yil-wrap">
      <div class="sb-yil-lbl">Aktif YÄ±l</div>
      <div class="sb-yil-row">
        <button class="sb-yil-btn" onclick="switchYear(activeYil-1)">â€¹</button>
        <select id="yil-selector-sb" onchange="switchYear(this.value)" class="sb-yil-sel">
          <option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option>
          <option value="2026" selected>2026</option><option value="2027">2027</option><option value="2028">2028</option>
          <option value="2029">2029</option><option value="2030">2030</option>
        </select>
        <button class="sb-yil-btn" onclick="switchYear(activeYil+1)">â€º</button>
      </div>
    </div>

    <div class="sb-section">Ana MenÃ¼</div>
    <div class="sb-item active" data-page="dashboard">
      <span class="si">ğŸ“Š</span>Dashboard
    </div>

    <div class="sb-section">SatÄ±ÅŸ KayÄ±tlarÄ±</div>
    <div class="sb-item" data-page="tum-satislar">
      <span class="si">ğŸ“‹</span>TÃ¼m SatÄ±ÅŸlar
      <span class="sb-badge" id="badge-tum">0</span>
    </div>
    <div class="sb-item" data-page="rezervasyon">
      <span class="si">ğŸ—“</span>Rezervasyon Takvim
    </div>
    <div class="sb-item" data-page="simay">
      <span class="si">â›µ</span>Simay Tekneleri
      <span class="sb-badge" id="badge-simay">0</span>
    </div>
    <div class="sb-item" data-page="acente">
      <span class="si">ğŸ¤</span>Acenta / DÄ±ÅŸ SatÄ±ÅŸ
      <span class="sb-badge" id="badge-acente">0</span>
    </div>

    <div class="sb-section">Finans</div>
    <div class="sb-item" data-page="gider">
      <span class="si">ğŸ“Š</span>TÃ¼m Giderler
    </div>
    <div class="sb-item" data-page="gider-simay">
      <span class="si">â›µ</span>Simay Giderleri
    </div>
    <div class="sb-item" data-page="gider-acenta">
      <span class="si">ğŸ¤</span>Acenta Giderleri
    </div>
    <div class="sb-item" data-page="fatura">
      <span class="si">ğŸ§¾</span>Faturalar
      <span class="sb-badge" id="badge-fatura">0</span>
    </div>
    <div class="sb-item" data-page="raporlar">
      <span class="si">ğŸ“ˆ</span>Raporlar & Analiz
    </div>

    <div class="sb-section">Sistem</div>
    <div class="sb-item" data-page="ayarlar">
      <span class="si">âš™ï¸</span>Ayarlar
    </div>
  </nav>

  <div class="sb-footer">
    <div style="font-size:10px;color:var(--ink3);text-align:center;padding:0 0 10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" id="sb-user"></div>
    <button class="logout-btn" style="width:100%;justify-content:center">â‹ Ã‡Ä±kÄ±ÅŸ Yap</button>
  </div>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â• -->
<main id="main">

<!-- â”€â”€â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€ -->
<div class="page active" id="page-dashboard">

  <!-- YIL SEÃ‡Ä°CÄ° BANNER -->
  <div id="yil-banner" style="
    display:flex;align-items:center;justify-content:space-between;
    background:linear-gradient(135deg,rgba(11,122,110,0.12) 0%,rgba(26,74,122,0.1) 100%);
    border:1px solid rgba(11,122,110,0.2);
    border-radius:14px;padding:14px 20px;margin-bottom:22px;
    backdrop-filter:blur(8px);gap:16px;flex-wrap:wrap;
  ">
    <div style="display:flex;align-items:center;gap:12px">
      <div style="width:36px;height:36px;background:linear-gradient(135deg,var(--teal),var(--teal2));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;box-shadow:0 2px 10px rgba(11,122,110,0.35)">ğŸ“…</div>
      <div>
        <div style="font-size:9px;letter-spacing:2.5px;text-transform:uppercase;color:var(--ink3);margin-bottom:2px">AKTÄ°F YIL</div>
        <div style="font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:#e4eef6;line-height:1" id="yil-banner-display">2026</div>
      </div>
      <span id="readonly-badge" style="display:none;background:rgba(184,48,48,.15);color:var(--red2);border:1px solid rgba(184,48,48,.3);border-radius:6px;padding:4px 10px;font-size:10px;font-weight:700">ğŸ”’ SALT OKUNUR</span>
    </div>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      <div style="display:flex;gap:6px">
        <button onclick="switchYear(activeYil-1)" style="background:var(--glass2);border:1px solid var(--border);border-radius:7px;padding:7px 12px;color:var(--ink2);cursor:pointer;font-size:12px;font-family:'DM Sans',sans-serif;transition:all .15s" onmouseover="this.style.color='var(--ink)'" onmouseout="this.style.color='var(--ink2)'">â€¹ Ã–nceki</button>
        <select id="yil-selector" onchange="switchYear(this.value)" style="background:rgba(11,122,110,0.15);border:1px solid rgba(11,122,110,0.3);border-radius:7px;padding:7px 12px;color:var(--teal2);font-family:'DM Sans',sans-serif;font-size:13px;font-weight:700;outline:none;cursor:pointer">
          <option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option>
          <option value="2026" selected>2026</option><option value="2027">2027</option><option value="2028">2028</option>
          <option value="2029">2029</option><option value="2030">2030</option><option value="2031">2031</option>
          <option value="2032">2032</option><option value="2033">2033</option><option value="2034">2034</option>
          <option value="2035">2035</option>
        </select>
        <button onclick="switchYear(activeYil+1)" style="background:var(--glass2);border:1px solid var(--border);border-radius:7px;padding:7px 12px;color:var(--ink2);cursor:pointer;font-size:12px;font-family:'DM Sans',sans-serif;transition:all .15s" onmouseover="this.style.color='var(--ink)'" onmouseout="this.style.color='var(--ink2)'">Sonraki â€º</button>
      </div>
      <div style="width:1px;height:28px;background:var(--border)"></div>
      <div style="text-align:right">
        <div style="font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--ink3)">Toplam Ciro</div>
        <div style="font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:700;color:var(--gold2)" id="yil-banner-ciro">â€”</div>
      </div>
    </div>
  </div>

  <div class="ph">
    <div class="ph-left">
      <h2>Dashboard</h2>
      <p id="dash-date">AnlÄ±k performans Ã¶zeti</p>
    </div>
    <div class="ph-actions">
      <button class="btn btn-ghost" onclick="exportCSV()">â¬‡ Excel Ä°ndir</button>
      <button class="btn btn-gold" onclick="openModal('modal-simay','Simay Tekneleri â€” Yeni SatÄ±ÅŸ')">+ Simay Ekle</button>
      <button class="btn btn-teal" onclick="openModal('modal-acente','Acenta â€” Yeni SatÄ±ÅŸ')">+ Acenta Ekle</button>
    </div>
  </div>

  <div class="kpi-grid" id="dash-kpis"></div>

  <div class="grid-2">
    <!-- Hedef paneli -->
    <div class="panel">
      <div class="panel-hd">
        <div>
          <div class="panel-title">YÄ±llÄ±k Hedef Takibi</div>
          <div class="panel-sub" id="hedef-sub">â€”</div>
        </div>
        <div class="ring-outer">
          <svg width="110" height="110" viewBox="0 0 110 110">
            <circle cx="55" cy="55" r="44" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="12"/>
            <circle cx="55" cy="55" r="44" fill="none" stroke="url(#rg)" stroke-width="12"
              stroke-dasharray="276.5" stroke-dashoffset="276.5" id="ring-arc" stroke-linecap="butt"/>
            <defs>
              <linearGradient id="rg" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#0b7a6e"/><stop offset="100%" stop-color="#e8b84b"/>
              </linearGradient>
            </defs>
          </svg>
          <div class="ring-inner">
            <span class="ring-pct" id="ring-pct">0%</span>
            <span class="ring-lbl2">hedef</span>
          </div>
        </div>
      </div>
      <div class="prog-labels">
        <span id="prog-ger">GerÃ§ekleÅŸen: â‚¬0</span>
        <span id="prog-hed">Hedef: â‚¬0</span>
      </div>
      <div class="prog-track"><div class="prog-fill" id="prog-fill" style="width:0%"></div></div>
      <div id="hedef-detay" style="display:flex;gap:12px;margin-top:14px;flex-wrap:wrap"></div>
    </div>

    <!-- AylÄ±k chart -->
    <div class="panel">
      <div class="panel-hd">
        <div><div class="panel-title">AylÄ±k Gelir</div><div class="panel-sub">Simay + Acenta</div></div>
        <div style="display:flex;gap:12px">
          <div style="display:flex;align-items:center;gap:5px;font-size:9px;color:var(--ink2)">
            <div style="width:8px;height:8px;border-radius:2px;background:var(--teal2)"></div>Simay
          </div>
          <div style="display:flex;align-items:center;gap:5px;font-size:9px;color:var(--ink2)">
            <div style="width:8px;height:8px;border-radius:2px;background:var(--gold2)"></div>Acente
          </div>
        </div>
      </div>
      <div class="bar-chart-wrap" id="dash-chart"></div>
    </div>
  </div>

  <div class="grid-2-eq">
    <!-- Tekne bazlÄ± -->
    <div class="panel">
      <div class="panel-hd"><div><div class="panel-title">Simay Tekneleri</div><div class="panel-sub">Ciro sÄ±ralamasÄ±</div></div></div>
      <div id="dash-tekneler"></div>
    </div>
    <!-- Son iÅŸlemler -->
    <div class="panel">
      <div class="panel-hd"><div><div class="panel-title">Son Ä°ÅŸlemler</div><div class="panel-sub">En son 10 kayÄ±t</div></div></div>
      <div id="dash-son"></div>
    </div>
  </div>

  <!-- FATURA KESÄ°M UYARILARI PANELÄ° -->
  <div id="fatura-uyari-panel" style="display:none;margin-top:0"></div>

</div>

<!-- â”€â”€â”€â”€â”€ REZERVASYon TAKVÄ°M â”€â”€â”€â”€â”€ -->
<div class="page" id="page-rezervasyon">
  <div class="ph">
    <div class="ph-left"><h2>Rezervasyon Takvim</h2><p id="rez-page-sub">AylÄ±k rezervasyon gÃ¶rÃ¼nÃ¼mÃ¼</p></div>
    <div class="ph-actions">
      <select id="rez-ay-sel" class="rez-ay-sel" onchange="renderRezervasyonPage()">
        <option value="0">TÃ¼m Aylar</option>
        <option value="1">Ocak</option><option value="2">Åubat</option><option value="3">Mart</option>
        <option value="4">Nisan</option><option value="5">MayÄ±s</option><option value="6">Haziran</option>
        <option value="7">Temmuz</option><option value="8">AÄŸustos</option><option value="9">EylÃ¼l</option>
        <option value="10">Ekim</option><option value="11">KasÄ±m</option><option value="12">AralÄ±k</option>
      </select>
      <select id="rez-tip-sel" class="rez-ay-sel" onchange="renderRezervasyonPage()">
        <option value="all">TÃ¼m Tipler</option>
        <option value="simay">Simay</option>
        <option value="acente">Acenta</option>
      </select>
    </div>
  </div>
  <div class="kpi-grid" id="rez-kpis" style="grid-template-columns:repeat(4,1fr)"></div>
  <div id="rez-aylar-wrap"></div>
</div>

<!-- â”€â”€â”€â”€â”€ SÄ°MAY TEKNELERÄ° â”€â”€â”€â”€â”€ -->
<div class="page" id="page-simay">
  <div class="ph">
    <div class="ph-left"><h2>Simay Tekneleri</h2><p>Kendi filo ciro kayÄ±tlarÄ±</p></div>
    <div class="ph-actions">
      <button class="btn btn-ghost btn-sm" onclick="exportCSV('simay')">â¬‡ Ä°ndir</button>
      <button class="btn btn-teal" onclick="openModal('modal-simay','Simay Tekneleri â€” Yeni SatÄ±ÅŸ')">+ Yeni Ekle</button>
    </div>
  </div>
  <div class="kpi-grid" id="simay-kpis" style="grid-template-columns:repeat(5,1fr)"></div>
  <div class="filter-bar" id="simay-filters"></div>
  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input class="search-input" id="simay-search" placeholder="Misafir veya tekne ara..." oninput="renderSimayTable()">
  </div>
  <div class="tbl-outer">
    <div class="tbl-scroll">
      <table>
        <thead><tr>
          <th>#</th><th>Misafir AdÄ± SoyadÄ±</th><th>Tekne</th>
          <th>GiriÅŸ LimanÄ±</th><th>Ã‡Ä±kÄ±ÅŸ LimanÄ±</th>
          <th>GiriÅŸ Tarihi</th><th>Ã‡Ä±kÄ±ÅŸ Tarihi</th>
          <th>Ã–deme Durumu</th><th>Fatura</th><th>Ä°ÅŸlem</th>
        </tr></thead>
        <tbody id="simay-tbody"></tbody>
      </table>
    </div>
  </div>
  <div id="simay-empty" style="display:none" class="empty-state"><div class="es-icon">â›µ</div><div class="es-text">HenÃ¼z Simay Tekneleri kaydÄ± yok.<br>YukarÄ±dan ekleyin.</div></div>
  <div id="simay-total-row" style="display:flex;justify-content:flex-end;padding:10px 0;font-size:11px;color:var(--ink2)"></div>
</div>

<!-- â”€â”€â”€â”€â”€ ACENTE â”€â”€â”€â”€â”€ -->
<div class="page" id="page-acente">
  <div class="ph">
    <div class="ph-left"><h2>Acenta / DÄ±ÅŸ SatÄ±ÅŸ</h2><p>Komisyon kÃ¢r kayÄ±tlarÄ±</p></div>
    <div class="ph-actions">
      <button class="btn btn-ghost btn-sm" onclick="exportCSV('acente')">â¬‡ Ä°ndir</button>
      <button class="btn btn-gold" onclick="openModal('modal-acente','Acenta â€” Yeni SatÄ±ÅŸ')">+ Yeni Ekle</button>
    </div>
  </div>
  <div class="kpi-grid" id="acente-kpis" style="grid-template-columns:repeat(3,1fr)"></div>
  <div class="filter-bar" id="acente-filters"></div>
  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input class="search-input" id="acente-search" placeholder="Misafir, tekne veya sorumlu ara..." oninput="renderAcenteTable()">
  </div>
  <div class="tbl-outer">
    <div class="tbl-scroll">
      <table>
        <thead><tr>
          <th>#</th><th>Misafir AdÄ± SoyadÄ±</th><th>Tekne</th>
          <th>GiriÅŸ LimanÄ±</th><th>Ã‡Ä±kÄ±ÅŸ LimanÄ±</th>
          <th>GiriÅŸ Tarihi</th><th>Ã‡Ä±kÄ±ÅŸ Tarihi</th>
          <th>Ã–deme Durumu</th><th>Fatura</th><th>Ä°ÅŸlem</th>
        </tr></thead>
        <tbody id="acente-tbody"></tbody>
      </table>
    </div>
  </div>
  <div id="acente-empty" style="display:none" class="empty-state"><div class="es-icon">ğŸ¤</div><div class="es-text">HenÃ¼z acente kaydÄ± yok.</div></div>
</div>

<!-- â”€â”€â”€â”€â”€ GÄ°DER â”€â”€â”€â”€â”€ -->
<div class="page" id="page-gider">
  <div class="ph">
    <div class="ph-left"><h2 id="gider-page-title">TÃ¼m Giderler</h2><p id="gider-page-sub">Simay + Acenta toplam giderleri</p></div>
  </div>
  <div class="kpi-grid" id="gider-kpis" style="grid-template-columns:repeat(3,1fr)"></div>
  <div class="tbl-outer">
    <div class="tbl-scroll">
      <table>
        <thead><tr><th>#</th><th>TÃ¼r</th><th>Tarih</th><th>Kategori</th><th>AÃ§Ä±klama</th><th>Tutar (â‚¬)</th><th>Ä°ÅŸlem</th></tr></thead>
        <tbody id="gider-tbody"></tbody>
      </table>
    </div>
  </div>
  <div id="gider-empty" style="display:none" class="empty-state"><div class="es-icon">ğŸ“‰</div><div class="es-text">HenÃ¼z gider kaydÄ± yok.</div></div>
</div>
<!-- â”€â”€â”€â”€â”€ SIMAY GÄ°DER â”€â”€â”€â”€â”€ -->
<div class="page" id="page-gider-simay">
  <div class="ph">
    <div class="ph-left"><h2>Simay Tekneleri Giderleri</h2><p>YalnÄ±zca tekne giderleri</p></div>
    <button class="btn btn-danger" onclick="openGiderModal('simay')">+ Simay Gider Ekle</button>
  </div>
  <div class="kpi-grid" id="gider-simay-kpis" style="grid-template-columns:repeat(2,1fr)"></div>
  <div class="tbl-outer"><div class="tbl-scroll"><table>
    <thead><tr><th>#</th><th>Tarih</th><th>Kategori</th><th>AÃ§Ä±klama</th><th>Tutar (â‚¬)</th><th>Ä°ÅŸlem</th></tr></thead>
    <tbody id="gider-simay-tbody"></tbody>
  </table></div></div>
  <div id="gider-simay-empty" style="display:none" class="empty-state"><div class="es-icon">â›µ</div><div class="es-text">Simay gideri yok.</div></div>
</div>
<!-- â”€â”€â”€â”€â”€ ACENTA GÄ°DER â”€â”€â”€â”€â”€ -->
<div class="page" id="page-gider-acenta">
  <div class="ph">
    <div class="ph-left"><h2>Acenta Giderleri</h2><p>YalnÄ±zca acenta giderleri</p></div>
    <button class="btn btn-danger" onclick="openGiderModal('acenta')">+ Acenta Gider Ekle</button>
  </div>
  <div class="kpi-grid" id="gider-acenta-kpis" style="grid-template-columns:repeat(2,1fr)"></div>
  <div class="tbl-outer"><div class="tbl-scroll"><table>
    <thead><tr><th>#</th><th>Tarih</th><th>Kategori</th><th>AÃ§Ä±klama</th><th>Tutar (â‚¬)</th><th>Ä°ÅŸlem</th></tr></thead>
    <tbody id="gider-acenta-tbody"></tbody>
  </table></div></div>
  <div id="gider-acenta-empty" style="display:none" class="empty-state"><div class="es-icon">ğŸ¤</div><div class="es-text">Acenta gideri yok.</div></div>
</div>

<!-- â”€â”€â”€â”€â”€ RAPORLAR â”€â”€â”€â”€â”€ -->
<div class="page" id="page-raporlar">
  <div class="ph">
    <div class="ph-left"><h2>Raporlar & Analiz</h2><p>DetaylÄ± finansal Ã¶zet</p></div>
    <button class="btn btn-ghost" onclick="exportCSV()">â¬‡ Tam Rapor Ä°ndir</button>
  </div>

  <div class="net-strip" id="net-strip"></div>

  <div class="grid-2">
    <div class="panel">
      <div class="panel-hd"><div><div class="panel-title">Gelir BileÅŸimi</div></div></div>
      <div class="donut-wrap" id="donut-wrap">
        <svg width="160" height="160" viewBox="0 0 160 160">
          <circle cx="80" cy="80" r="62" fill="none" stroke="rgba(255,255,255,0.04)" stroke-width="22"/>
          <circle cx="80" cy="80" r="62" fill="none" stroke="url(#dg1)" stroke-width="22"
            stroke-dasharray="389.6" id="donut-simay" stroke-dashoffset="389.6" stroke-linecap="butt"/>
          <circle cx="80" cy="80" r="62" fill="none" stroke="url(#dg2)" stroke-width="22"
            stroke-dasharray="389.6" id="donut-acente" stroke-dashoffset="389.6" stroke-linecap="butt"/>
          <defs>
            <linearGradient id="dg1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#0b7a6e"/><stop offset="100%" stop-color="#18b4a2"/>
            </linearGradient>
            <linearGradient id="dg2" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#be8a20"/><stop offset="100%" stop-color="#e8b84b"/>
            </linearGradient>
          </defs>
        </svg>
        <div class="donut-center">
          <span class="donut-big" id="donut-total">â€”</span>
          <span class="donut-sm">TOPLAM</span>
        </div>
      </div>
      <div class="donut-legend" id="donut-legend"></div>
    </div>

    <div class="panel">
      <div class="panel-hd"><div><div class="panel-title">AylÄ±k KÃ¢r / Zarar</div></div></div>
      <div class="tbl-outer" style="margin-bottom:0">
        <div class="tbl-scroll">
          <table>
            <thead><tr><th>Ay</th><th>Simay</th><th>Acenta</th><th>Gelir</th><th>Gider</th><th>Net</th></tr></thead>
            <tbody id="rapor-aylik-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="grid-2-eq">
    <div class="panel">
      <div class="panel-hd"><div><div class="panel-title">Tekne BazÄ±nda</div></div></div>
      <div id="rapor-tekne"></div>
    </div>
    <div class="panel">
      <div class="panel-hd"><div><div class="panel-title">SatÄ±ÅŸ SorumlularÄ±</div></div></div>
      <div id="rapor-sorumlu"></div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-hd"><div><div class="panel-title">Simay Tekneleri â€” Acenta BazlÄ± SatÄ±ÅŸlar</div><div class="panel-sub">Hangi acentenin kaÃ§ satÄ±ÅŸ getirdiÄŸi (yÄ±llÄ±k raporda toplamda gÃ¶zÃ¼kmez, sadece burada izlenir)</div></div></div>
    <div id="rapor-acente-simay"></div>
  </div>

  <div class="panel">
    <div class="panel-hd">
      <div>
        <div class="panel-title">Rezervasyon AlÄ±m Tarihi Analizi</div>
        <div class="panel-sub">Rezervasyonun sisteme girildiÄŸi aya gÃ¶re daÄŸÄ±lÄ±m â€” tur tarihi deÄŸil, satÄ±ÅŸ yapÄ±lan tarih</div>
      </div>
    </div>
    <div id="rapor-alis-tarihi"></div>
  </div>
</div>

<!-- â”€â”€â”€â”€â”€ AYARLAR â”€â”€â”€â”€â”€ -->
<div class="page" id="page-ayarlar">
  <div class="ph">
    <div class="ph-left"><h2>Ayarlar</h2><p>Hedef ve sistem yapÄ±landÄ±rmasÄ±</p></div>
    <button class="btn btn-teal" onclick="saveSettings()">âœ“ Kaydet</button>
  </div>
  <div class="panel" style="max-width:540px">
    <div class="panel-title" style="margin-bottom:18px">YÄ±llÄ±k Hedefler</div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;padding:10px 14px;background:rgba(11,122,110,0.08);border:1px solid rgba(11,122,110,0.2);border-radius:9px">
      <span style="font-size:16px">ğŸ“…</span>
      <span style="font-size:12px;color:var(--teal2);font-weight:600">Aktif YÄ±l: <span id="s-yil-goster"></span></span>
      <span style="font-size:10px;color:var(--ink3);margin-left:4px">â€” YÄ±lÄ± sol menÃ¼den deÄŸiÅŸtirebilirsiniz</span>
    </div>
    <div class="form-grid">
      <div class="fg"><label>Ciro Hedefi (â‚¬)</label><input type="number" id="s-hedef"></div>
    </div>
    <div style="border-top:1px solid var(--border);margin:20px 0"></div>
    <div class="panel-title" style="margin-bottom:14px">Simay Tekne Listesi</div>
    <div class="fg">
      <label>Tekne adlarÄ± (virgÃ¼lle ayÄ±rÄ±n)</label>
      <input type="text" id="s-tekneler" placeholder="SÄ°MAY M,SÄ°MAY F,SÄ°MAY S,JR. SÄ°MAY">
    </div>
    <div style="border-top:1px solid var(--border);margin:20px 0"></div>
    <div class="panel-title" style="margin-bottom:14px">SatÄ±ÅŸ SorumlularÄ±</div>
    <div style="margin-bottom:10px;font-size:10px;color:var(--ink3)">Mevcut sorumlular â€” form aÃ§Ä±ldÄ±ÄŸÄ±nda listede gÃ¶rÃ¼nÃ¼r</div>
    <div id="s-sorumlular-list" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px"></div>
    <div style="display:flex;gap:8px">
      <input type="text" id="s-yeni-sorumlu" placeholder="Ad Soyad" style="flex:1;background:var(--glass2);border:1px solid var(--border);border-radius:7px;padding:8px 11px;color:var(--ink);font-family:'DM Sans',sans-serif;font-size:12px;outline:none">
      <button class="btn btn-teal btn-sm" onclick="addSorumlu()">+ Ekle</button>
    </div>
    <div style="border-top:1px solid var(--border);margin:20px 0"></div>
    <div class="panel-title" style="margin-bottom:14px">ğŸ¦ Banka HesaplarÄ±</div>
    <div style="margin-bottom:10px;font-size:10px;color:var(--ink3)">Rezervasyon formlarÄ±nda banka seÃ§eneÄŸi olarak Ã§Ä±kar</div>
    <div id="s-bankalar-list" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px"></div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <input type="text" id="s-yeni-banka" placeholder="Banka adÄ± (Ã¶rn: Garanti Euro)" style="flex:1;min-width:180px;background:var(--glass2);border:1px solid var(--border);border-radius:7px;padding:8px 11px;color:var(--ink);font-family:'DM Sans',sans-serif;font-size:12px;outline:none">
      <button class="btn btn-teal btn-sm" onclick="addBanka()">+ Ekle</button>
    </div>
    <div style="border-top:1px solid var(--border);margin:20px 0"></div>
    <div class="panel-title" style="margin-bottom:14px">GÃ¶rÃ¼nÃ¼m</div>
    <div class="setting-row">
      <div class="sr-info"><div class="sr-lbl">Tema</div><div class="sr-sub">Gece / GÃ¼ndÃ¼z modu â€” sadece sizin hesabÄ±nÄ±zda deÄŸiÅŸir</div></div>
      <label class="theme-switch">
        <input type="checkbox" id="s-tema" onchange="toggleTheme(this.checked)">
        <span class="theme-slider"></span>
      </label>
      <span class="theme-lbl" id="s-tema-lbl" style="min-width:60px">ğŸŒ™ Gece</span>
    </div>
    <div style="border-top:1px solid var(--border);margin:20px 0"></div>
    <div class="panel-title" style="margin-bottom:14px">KullanÄ±cÄ± YÃ¶netimi</div>
    <div class="setting-row">
      <div class="sr-info">
        <div class="sr-lbl">KullanÄ±cÄ± Ekle / Sil</div>
        <div class="sr-sub">Firebase konsolundan kullanÄ±cÄ± yÃ¶netimi yapabilirsiniz</div>
      </div>
      <a href="https://console.firebase.google.com/project/simay-muhasebe/authentication/users" target="_blank" class="btn btn-ghost btn-sm">Firebase KullanÄ±cÄ±larÄ± â†’</a>
    </div>
    <div style="border-top:1px solid var(--border);margin:20px 0"></div>
    <div class="panel-title" style="margin-bottom:14px">Veri YÃ¶netimi</div>
    <div class="setting-row">
      <div class="sr-info"><div class="sr-lbl">TÃ¼m Verileri SÄ±fÄ±rla</div><div class="sr-sub">TÃ¼m satÄ±ÅŸ ve gider kayÄ±tlarÄ± silinir</div></div>
      <button class="btn btn-danger btn-sm" onclick="resetData()">SÄ±fÄ±rla</button>
    </div>
  </div>
</div>


<!-- â”€â”€â”€â”€â”€ FATURALAR â”€â”€â”€â”€â”€ -->
<div class="page" id="page-fatura">
  <div class="ph">
    <div class="ph-left"><h2>Faturalar</h2><p>Gelir & gider faturalarÄ±, Ã¶n muhasebe takibi</p></div>
    <div class="ph-actions">
      <button class="btn btn-ghost btn-sm" onclick="exportFaturaCSV()">â¬‡ Ä°ndir</button>
      <button class="btn btn-teal" onclick="openModal('modal-fatura','Yeni Fatura')">+ Fatura Ekle</button>
    </div>
  </div>
  <div class="kpi-grid" id="fatura-kpis" style="grid-template-columns:repeat(4,1fr)"></div>
  <div id="fatura-page-uyari" style="margin-bottom:16px"></div>
  <div class="filter-bar" id="fatura-filters"></div>
  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input class="search-input" id="fatura-search" placeholder="Fatura no, mÃ¼ÅŸteri veya aÃ§Ä±klama ara..." oninput="renderFatura()">
  </div>
  <div class="tbl-outer">
    <div class="tbl-scroll">
      <table>
        <thead><tr>
          <th>#</th><th>Fatura No</th><th>Tarih</th><th>Vade</th>
          <th>TÃ¼r</th><th>MÃ¼ÅŸteri</th><th>AÃ§Ä±klama</th>
          <th>Tutar</th><th>Para</th><th>KDV</th><th>Toplam</th>
          <th>Ã–deme</th><th>Fatura</th><th>Ä°ÅŸlem</th>
        </tr></thead>
        <tbody id="fatura-tbody"></tbody>
      </table>
    </div>
  </div>
  <div id="fatura-empty" style="display:none" class="empty-state"><div class="es-icon">ğŸ§¾</div><div class="es-text">HenÃ¼z fatura kaydÄ± yok.</div></div>
</div>


<!-- â”€â”€â”€â”€â”€ TÃœM SATIÅLAR â”€â”€â”€â”€â”€ -->
<div class="page" id="page-tum-satislar">
  <div class="ph">
    <div class="ph-left"><h2>TÃ¼m SatÄ±ÅŸlar</h2><p id="tum-satislar-sub">Simay + Acenta Â· TÃ¼m tutarlar â‚¬Euro cinsinden</p></div>
    <div class="ph-actions">
      <button class="btn btn-ghost btn-sm" onclick="exportTumSatislarCSV()">â¬‡ Ä°ndir</button>
    </div>
  </div>
  <div class="kpi-grid" id="tum-kpis" style="grid-template-columns:repeat(4,1fr)"></div>
  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input class="search-input" id="tum-search" placeholder="Misafir, tekne veya sorumlu ara..." oninput="renderTumSatislar()">
  </div>
  <div class="tbl-outer"><div class="tbl-scroll">
    <table>
      <thead><tr>
        <th>#</th><th>TÃ¼r</th><th>Misafir</th><th>Tekne</th>
        <th>GiriÅŸ LimanÄ±</th><th>Ã‡Ä±kÄ±ÅŸ LimanÄ±</th><th>Tur Tarihi</th><th>SÃ¼re</th>
        <th>Sorumlu</th><th>Tutar (â‚¬)</th><th>Orijinal</th>
      </tr></thead>
      <tbody id="tum-tbody"></tbody>
    </table>
  </div></div>
  <div id="tum-empty" style="display:none" class="empty-state"><div class="es-icon">ğŸ“‹</div><div class="es-text">HenÃ¼z satÄ±ÅŸ kaydÄ± yok.</div></div>
</div>

</main><!-- /main -->
</div><!-- /app -->


<!-- â•â•â•â•â•â•â•â•â•â•â• GÄ°RÄ°Å EKRANI â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-logo">
      <div class="login-icon">â›µ</div>
      <div class="login-title">Simay YatÃ§Ä±lÄ±k</div>
    </div>
    <div class="login-sub">MUHASEBE SÄ°STEMÄ° â€” GÄ°RÄ°Å YAPINIZ</div>
    <div class="login-field">
      <label>E-Posta</label>
      <input type="email" id="login-email" placeholder="ornek@email.com" autocomplete="email">
    </div>
    <div class="login-field">
      <label>Åifre</label>
      <input type="password" id="login-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
    </div>
    <button class="login-btn" id="login-btn">GiriÅŸ Yap</button>
    <div class="login-error" id="login-error">E-posta veya ÅŸifre hatalÄ±. LÃ¼tfen tekrar deneyin.</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â• -->

<!-- MODAL: SÄ°MAY -->
<div class="modal-bg" id="modal-simay">
  <div class="modal simay-modal">
    <div class="modal-hd">
      <div class="modal-title" id="modal-simay-title">Simay Tekneleri â€” Yeni SatÄ±ÅŸ</div>
      <button class="modal-close" onclick="closeModal('modal-simay')">âœ•</button>
    </div>

    <!-- BÃ–LÃœM 1: TUR BÄ°LGÄ°LERÄ° -->
    <div class="sm-section sm-section-teal">
      <div class="sm-section-hd">
        <div class="sm-section-icon sm-icon-teal">â›µ</div>
        <span class="sm-section-title sm-title-teal">Tur Bilgileri</span>
      </div>

      <div class="sm-row">
        <div class="fg sm-full">
          <label>Misafir AdÄ± SoyadÄ± <span class="req">*</span></label>
          <input type="text" id="fs-misafir" placeholder="Ad Soyad veya Firma" oninput="applyTitleCase(this)" autocomplete="off">
        </div>
      </div>

      <div class="sm-row">
        <div class="fg sm-full">
          <label>Tekne <span class="req">*</span></label>
          <select id="fs-tekne"></select>
        </div>
      </div>
      <div class="sm-row" style="align-items:flex-end">
        <div class="sm-date-group" style="flex:1">
          <div class="fg" style="flex:1">
            <label>BaÅŸlangÄ±Ã§</label>
            <input type="date" id="fs-giris" onchange="calcSimayGun();if(this.value){const c=document.getElementById('fs-cikis');c.min=this.value;c.focus();}">
          </div>
          <div class="sm-date-arrow">â†’</div>
          <div class="fg" style="flex:1">
            <label>BitiÅŸ</label>
            <input type="date" id="fs-cikis" onchange="calcSimayGun()">
          </div>
          <div class="sm-gun-chip-col">
            <div class="sm-gun-lbl">SÃ¼re</div>
            <div class="sm-gun-chip" id="fs-gun-chip">â€”</div>
          </div>
        </div>
      </div>
      <input type="hidden" id="fs-gun">
      <span id="fs-gun-lbl" style="display:none"></span>

      <div class="sm-row">
        <div class="fg sm-half">
          <label>GiriÅŸ LimanÄ±</label>
          <select id="fs-gliman">
            <option value="">â€” SeÃ§in â€”</option>
            <option>Fethiye</option><option>GÃ¶cek</option><option>Marmaris</option>
            <option>Selimiye</option><option>Bozburun</option><option>Bodrum</option>
            <option>KaÅŸ</option><option>Kekova</option><option>Demre</option>
          </select>
        </div>
        <div class="fg sm-half">
          <label>Ã‡Ä±kÄ±ÅŸ LimanÄ±</label>
          <select id="fs-climan">
            <option value="">â€” SeÃ§in â€”</option>
            <option>Fethiye</option><option>GÃ¶cek</option><option>Marmaris</option>
            <option>Selimiye</option><option>Bozburun</option><option>Bodrum</option>
            <option>KaÅŸ</option><option>Kekova</option><option>Demre</option>
          </select>
        </div>
      </div>

      <div class="sm-row">
        <div class="fg sm-half">
          <label>SatÄ±ÅŸ Sorumlusu</label>
          <select id="fs-sorumlu"><option value="">â€” SeÃ§in â€”</option></select>
        </div>
        <div class="fg sm-half">
          <label>Acenta SatÄ±ÅŸÄ±</label>
          <input type="text" id="fs-acente" placeholder="BoÅŸ = DoÄŸrudan SatÄ±ÅŸ">
        </div>
      </div>

      <div class="sm-row">
        <div class="fg sm-full">
          <label>AÃ§Ä±klama / Not</label>
          <textarea id="fs-aciklama" placeholder="Ek bilgiler, Ã¶zel istekler..." style="min-height:50px"></textarea>
        </div>
      </div>
    </div>

    <!-- BÃ–LÃœM 2: TUR SATIÅ BÄ°LGÄ°LERÄ° -->
    <div class="sm-section sm-section-gold">
      <div class="sm-section-hd">
        <div class="sm-section-icon sm-icon-gold">ğŸ’³</div>
        <span class="sm-section-title sm-title-gold">Tur SatÄ±ÅŸ Bilgileri</span>
      </div>

      <!-- Para birimi + Banka -->
      <div class="sm-row">
        <div class="fg sm-half">
          <label>Para Birimi</label>
          <select id="fs-para" onchange="onSimayParaDegis()">
            <option value="EUR">â‚¬ Euro</option>
            <option value="USD">$ Dolar</option>
            <option value="TRY">â‚º TÃ¼rk LirasÄ±</option>
          </select>
        </div>
        <div class="fg sm-half">
          <label>Ã–deme AlÄ±nan Banka</label>
          <select id="fs-banka"><option value="">â€” SeÃ§in â€”</option></select>
        </div>
      </div>

      <!-- USD bilgi -->
      <div id="fs-usd-info" class="sm-info-box" style="display:none">
        <span style="font-size:14px">ğŸ’±</span>
        <span>TCMB paritesine gÃ¶re raporda Euro'ya Ã§evrilecek. <strong id="fs-usd-rate-lbl"></strong></span>
      </div>

      <!-- Tur bedeli + KDV oranÄ± -->
      <div class="sm-row">
        <div class="fg sm-half">
          <label>Tur Bedeli <span class="req">*</span></label>
          <div class="sm-money-wrap">
            <span class="sm-currency" id="fs-bedel-prefix">â‚¬</span>
            <input type="number" id="fs-bedel" placeholder="0.00" oninput="calcSimayKdv()" class="sm-money-input">
          </div>
        </div>
        <div class="fg sm-half">
          <label>KDV OranÄ±</label>
          <select id="fs-kdv-oran" onchange="calcSimayKdv()">
            <option value="0">KDV Yok (%0)</option>
            <option value="10">%10</option>
            <option value="20">%20</option>
          </select>
        </div>
      </div>

      <!-- KDV tutarÄ± + KDV'li toplam -->
      <div class="sm-row">
        <div class="fg sm-half">
          <label>KDV TutarÄ± <span class="sm-auto-tag">Otomatik</span></label>
          <div class="sm-money-wrap">
            <span class="sm-currency sm-currency-gold" id="fs-kdv-tutar-prefix">â‚¬</span>
            <input type="number" id="fs-kdv-tutar" placeholder="â€”" readonly class="sm-money-input sm-readonly" style="color:var(--gold2)">
          </div>
        </div>
        <div class="fg sm-half">
          <label>KDV'li Toplam <span class="sm-auto-tag">Otomatik</span></label>
          <div class="sm-money-wrap">
            <span class="sm-currency sm-currency-teal" id="fs-kdvli-bedel-prefix">â‚¬</span>
            <input type="number" id="fs-kdvli-bedel" placeholder="â€”" readonly class="sm-money-input sm-readonly" style="color:var(--teal2);font-weight:700">
          </div>
        </div>
      </div>

      <!-- Ã–n Ã¶deme + Kalan -->
      <div class="sm-row">
        <div class="fg sm-half">
          <label>Ã–n Ã–deme</label>
          <div class="sm-money-wrap">
            <span class="sm-currency sm-currency-green" id="fs-on-prefix">â‚¬</span>
            <input type="number" id="fs-on" placeholder="0.00" oninput="calcSimayKalan()" class="sm-money-input">
          </div>
        </div>
        <div class="fg sm-half">
          <label>Kalan Tutar <span class="sm-auto-tag">Otomatik</span></label>
          <div class="sm-money-wrap">
            <span class="sm-currency sm-currency-red" id="fs-kalan-prefix">â‚¬</span>
            <input type="number" id="fs-kalan" placeholder="â€”" readonly class="sm-money-input sm-readonly" style="color:var(--red2)">
          </div>
        </div>
      </div>

      <!-- Ã–deme + Fatura durumu -->
      <div class="sm-status-bar">
        <div class="fg" style="flex:1">
          <label>Ã–deme Durumu</label>
          <select id="fs-odeme-durum">
            <option value="bekliyor">â³ Bekliyor</option>
            <option value="kismi">ğŸ”¶ KÄ±smi Ã–dendi</option>
            <option value="odendi">âœ… Ã–dendi</option>
            <option value="gecikti">ğŸ”´ Gecikti</option>
          </select>
        </div>
        <div class="sm-status-divider"></div>
        <div class="fg" style="flex:1">
          <label>Fatura Durumu</label>
          <select id="fs-fatura-durum">
            <option value="kesilmedi">âŒ Kesilmedi</option>
            <option value="kesildi">âœ… Kesildi</option>
          </select>
        </div>
      </div>
    </div>

    <div class="form-footer" style="margin-top:14px">
      <button class="btn btn-ghost" onclick="closeModal('modal-simay')">VazgeÃ§</button>
      <button class="btn btn-teal" onclick="saveSimay()">ğŸ’¾ Kaydet</button>
    </div>
    <input type="hidden" id="fs-id">
  </div>
</div>


<!-- MODAL: ACENTE -->
<div class="modal-bg" id="modal-acente">
  <div class="modal" style="max-width:720px">
    <div class="modal-hd">
      <div class="modal-title">Acenta / DÄ±ÅŸ SatÄ±ÅŸ â€” Yeni SatÄ±ÅŸ</div>
      <button class="modal-close" onclick="closeModal('modal-acente')">âœ•</button>
    </div>

    <!-- BÃ–LÃœM 1: TUR BÄ°LGÄ°LERÄ° -->
    <div style="background:rgba(26,74,122,0.07);border:1px solid rgba(96,165,250,0.18);border-radius:11px;padding:16px 18px;margin-bottom:14px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <div style="width:26px;height:26px;background:linear-gradient(135deg,#1a4a7a,#60a5fa);border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:13px">ğŸ¤</div>
        <span style="font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--blue2)">Tur Bilgileri</span>
      </div>
      <div class="form-grid">
        <div class="fg span2"><label>Misafir AdÄ± SoyadÄ± *</label><input type="text" id="fa-misafir" placeholder="Ad Soyad veya Firma" oninput="applyTitleCase(this)"></div>
        <div class="fg"><label>Tekne AdÄ± *</label><input type="text" id="fa-tekne" placeholder="By CF, MEÄ°RA..."></div>
        <div class="fg"><label>SatÄ±ÅŸ Sorumlusu</label><select id="fa-sorumlu"><option value="">-- SeÃ§in --</option></select></div>
        <div class="fg"><label>GiriÅŸ LimanÄ±</label>
          <select id="fa-gliman">
            <option value="">-- SeÃ§in --</option>
            <option>Fethiye</option><option>GÃ¶cek</option><option>Marmaris</option>
            <option>Selimiye</option><option>Bozburun</option><option>Bodrum</option>
            <option>KaÅŸ</option><option>Kekova</option><option>Demre</option>
          </select>
        </div>
        <div class="fg"><label>Ã‡Ä±kÄ±ÅŸ LimanÄ±</label>
          <select id="fa-climan">
            <option value="">-- SeÃ§in --</option>
            <option>Fethiye</option><option>GÃ¶cek</option><option>Marmaris</option>
            <option>Selimiye</option><option>Bozburun</option><option>Bodrum</option>
            <option>KaÅŸ</option><option>Kekova</option><option>Demre</option>
          </select>
        </div>
        <div class="fg"><label>Tur BaÅŸlangÄ±Ã§ Tarihi</label><input type="date" id="fa-giris" onchange="onAcentaGirisChange(this.value)"></div>
        <div class="fg"><label>Tur BitiÅŸ Tarihi</label><input type="date" id="fa-cikis"></div>
        <div class="fg span2"><label>AÃ§Ä±klama / Not</label><textarea id="fa-aciklama" style="min-height:56px"></textarea></div>
      </div>
    </div>

    <!-- BÃ–LÃœM 2: Ã–DEME BÄ°LGÄ°LERÄ° -->
    <div style="background:rgba(190,138,32,0.06);border:1px solid rgba(190,138,32,0.18);border-radius:11px;padding:16px 18px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px">
        <div style="width:26px;height:26px;background:linear-gradient(135deg,var(--gold),var(--gold2));border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:13px">ğŸ’³</div>
        <span style="font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--gold2)">Ã–deme Bilgileri</span>
      </div>
      <div class="form-grid">
        <div class="fg"><label>Para Birimi</label>
          <select id="fa-para" onchange="onAcentaParaDegis()">
            <option value="EUR">â‚¬ Euro</option>
            <option value="USD">$ Dolar</option>
            <option value="TRY">â‚º TÃ¼rk LirasÄ±</option>
          </select>
        </div>
        <div class="fg"><label>Ã–deme Durumu</label>
          <select id="fa-odeme-durum">
            <option value="bekliyor">â³ Ã–deme Bekliyor</option>
            <option value="kismi">ğŸ”¶ KÄ±smi Ã–dendi</option>
            <option value="odendi">âœ… Ã–dendi</option>
            <option value="gecikti">ğŸ”´ Gecikti</option>
          </select>
        </div>
        <div class="fg"><label>Ã–deme YapÄ±lan Banka</label>
          <select id="fa-banka"><option value="">-- Banka SeÃ§in --</option></select>
        </div>
        <div class="fg"><label>Fatura Durumu</label>
          <select id="fa-fatura-durum">
            <option value="kesilmedi">âŒ Fatura Kesilmedi</option>
            <option value="kesildi">âœ… Fatura Kesildi</option>
          </select>
        </div>
      </div>

      <!-- MÃ¼ÅŸteri Ã¶demeleri alt bÃ¶lÃ¼mÃ¼ -->
      <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(190,138,32,0.15)">
        <div style="font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:10px">ğŸ‘¤ MÃ¼ÅŸteri Ã–demeleri</div>
        <div class="form-grid">
          <div class="fg"><label>Toplam SatÄ±ÅŸ TutarÄ±</label>
            <div class="sm-money-wrap"><span class="sm-currency" id="fa-bedel-prefix">â‚¬</span><input type="number" id="fa-bedel" placeholder="0.00" oninput="calcAcenteAll()" class="sm-money-input"></div>
          </div>
          <div class="fg"><label>Ã–n Ã–deme TutarÄ±</label>
            <div class="sm-money-wrap"><span class="sm-currency sm-currency-teal" id="fa-on-prefix">â‚¬</span><input type="number" id="fa-on" placeholder="0.00" oninput="calcAcenteAll()" class="sm-money-input"></div>
          </div>
          <div class="fg"><label>Kalan Ã–deme</label>
            <div class="sm-money-wrap"><span class="sm-currency sm-currency-red" id="fa-kalan-prefix">â‚¬</span><input type="number" id="fa-kalan" placeholder="Otomatik" readonly class="sm-money-input sm-readonly" style="color:var(--blue2)"></div>
          </div>
        </div>
      </div>

      <!-- Tekne Ã¶demeleri alt bÃ¶lÃ¼mÃ¼ -->
      <div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(190,138,32,0.15)">
        <div style="font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:10px">â›µ Tekne Ã–demeleri</div>
        <div class="form-grid">
          <div class="fg"><label>Tekne Toplam Ã–deme</label>
            <div class="sm-money-wrap"><span class="sm-currency" id="fa-todeme-prefix">â‚¬</span><input type="number" id="fa-todeme" placeholder="0.00" oninput="calcAcenteAll()" class="sm-money-input"></div>
          </div>
          <div class="fg"><label>Tekneye Ã–n Ã–deme</label>
            <div class="sm-money-wrap"><span class="sm-currency sm-currency-teal" id="fa-ton-prefix">â‚¬</span><input type="number" id="fa-ton" placeholder="0.00" oninput="calcAcenteAll()" class="sm-money-input"></div>
          </div>
          <div class="fg"><label>Tekneye Kalan</label>
            <div class="sm-money-wrap"><span class="sm-currency sm-currency-gold" id="fa-tkalan-prefix">â‚¬</span><input type="number" id="fa-tkalan" placeholder="Otomatik" readonly class="sm-money-input sm-readonly" style="color:var(--gold2)"></div>
          </div>
          <div class="fg"><label>ğŸ’° Åirket KÃ¢rÄ± (Otomatik)</label>
            <div class="sm-money-wrap"><span class="sm-currency sm-currency-green" id="fa-kar-prefix">â‚¬</span><input type="number" id="fa-kar" placeholder="Toplam âˆ’ Tekne" class="sm-money-input sm-readonly" style="color:var(--green2);font-weight:600" readonly></div>
          </div>
        </div>
      </div>
    </div>

    <div class="form-footer" style="margin-top:14px">
      <button class="btn btn-ghost" onclick="closeModal('modal-acente')">VazgeÃ§</button>
      <button class="btn btn-gold" onclick="saveAcente()">ğŸ’¾ Kaydet</button>
    </div>
    <input type="hidden" id="fa-id">
  </div>
</div>

<!-- MODAL: GÄ°DER -->
<div class="modal-bg" id="modal-gider">
  <div class="modal" style="max-width:440px">
    <div class="modal-hd">
      <div class="modal-title" id="modal-gider-title">Gider Ekle</div>
      <button class="modal-close" onclick="closeModal('modal-gider')">âœ•</button>
    </div>
    <div class="form-grid">
      <div class="fg"><label>Gider TÃ¼rÃ¼</label>
        <select id="fg-tip">
          <option value="simay">â›µ Simay Tekneleri</option>
          <option value="acenta">ğŸ¤ Acenta</option>
        </select>
      </div>
      <div class="fg"><label>Tarih *</label><input type="date" id="fg-tarih"></div>
      <div class="fg"><label>Kategori</label>
        <select id="fg-kat">
          <option>Personel</option><option>Tekne BakÄ±m & OnarÄ±m</option>
          <option>YakÄ±t</option><option>Liman & Marinalar</option>
          <option>Sigorta</option><option>Ofis & Genel</option>
          <option>Pazarlama</option><option>Vergi & Mali</option>
          <option>DiÄŸer</option>
        </select>
      </div>
      <div class="fg span2"><label>AÃ§Ä±klama</label><input type="text" id="fg-acik" placeholder="Gider aÃ§Ä±klamasÄ±"></div>
      <div class="fg"><label>Para Birimi</label>
        <select id="fg-para" onchange="toggleGiderPara()">
          <option value="EUR">â‚¬ Euro</option>
          <option value="TRY">â‚º TÃ¼rk LirasÄ±</option>
        </select>
      </div>
      <div class="fg"><label id="fg-tutar-lbl">Tutar (â‚¬) *</label><input type="number" id="fg-tutar" placeholder="0" oninput="calcGiderEur()"></div>
      <div class="fg" id="fg-kur-wrap" style="display:none">
        <label>TCMB EUR/TRY Kuru</label>
        <div style="display:flex;gap:6px;align-items:center">
          <input type="number" id="fg-kur" placeholder="Otomatik yÃ¼kleniyor..." oninput="calcGiderEur()" style="flex:1">
          <button type="button" onclick="fetchKur()" class="btn btn-ghost btn-sm" style="white-space:nowrap">â†» Kur Al</button>
        </div>
      </div>
      <div class="fg" id="fg-eur-wrap" style="display:none">
        <label>Euro KarÅŸÄ±lÄ±ÄŸÄ± (â‚¬)</label>
        <input type="number" id="fg-eur" placeholder="Otomatik" readonly class="calc-result" style="color:var(--teal2)">
      </div>
    </div>
    <div class="form-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-gider')">VazgeÃ§</button>
      <button class="btn btn-danger" onclick="saveGider()">ğŸ’¾ Kaydet</button>
    </div>
    <input type="hidden" id="fg-id">
  </div>
</div>


<!-- MODAL: DETAY -->
<div class="modal-bg" id="modal-detay">
  <div class="modal" style="max-width:680px">
    <div class="modal-hd">
      <div class="modal-title" id="modal-detay-title">Rezervasyon DetayÄ±</div>
      <button class="modal-close" onclick="closeModal('modal-detay')">âœ•</button>
    </div>
    <div id="modal-detay-content"></div>
    <div class="form-footer" style="justify-content:space-between">
      <button class="btn btn-ghost" onclick="closeModal('modal-detay')">Kapat</button>
    </div>
  </div>
</div>

<!-- MODAL: FATURA -->
<div class="modal-bg" id="modal-fatura">
  <div class="modal" style="max-width:700px">
    <div class="modal-hd">
      <div class="modal-title" id="modal-fatura-title">Yeni Fatura</div>
      <button class="modal-close" onclick="closeModal('modal-fatura')">âœ•</button>
    </div>
    <div class="form-grid">
      <div class="fg"><label>Fatura No *</label><input type="text" id="ff-no" placeholder="SIM-2026-001"></div>
      <div class="fg"><label>Fatura TÃ¼rÃ¼</label>
        <select id="ff-tur">
          <option value="gelir">ğŸ“¥ Gelir FaturasÄ± (SatÄ±ÅŸ)</option>
          <option value="gider">ğŸ“¤ Gider FaturasÄ± (AlÄ±ÅŸ)</option>
        </select>
      </div>
      <div class="fg"><label>Tarih *</label><input type="date" id="ff-tarih"></div>
      <div class="fg"><label>Vade Tarihi</label><input type="date" id="ff-vade"></div>
      <div class="fg span2"><label>MÃ¼ÅŸteri / TedarikÃ§i *</label><input type="text" id="ff-musteri" placeholder="Firma veya kiÅŸi adÄ±"></div>
      <div class="fg span2"><label>AÃ§Ä±klama</label><input type="text" id="ff-aciklama" placeholder="Hizmet/Ã¼rÃ¼n aÃ§Ä±klamasÄ±"></div>
      <div class="fg"><label>Tutar *</label><input type="number" id="ff-tutar" placeholder="0" oninput="calcFaturaKdv()"></div>
      <div class="fg"><label>Para Birimi</label>
        <select id="ff-para">
          <option value="EUR">â‚¬ Euro</option>
          <option value="USD">$ Dolar</option>
          <option value="TRY">â‚º TÃ¼rk LirasÄ±</option>
        </select>
      </div>
      <div class="fg"><label>KDV OranÄ±</label>
        <select id="ff-kdv-oran" onchange="calcFaturaKdv()">
          <option value="0">KDV Yok</option>
          <option value="10">%10</option>
          <option value="20">%20</option>
        </select>
      </div>
      <div class="fg"><label>KDV TutarÄ± (â‚¬)</label><input type="number" id="ff-kdv-tutar" readonly class="calc-result" style="color:var(--gold2)"></div>
      <div class="fg"><label>Toplam (â‚¬)</label><input type="number" id="ff-toplam" readonly class="calc-result"></div>
      <div class="fg"><label>Ã–deme Durumu</label>
        <select id="ff-durum">
          <option value="bekliyor">â³ Ã–deme Bekliyor</option>
          <option value="kismi">ğŸ”¶ KÄ±smi Ã–dendi</option>
          <option value="odendi">âœ… Ã–dendi</option>
          <option value="gecikti">ğŸ”´ Gecikti</option>
          <option value="iptal">âŒ Ä°ptal</option>
        </select>
      </div>
      <div class="fg"><label>Fatura Kesim Durumu</label>
        <select id="ff-kesim-durum">
          <option value="kesilmedi">âŒ Fatura Kesilmedi</option>
          <option value="kesildi">âœ… Fatura Kesildi</option>
        </select>
      </div>
      <div class="fg"><label>Ã–denen Tutar (â‚¬)</label><input type="number" id="ff-odenen" placeholder="0" oninput="calcFaturaKalan()"></div>
      <div class="fg"><label>Kalan (â‚¬)</label><input type="number" id="ff-kalan" readonly class="calc-result" style="color:var(--red2)"></div>
      <div class="fg"><label>Ä°liÅŸkili Rezervasyon</label><input type="text" id="ff-rezervasyon" placeholder="Misafir adÄ± veya rez. no (opsiyonel)"></div>
      <div class="fg span2"><label>Not</label><textarea id="ff-not" placeholder="Ek bilgiler..."></textarea></div>
    </div>
    <div class="form-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-fatura')">VazgeÃ§</button>
      <button class="btn btn-teal" onclick="saveFatura()">ğŸ’¾ Kaydet</button>
    </div>
    <input type="hidden" id="ff-id">
  </div>
</div>

<!-- TOASTS -->
<div id="toasts"></div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FIREBASE SETUP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const firebaseConfig = {
  apiKey: "AIzaSyDNvIMmZVhp39pBWxcVEqajZoVjzg--eQM",
  authDomain: "simay-muhasebe.firebaseapp.com",
  projectId: "simay-muhasebe",
  storageBucket: "simay-muhasebe.firebasestorage.app",
  messagingSenderId: "430707421784",
  appId: "1:430707421784:web:bf169fe990791fa500902d"
};

firebase.initializeApp(firebaseConfig);
const fbdb = firebase.firestore();
const auth = firebase.auth();
const DOC_REF = fbdb.collection('muhasebe').doc('main'); // legacy

// YÃ¼kleme gÃ¶stergesi
function showLoading(){
  let el = document.getElementById('fb-loading');
  if(!el){
    el = document.createElement('div');
    el.id = 'fb-loading';
    el.style.cssText = 'position:fixed;inset:0;background:rgba(11,22,35,0.95);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;font-family:DM Sans,sans-serif';
    el.innerHTML = '<div style="width:44px;height:44px;border:3px solid rgba(255,255,255,0.08);border-top-color:#18b4a2;border-radius:50%;animation:fbspin .8s linear infinite"></div><div style="color:#8aa0b4;font-size:13px">Veriler yÃ¼kleniyor...</div>';
    const style = document.createElement('style');
    style.textContent = '@keyframes fbspin{to{transform:rotate(360deg)}}';
    document.head.appendChild(style);
    document.body.appendChild(el);
  }
  el.style.display = 'flex';
}
function hideLoading(){ const el=document.getElementById('fb-loading'); if(el) el.style.display='none'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA STORE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const STORE_KEY = 'simay_muhsb_v2';

function defaultDB(){
  return {
    cfg: { yil:2026, hedef:1200000, gider_b:0, tekneler:'SÄ°MAY M,SÄ°MAY F,SÄ°MAY S,JR. SÄ°MAY' },
    simay: [],
    acente: [],
    giderler: []
  };
}

// YÄ±la gÃ¶re Firestore doc ref
function getDocRef(yil){
  return fbdb.collection('muhasebe').doc('yil_' + (yil || activeYil));
}

let activeYil = new Date().getFullYear();
let isReadOnly = false;



async function dbLoad(yil){
  const y = yil || activeYil;
  const ref = getDocRef(y);
  try {
    const snap = await ref.get();
    if(snap.exists){
      return snap.data();
    } else {
      // legacy: ilk yÄ±lda eski 'main' dokÃ¼manÄ±na bak
      if(!yil){
        const legSnap = await DOC_REF.get();
        if(legSnap.exists){
          const d = legSnap.data();
          d.cfg = d.cfg || {};
          d.cfg.yil = y;
          await ref.set(JSON.parse(JSON.stringify(d)));
          setTimeout(()=>toast('Veriler ' + y + ' yÄ±lÄ±na taÅŸÄ±ndÄ± âœ“'),1000);
          return d;
        }
      }
      const db2 = defaultDB();
      db2.cfg.yil = y;
      return db2;
    }
  } catch(e){
    console.error('Firebase yÃ¼kleme hatasÄ±:', e);
    try { return JSON.parse(localStorage.getItem(STORE_KEY+'_'+y)) || defaultDB(); } catch(e2){ return defaultDB(); }
  }
}

async function dbSave(d){
  if(isReadOnly){ toast('GeÃ§miÅŸ yÄ±l â€” salt okunur mod, deÄŸiÅŸiklik yapÄ±lamaz','err'); return; }
  const ref = getDocRef(activeYil);
  try {
    await ref.set(JSON.parse(JSON.stringify(d)));
    localStorage.setItem(STORE_KEY+'_'+activeYil, JSON.stringify(d));
  } catch(e){
    console.error('Firebase kayÄ±t hatasÄ±:', e);
    localStorage.setItem(STORE_KEY+'_'+activeYil, JSON.stringify(d));
    toast('Ä°nternet baÄŸlantÄ±sÄ± yok â€” yerel kaydedildi','info');
  }
}
async function switchYear(yil){
  yil = parseInt(yil);
  const currentYear = new Date().getFullYear();
  if(yil > currentYear){
    if(!confirm(yil + ' yÄ±lÄ±na geÃ§mek istiyor musunuz? Bu yÄ±l iÃ§in yeni boÅŸ bir kayÄ±t oluÅŸturulacak.')){ 
      document.getElementById('yil-selector').value = activeYil;
      return; 
    }
  }
  activeYil = yil;
  isReadOnly = yil < currentYear;
  // Filtreleri sÄ±fÄ±rla
  simayFilter = 'all';
  acenteFilter = 'all';
  showLoading();
  DB = await dbLoad(yil);
  buildTekneSelect();
  buildSorumluSelect();
  await updateSidebar();
  await refreshCurrentPage();
  hideLoading();
  updateYilSelector();
  if(isReadOnly) toast(yil + ' â€” Salt Okunur Mod (geÃ§miÅŸ yÄ±l)','info');
  else toast(yil + ' yÄ±lÄ± yÃ¼klendi âœ“');
}

async function getAvailableYears(){
  // Mevcut yÄ±l + Ã¶nceki 3 yÄ±l + sonraki 1 yÄ±l
  const current = new Date().getFullYear();
  const years = [];
  for(let y = current-3; y <= current+1; y++) years.push(y);
  return years;
}

function updateYilSelector(){
  const sel = document.getElementById('yil-selector');
  if(sel) sel.value = activeYil;
  const selSb = document.getElementById('yil-selector-sb');
  if(selSb) selSb.value = activeYil;
  // Banner yÄ±l gÃ¶stergesi
  const bannerDisplay = document.getElementById('yil-banner-display');
  if(bannerDisplay) bannerDisplay.textContent = activeYil;
  // Readonly badge
  const badge = document.getElementById('readonly-badge');
  if(badge) badge.style.display = isReadOnly ? 'inline-flex' : 'none';
}

let DB = defaultDB();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,5);
const money = v => 'â‚¬' + Number(v||0).toLocaleString('tr-TR', {minimumFractionDigits:0, maximumFractionDigits:0});
const moneyN = v => Number(v||0).toLocaleString('tr-TR');
const MONTHS = ['','Oca','Åub','Mar','Nis','May','Haz','Tem','AÄŸu','Eyl','Eki','Kas','Ara'];
const MONTHS_FULL = ['','Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];

function getMonth(d){ return d ? parseInt(d.split('-')[1]) : 0; }
function daysBetween(a,b){ if(!a||!b) return 0; return Math.round((new Date(b)-new Date(a))/86400000); }
function fmtDate(d){ if(!d) return 'â€”'; return d.split('-').reverse().join('.'); }
function today(){ return new Date().toISOString().split('T')[0]; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.sb-item').forEach(item => {
  item.addEventListener('click', async () => {
    const pg = item.dataset.page;
    document.querySelectorAll('.sb-item').forEach(i=>i.classList.remove('active'));
    item.classList.add('active');
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById('page-'+pg).classList.add('active');
    await renderPage(pg);
  });
});

async function renderPage(pg){
  if(pg==='dashboard') await renderDashboard();
  else if(pg==='tum-satislar') await renderTumSatislar();
  else if(pg==='rezervasyon') await renderRezervasyonPage();
  else if(pg==='simay') { simayFilter='all'; buildSimayFilters(); await renderSimayKPIs(); await renderSimayTable(); }
  else if(pg==='acente') { acenteFilter='all'; buildAcenteFilters(); await renderAcenteKPIs(); await renderAcenteTable(); }
  else if(pg==='gider') await renderGider('all');
  else if(pg==='gider-simay') await renderGider('simay');
  else if(pg==='gider-acenta') await renderGider('acenta');
  else if(pg==='raporlar') await renderRaporlar();
  else if(pg==='fatura') await renderFatura();
  else if(pg==='ayarlar') await loadSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id, title){
  if(id === 'modal-simay' || id === 'modal-acente'){
    buildSorumluSelect();
    buildAllBankaSelects();
  }
  if(title) document.getElementById(id+'-title') && (document.getElementById(id+'-title').textContent = title);
  document.getElementById(id).classList.add('open');
}
function closeModal(id){ document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-bg').forEach(bg => {
  bg.addEventListener('click', e => { if(e.target===bg) bg.classList.remove('open'); });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type='ok'){
  const c = document.getElementById('toasts');
  const t = document.createElement('div');
  t.className = 'toast '+type;
  t.textContent = (type==='ok'?'âœ“ ':type==='err'?'âœ— ':'â„¹ ') + msg;
  c.appendChild(t);
  requestAnimationFrame(()=>t.classList.add('show'));
  setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(),280); }, 2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FORM HELPERS â€” SIMAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Title case â€” her kelimenin ilk harfini bÃ¼yÃ¼k yap
function applyTitleCase(el){
  // Her kelimenin ilk harfi bÃ¼yÃ¼k, geri kalanÄ± kÃ¼Ã§Ã¼k (Caps Lock korumasÄ±)
  const pos = el.selectionStart;
  const val = el.value;
  const result = val.replace(/\S+/g, w =>
    w.charAt(0).toLocaleUpperCase('tr-TR') + w.slice(1).toLocaleLowerCase('tr-TR')
  );
  if(result !== val){
    el.value = result;
    try{ el.setSelectionRange(pos, pos); } catch(e){}
  }
}

// Para birimi deÄŸiÅŸince sembolleri gÃ¼ncelle
const PARA_SIMGE_MAP = {EUR:'â‚¬', USD:'$', TRY:'â‚º'};
function onSimayParaDegis(){
  const para = document.getElementById('fs-para')?.value || 'EUR';
  const simge = PARA_SIMGE_MAP[para] || 'â‚¬';
  ['fs-bedel-prefix','fs-kdv-tutar-prefix','fs-kdvli-bedel-prefix','fs-on-prefix','fs-kalan-prefix'].forEach(id => {
    const el = document.getElementById(id);
    if(el) el.textContent = simge;
  });
  // USD bilgi kutusu
  const usdInfo = document.getElementById('fs-usd-info');
  if(usdInfo){
    if(para === 'USD'){
      usdInfo.style.display = 'flex';
      if(!DB.cfg?.usdEurRate) fetchUsdEurRate();
    } else {
      usdInfo.style.display = 'none';
    }
  }
  calcSimayKdv();
}

function calcSimayGun(){
  const g = document.getElementById('fs-giris').value;
  const c = document.getElementById('fs-cikis').value;
  const d = daysBetween(g,c);
  const chip = document.getElementById('fs-gun-chip');
  const hidden = document.getElementById('fs-gun');
  if(d > 0){
    if(chip) chip.textContent = d + ' gece';
    if(hidden) hidden.value = d + ' gece';
  } else {
    if(chip) chip.textContent = 'â€”';
    if(hidden) hidden.value = '';
  }
  const lbl = document.getElementById('fs-gun-lbl');
  if(lbl) lbl.textContent = '';
}
async function fetchUsdEurRate(){
  // USD/EUR oranÄ±nÄ± DB.cfg'ye kaydet (ve formdaki info box'Ä± gÃ¼ncelle)
  try {
    const res = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
    if(res.ok){
      const data = await res.json();
      const eurRate = data.rates && data.rates.EUR;
      if(eurRate){
        DB.cfg = DB.cfg || {};
        DB.cfg.usdEurRate = eurRate;
        const infoEl = document.getElementById('fs-usd-info');
        if(infoEl) infoEl.textContent = `ğŸ’± TCMB USD/EUR paritesi: 1 USD = ${eurRate.toFixed(4)} EUR â€” Raporda otomatik Euro'ya Ã§evrilecek.`;
        return;
      }
    }
  } catch(e){}
}

function calcSimayKdv(){
  const b = parseFloat(document.getElementById('fs-bedel').value)||0;
  const oran = parseFloat(document.getElementById('fs-kdv-oran').value)||0;
  const kdv = b * oran / 100;
  const kdvli = b + kdv;
  document.getElementById('fs-kdv-tutar').value = kdv>0 ? kdv.toFixed(2) : '';
  document.getElementById('fs-kdvli-bedel').value = b>0 ? kdvli.toFixed(2) : '';
  calcSimayKalan();
}
function calcSimayKalan(){
  const kdvli = parseFloat(document.getElementById('fs-kdvli-bedel').value)||0;
  const b = parseFloat(document.getElementById('fs-bedel').value)||0;
  const base = kdvli > 0 ? kdvli : b;
  const o = parseFloat(document.getElementById('fs-on').value)||0;
  document.getElementById('fs-kalan').value = base>0 ? (base-o).toFixed(2) : '';
}

function buildTekneSelect(){
  const opts = (DB.cfg.tekneler||'').split(',').map(t=>t.trim()).filter(Boolean);
  const sel = document.getElementById('fs-tekne');
  sel.innerHTML = opts.map(t=>`<option value="${t}">${t}</option>`).join('');
}

function clearSimayForm(){
  ['fs-misafir','fs-giris','fs-cikis','fs-gun','fs-bedel','fs-on','fs-kalan','fs-kdv-tutar','fs-kdvli-bedel','fs-sorumlu','fs-aciklama','fs-acente','fs-id'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.value='';
  });
  document.getElementById('fs-gliman').value='';
  document.getElementById('fs-climan').value='';
  document.getElementById('fs-kdv-oran').value='0';
  const fp=document.getElementById('fs-para'); if(fp){ fp.value='EUR'; onSimayParaDegis(); }
  const fo=document.getElementById('fs-odeme-durum'); if(fo) fo.value='bekliyor';
  const fb=document.getElementById('fs-banka'); if(fb) fb.value='';
  const ff=document.getElementById('fs-fatura-durum'); if(ff) ff.value='kesilmedi';
}

function editSimayForm(id){
  const r = DB.simay.find(x=>x.id===id); if(!r) return;
  buildTekneSelect();
  document.getElementById('fs-id').value = r.id;
  document.getElementById('fs-misafir').value = r.misafir||'';
  document.getElementById('fs-tekne').value = r.tekne||'';
  document.getElementById('fs-gliman').value = r.gliman||'';
  document.getElementById('fs-giris').value = r.giris||'';
  document.getElementById('fs-climan').value = r.climan||'';
  document.getElementById('fs-cikis').value = r.cikis||'';
  document.getElementById('fs-bedel').value = r.bedel||'';
  document.getElementById('fs-kdv-oran').value = r.kdvOran||0;
  document.getElementById('fs-kdv-tutar').value = r.kdvTutar||'';
  document.getElementById('fs-kdvli-bedel').value = r.kdvliBedel||'';
  document.getElementById('fs-on').value = r.on||'';
  document.getElementById('fs-kalan').value = r.kalan||'';
  document.getElementById('fs-sorumlu').value = r.sorumlu||'';
  document.getElementById('fs-acente').value = r.acente||'';
  document.getElementById('fs-aciklama').value = r.aciklama||'';
  const fp=document.getElementById('fs-para'); if(fp){ fp.value=r.para||'EUR'; onSimayParaDegis(); }
  const fo=document.getElementById('fs-odeme-durum'); if(fo) fo.value=r.odemeDurum||'bekliyor';
  const fb=document.getElementById('fs-banka'); if(fb){ buildBankaSelect('fs-banka'); fb.value=r.banka||''; }
  const ff=document.getElementById('fs-fatura-durum'); if(ff) ff.value=r.faturaDurum||'kesilmedi';
  calcSimayGun(); calcSimayKdv();
  buildSorumluSelect();
  openModal('modal-simay','Simay â€” KaydÄ± DÃ¼zenle');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FORM HELPERS â€” ACENTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcAcenteAll(){
  const b = parseFloat(document.getElementById('fa-bedel').value)||0;
  const on = parseFloat(document.getElementById('fa-on').value)||0;
  const t = parseFloat(document.getElementById('fa-todeme').value)||0;
  const ton = parseFloat(document.getElementById('fa-ton').value)||0;
  document.getElementById('fa-kalan').value = b>0 ? (b-on).toFixed(2) : '';
  document.getElementById('fa-tkalan').value = t>0 ? (t-ton).toFixed(2) : '';
  if(b>0 && t>=0) document.getElementById('fa-kar').value = (b-t).toFixed(2);
}
// legacy alias
const calcAcenteKar = calcAcenteAll;

function clearAcenteForm(){
  ['fa-misafir','fa-tekne','fa-giris','fa-cikis','fa-bedel','fa-on','fa-kalan','fa-todeme','fa-ton','fa-tkalan','fa-kar','fa-sorumlu','fa-aciklama','fa-id'].forEach(id=>{
    const el = document.getElementById(id); if(el) el.value='';
  });
  document.getElementById('fa-gliman').value='';
  document.getElementById('fa-climan').value='';
  const fp=document.getElementById('fa-para'); if(fp) fp.value='EUR';
  const fo=document.getElementById('fa-odeme-durum'); if(fo) fo.value='bekliyor';
  const fb=document.getElementById('fa-banka'); if(fb) fb.value='';
  const ff=document.getElementById('fa-fatura-durum'); if(ff) ff.value='kesilmedi';
}
function editAcenteForm(id){
  const r = DB.acente.find(x=>x.id===id); if(!r) return;
  document.getElementById('fa-id').value = r.id;
  document.getElementById('fa-misafir').value = r.misafir||'';
  document.getElementById('fa-tekne').value = r.tekne||'';
  document.getElementById('fa-gliman').value = r.gliman||'';
  document.getElementById('fa-climan').value = r.climan||'';
  document.getElementById('fa-giris').value = r.giris||'';
  document.getElementById('fa-cikis').value = r.cikis||'';
  document.getElementById('fa-bedel').value = r.bedel||'';
  document.getElementById('fa-on').value = r.on||'';
  document.getElementById('fa-kalan').value = r.kalan||'';
  document.getElementById('fa-todeme').value = r.todeme||'';
  document.getElementById('fa-ton').value = r.ton||'';
  document.getElementById('fa-tkalan').value = r.tkalan||'';
  document.getElementById('fa-kar').value = r.kar||'';
  document.getElementById('fa-sorumlu').value = r.sorumlu||'';
  document.getElementById('fa-aciklama').value = r.aciklama||'';
  const fp=document.getElementById('fa-para'); if(fp) fp.value=r.para||'EUR';
  const fo=document.getElementById('fa-odeme-durum'); if(fo) fo.value=r.odemeDurum||'bekliyor';
  const fb=document.getElementById('fa-banka'); if(fb){ buildBankaSelect('fa-banka'); fb.value=r.banka||''; }
  const ff=document.getElementById('fa-fatura-durum'); if(ff) ff.value=r.faturaDurum||'kesilmedi';
  buildSorumluSelect();
  openModal('modal-acente','Acenta â€” KaydÄ± DÃ¼zenle');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SAVE OPERATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function saveSimay(){
  if(isReadOnly){ toast('GeÃ§miÅŸ yÄ±l â€” kayÄ±t eklenemez','err'); closeModal('modal-simay'); return; }
  const id = document.getElementById('fs-id').value;
  const kdvOran = parseFloat(document.getElementById('fs-kdv-oran').value)||0;
  const bedel = parseFloat(document.getElementById('fs-bedel').value)||0;
  const kdvTutar = bedel * kdvOran / 100;
  const para = document.getElementById('fs-para')?.value || 'EUR';

  // USD â†’ EUR dÃ¶nÃ¼ÅŸÃ¼mÃ¼: kaydedilirken gÃ¼ncel kur kullan (varsa)
  let bedelEur = bedel + kdvTutar;
  if(para === 'USD'){
    const usdEurRate = DB.cfg?.usdEurRate || 0;
    if(usdEurRate > 0) bedelEur = (bedel + kdvTutar) * usdEurRate;
    // Yoksa ham tutarÄ± yine de sakla; raporlarda gÃ¶rÃ¼nÃ¼r
  }

  // Misafir adÄ±: title case uygula (boÅŸluk sonrasÄ± ilk harfler bÃ¼yÃ¼k)
  const misafirRaw = document.getElementById('fs-misafir').value.trim();
  const misafir = misafirRaw.replace(/(^|\s)(\S)/g, (m, space, ch) => space + ch.toLocaleUpperCase('tr-TR'));

  const r = {
    id: id||uid(), ts: Date.now(),
    misafir,
    tekne: document.getElementById('fs-tekne').value,
    gliman: document.getElementById('fs-gliman').value.trim(),
    giris: document.getElementById('fs-giris').value,
    climan: document.getElementById('fs-climan').value.trim(),
    cikis: document.getElementById('fs-cikis').value,
    bedel,
    kdvOran,
    kdvTutar,
    kdvliBedel: bedel + kdvTutar,
    bedelEur, // EUR cinsinden tutar (raporlar iÃ§in)
    on: parseFloat(document.getElementById('fs-on').value)||0,
    kalan: parseFloat(document.getElementById('fs-kalan').value)||0,
    sorumlu: document.getElementById('fs-sorumlu').value.trim(),
    acente: document.getElementById('fs-acente').value.trim(),
    aciklama: document.getElementById('fs-aciklama').value.trim(),
    para,
    odemeDurum: document.getElementById('fs-odeme-durum')?.value || 'bekliyor',
    banka: document.getElementById('fs-banka')?.value || '',
    faturaDurum: document.getElementById('fs-fatura-durum')?.value || 'kesilmedi',
  };
  if(!r.misafir || !r.tekne || !r.giris){ toast('Misafir, tekne ve giriÅŸ tarihi zorunlu','err'); return; }
  const isNew = !id;
  if(id){ DB.simay = DB.simay.map(x=>x.id===id?r:x); toast('KayÄ±t gÃ¼ncellendi'); }
  else { DB.simay.push(r); toast('Simay satÄ±ÅŸÄ± eklendi'); }
  // Otomatik fatura oluÅŸtur
  if(isNew){ autoCreateFatura(r, 'simay'); }
  await dbSave(DB); closeModal('modal-simay'); clearSimayForm();
  simayFilter='all';
  await updateSidebar(); await refreshCurrentPage();
}

async function saveAcente(){
  if(isReadOnly){ toast('GeÃ§miÅŸ yÄ±l â€” kayÄ±t eklenemez','err'); closeModal('modal-acente'); return; }
  const id = document.getElementById('fa-id').value;
  const bedel = parseFloat(document.getElementById('fa-bedel').value)||0;
  const on = parseFloat(document.getElementById('fa-on').value)||0;
  const todeme = parseFloat(document.getElementById('fa-todeme').value)||0;
  const ton = parseFloat(document.getElementById('fa-ton').value)||0;
  const karRaw = parseFloat(document.getElementById('fa-kar').value);
  const kar = isNaN(karRaw) ? bedel-todeme : karRaw;
  const r = {
    id: id||uid(), ts: Date.now(),
    misafir: document.getElementById('fa-misafir').value.trim(),
    tekne: document.getElementById('fa-tekne').value.trim(),
    gliman: document.getElementById('fa-gliman').value.trim(),
    climan: document.getElementById('fa-climan').value.trim(),
    giris: document.getElementById('fa-giris').value,
    cikis: document.getElementById('fa-cikis').value,
    bedel, on, kalan: bedel-on,
    todeme, ton, tkalan: todeme-ton,
    kar,
    sorumlu: document.getElementById('fa-sorumlu').value.trim(),
    aciklama: document.getElementById('fa-aciklama').value.trim(),
    para: document.getElementById('fa-para')?.value || 'EUR',
    odemeDurum: document.getElementById('fa-odeme-durum')?.value || 'bekliyor',
    banka: document.getElementById('fa-banka')?.value || '',
    faturaDurum: document.getElementById('fa-fatura-durum')?.value || 'kesilmedi',
  };
  if(!r.misafir || !r.tekne){ toast('Misafir ve tekne adÄ± zorunlu','err'); return; }
  const isNew = !id;
  if(id){ DB.acente = DB.acente.map(x=>x.id===id?r:x); toast('KayÄ±t gÃ¼ncellendi'); }
  else { DB.acente.push(r); toast('Acente satÄ±ÅŸÄ± eklendi'); }
  // Otomatik fatura oluÅŸtur
  if(isNew){ autoCreateFatura(r, 'acente'); }
  await dbSave(DB); closeModal('modal-acente'); clearAcenteForm();
  acenteFilter='all';
  await updateSidebar(); await refreshCurrentPage();
}

async function saveGider(){
  if(isReadOnly){ toast('GeÃ§miÅŸ yÄ±l â€” kayÄ±t eklenemez','err'); closeModal('modal-gider'); return; }
  const id = document.getElementById('fg-id').value;
  const para = document.getElementById('fg-para')?.value || 'EUR';
  const tutarRaw = parseFloat(document.getElementById('fg-tutar').value)||0;
  const kur = parseFloat(document.getElementById('fg-kur')?.value)||0;
  const tutarEur = para === 'TRY' && kur > 0 ? tutarRaw / kur : tutarRaw;
  const r = {
    id: id||uid(), ts: Date.now(),
    tip: document.getElementById('fg-tip')?.value || 'simay',
    tarih: document.getElementById('fg-tarih').value,
    kat: document.getElementById('fg-kat').value,
    aciklama: document.getElementById('fg-acik').value.trim(),
    tutar: parseFloat(tutarEur.toFixed(2)),
    tutarOrijinal: tutarRaw,
    paraBirimi: para,
    kur: para === 'TRY' ? kur : null,
  };
  if(!r.tarih || !r.tutar){ toast('Tarih ve tutar zorunlu','err'); return; }
  if(id){ DB.giderler = DB.giderler.map(x=>x.id===id?r:x); toast('Gider gÃ¼ncellendi'); }
  else { DB.giderler.push(r); toast('Gider eklendi'); }
  await dbSave(DB); closeModal('modal-gider');
  ['fg-tarih','fg-acik','fg-tutar','fg-id','fg-kur','fg-eur'].forEach(i=>{const el=document.getElementById(i);if(el)el.value=''});
  const fp=document.getElementById('fg-para');if(fp)fp.value='EUR';
  const ft=document.getElementById('fg-tip');if(ft)ft.value='simay';
  toggleGiderPara();
  await updateSidebar(); await refreshCurrentPage();
}

async function deleteRecord(type, id){
  if(!confirm('Bu kaydÄ± silmek istediÄŸinize emin misiniz?')) return;
  DB[type] = DB[type].filter(x=>x.id!==id);
  await dbSave(DB); toast('KayÄ±t silindi','info');
  await updateSidebar(); await refreshCurrentPage();
}

async function refreshCurrentPage(){
  const active = document.querySelector('.sb-item.active');
  if(active) await renderPage(active.dataset.page);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SIDEBAR UPDATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function updateSidebar(){
  DB = await dbLoad();
  const simayT = DB.simay.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).reduce((a,r)=>a+(r.kdvliBedel||(r.bedel+(r.kdvTutar||0))),0);
  const acenteT = DB.acente.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).reduce((a,r)=>a+r.kar,0);
  const toplam = simayT + acenteT;
  // Banner ciro
  const bc = document.getElementById('yil-banner-ciro');
  if(bc) bc.textContent = money(toplam);
  document.getElementById('badge-simay').textContent = DB.simay.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).length;
  const fbadge=document.getElementById('badge-fatura');
  if(fbadge) fbadge.textContent=(DB.faturalar||[]).filter(r=>r.tarih&&r.tarih.startsWith(String(activeYil))).length;
  const tbadge=document.getElementById('badge-tum');
  if(tbadge) tbadge.textContent=DB.simay.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).length+DB.acente.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).length;
  document.getElementById('badge-acente').textContent = DB.acente.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FATURA KESÄ°M UYARILARI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFaturaUyarilari(){
  const panel = document.getElementById('fatura-uyari-panel');
  if(!panel) return;
  const todayStr = today();
  const todayDate = new Date(todayStr);
  const deadline14 = 14 * 24 * 60 * 60 * 1000; // 14 gÃ¼n ms

  // TÃ¼m rezervasyonlarÄ± topla
  const tumRezler = [
    ...DB.simay.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).map(r=>({...r,_tip:'simay'})),
    ...DB.acente.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).map(r=>({...r,_tip:'acente'})),
  ];

  // Tur bitmiÅŸ ama fatura kesilmemiÅŸ olanlarÄ± bul
  const uyarilar = tumRezler.filter(r => {
    if(!r.cikis) return false;
    if(r.faturaDurum === 'kesildi') return false;
    const cikisDate = new Date(r.cikis);
    return cikisDate < todayDate; // tur bitmis
  }).map(r => {
    const cikisDate = new Date(r.cikis);
    const gecenGun = Math.floor((todayDate - cikisDate) / (24*60*60*1000));
  const kalanGun = 14 - gecenGun;
    return {...r, gecenGun, kalanGun};
  }).filter(r => r.gecenGun <= 21) // 3 hafta gÃ¶ster
    .sort((a,b) => a.kalanGun - b.kalanGun);

  if(!uyarilar.length){ panel.style.display='none'; return; }

  const acilUyarilar = uyarilar.filter(r => r.kalanGun <= 0); // gecikmiÅŸ
  const yaklasanlar = uyarilar.filter(r => r.kalanGun > 0 && r.kalanGun <= 14);

  panel.style.display = 'block';
  panel.innerHTML = `
    <div style="background:linear-gradient(135deg,rgba(184,48,48,0.08),rgba(248,113,113,0.04));border:1px solid rgba(184,48,48,0.25);border-radius:14px;padding:18px 20px;margin-top:20px">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
        <div style="width:32px;height:32px;background:linear-gradient(135deg,#b83030,#f87171);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">ğŸ§¾</div>
        <div>
          <div style="font-size:12px;font-weight:700;color:var(--red2)">Fatura Kesim UyarÄ±sÄ±</div>
          <div style="font-size:10px;color:var(--ink3)">Tur bitiÅŸ tarihinden itibaren 14 gÃ¼n iÃ§inde fatura kesilmelidir</div>
        </div>
        <div style="margin-left:auto;background:rgba(184,48,48,0.15);border-radius:20px;padding:4px 12px;font-size:11px;font-weight:700;color:var(--red2)">${uyarilar.length} bekleyen</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        ${uyarilar.map(r => {
          const isAcil = r.kalanGun <= 0;
          const isYaklasiyor = r.kalanGun > 0 && r.kalanGun <= 3;
          const bg = isAcil ? 'rgba(184,48,48,0.12)' : isYaklasiyor ? 'rgba(190,138,32,0.1)' : 'rgba(255,255,255,0.03)';
          const border = isAcil ? 'rgba(184,48,48,0.3)' : isYaklasiyor ? 'rgba(190,138,32,0.25)' : 'var(--border)';
          const badge = isAcil
            ? `<span style="background:rgba(184,48,48,0.2);color:var(--red2);border:1px solid rgba(184,48,48,0.35);border-radius:5px;padding:2px 8px;font-size:10px;font-weight:700">âš ï¸ ${r.gecenGun - 14} gÃ¼n gecikti</span>`
            : isYaklasiyor
            ? `<span style="background:rgba(190,138,32,0.15);color:var(--gold2);border:1px solid rgba(190,138,32,0.3);border-radius:5px;padding:2px 8px;font-size:10px;font-weight:700">â° ${r.kalanGun} gÃ¼n kaldÄ±</span>`
            : `<span style="background:var(--glass2);color:var(--ink2);border:1px solid var(--border);border-radius:5px;padding:2px 8px;font-size:10px">${r.kalanGun} gÃ¼n kaldÄ±</span>`;
          const tipBadge = r._tip === 'simay'
            ? `<span style="font-size:9px;background:rgba(11,122,110,0.15);color:var(--teal2);border-radius:4px;padding:1px 6px;font-weight:600">â›µ SÄ°MAY</span>`
            : `<span style="font-size:9px;background:rgba(190,138,32,0.12);color:var(--gold2);border-radius:4px;padding:1px 6px;font-weight:600">ğŸ¤ ACENTE</span>`;
          return `<div style="display:flex;align-items:center;gap:12px;background:${bg};border:1px solid ${border};border-radius:9px;padding:10px 14px;flex-wrap:wrap">
            ${tipBadge}
            <span style="font-weight:600;color:var(--ink);flex:1;min-width:120px">${r.misafir}</span>
            <span style="color:var(--ink2);font-size:11px">${r.tekne||'â€”'}</span>
            <span style="color:var(--ink3);font-size:11px">Tur: ${fmtDate(r.giris)} â†’ ${fmtDate(r.cikis)}</span>
            ${badge}
            <button onclick="goFatura('${r.id}')" style="background:rgba(11,122,110,0.15);border:1px solid rgba(11,122,110,0.3);border-radius:6px;padding:4px 10px;color:var(--teal2);cursor:pointer;font-size:10px;font-family:'DM Sans',sans-serif;font-weight:600">Fatura GÃ¶r â†’</button>
          </div>`;
        }).join('')}
      </div>
    </div>`;
}

function goFatura(rezId){
  const el = document.querySelector('[data-page="fatura"]');
  if(el) el.click();
}

function renderFaturaUyarilariSayfa(){
  const panel = document.getElementById('fatura-page-uyari');
  if(!panel) return;
  const todayStr = today();
  const todayDate = new Date(todayStr);
  const tumRezler = [
    ...DB.simay.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).map(r=>({...r,_tip:'simay'})),
    ...DB.acente.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).map(r=>({...r,_tip:'acente'})),
  ];
  const uyarilar = tumRezler.filter(r => {
    if(!r.cikis) return false;
    if(r.faturaDurum === 'kesildi') return false;
    const cikisDate = new Date(r.cikis);
    return cikisDate < todayDate;
  }).map(r => {
    const cikisDate = new Date(r.cikis);
    const gecenGun = Math.floor((todayDate - cikisDate) / (24*60*60*1000));
    return {...r, gecenGun, kalanGun: 14 - gecenGun};
  }).filter(r => r.gecenGun <= 21).sort((a,b) => a.kalanGun - b.kalanGun);

  if(!uyarilar.length){ panel.innerHTML=''; return; }
  panel.innerHTML = `
    <div style="background:linear-gradient(135deg,rgba(184,48,48,0.07),rgba(248,113,113,0.03));border:1px solid rgba(184,48,48,0.22);border-radius:12px;padding:14px 16px">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">
        <span style="font-size:15px">âš ï¸</span>
        <span style="font-size:11px;font-weight:700;color:var(--red2)">Fatura Kesim UyarÄ±sÄ± â€” ${uyarilar.length} rezervasyon bekliyor</span>
        <span style="margin-left:auto;font-size:10px;color:var(--ink3)">Tur bitiÅŸinden 14 gÃ¼n iÃ§inde kesilmeli</span>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:6px">
        ${uyarilar.map(r => {
          const isAcil = r.kalanGun <= 0;
          const bg = isAcil ? 'rgba(184,48,48,0.12)' : 'rgba(255,255,255,0.03)';
          const border = isAcil ? 'rgba(184,48,48,0.3)' : 'var(--border)';
          const tag = isAcil
            ? `<span style="color:var(--red2);font-size:10px;font-weight:700">${r.gecenGun-14}g gecikti</span>`
            : `<span style="color:var(--ink3);font-size:10px">${r.kalanGun}g kaldÄ±</span>`;
          return `<div style="background:${bg};border:1px solid ${border};border-radius:7px;padding:6px 10px;display:flex;align-items:center;gap:8px;font-size:11px">
            <span style="font-weight:600;color:var(--ink)">${r.misafir}</span>
            <span style="color:var(--ink3)">${fmtDate(r.cikis)}</span>
            ${tag}
          </div>`;
        }).join('')}
      </div>
    </div>`;
}

async function renderDashboard(){
  DB = await dbLoad();
  const simayT = DB.simay.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).reduce((a,r)=>a+(r.kdvliBedel||(r.bedel+(r.kdvTutar||0))),0);
  const acenteT = DB.acente.filter(r=>r.giris&&r.giris.startsWith(String(activeYil))).reduce((a,r)=>a+r.kar,0);
  const giderT = DB.giderler.reduce((a,r)=>a+r.tutar,0);
  const toplam = simayT+acenteT;
  const net = toplam-giderT;
  const pct = DB.cfg.hedef>0 ? Math.min(toplam/DB.cfg.hedef*100,100) : 0;

  // Banner ciro gÃ¼ncelle
  const bannerCiro = document.getElementById('yil-banner-ciro');
  if(bannerCiro) bannerCiro.textContent = money(toplam);

  // Date
  document.getElementById('dash-date').textContent = new Date().toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long',year:'numeric'});

  // Fatura kesim uyarÄ±larÄ± (tur bitiÅŸinden 14 gÃ¼n iÃ§inde fatura kesilmeli)
  renderFaturaUyarilari();


  // KPIs
  document.getElementById('dash-kpis').innerHTML = `
    <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
      <span class="kpi-icon">â›µ</span>
      <div class="kpi-lbl">Simay Cirosu</div>
      <div class="kpi-val">${money(simayT)}</div>
      <div class="kpi-sub">${DB.simay.length} rezervasyon</div>
    </div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
      <span class="kpi-icon">ğŸ¤</span>
      <div class="kpi-lbl">Acenta KÃ¢rÄ±</div>
      <div class="kpi-val">${money(acenteT)}</div>
      <div class="kpi-sub">${DB.acente.length} rezervasyon</div>
    </div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#b83030,#f87171);--kc:var(--red2)">
      <span class="kpi-icon">ğŸ“‰</span>
      <div class="kpi-lbl">Toplam Gider</div>
      <div class="kpi-val">${money(giderT)}</div>
      <div class="kpi-sub">${DB.giderler.length} kalem</div>
    </div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#156b3a,#22c55e);--kc:var(--green2)">
      <span class="kpi-icon">ğŸ’°</span>
      <div class="kpi-lbl">Net KÃ¢r (Tahmini)</div>
      <div class="kpi-val" style="color:${net>=0?'var(--green2)':'var(--red2)'}">${money(net)}</div>
      <div class="kpi-sub">Marj: ${toplam>0?(net/toplam*100).toFixed(1):'0'}%</div>
    </div>`;

  // Ring & progress
  const circ = 276.5;
  const offset = circ - (circ * pct/100);
  document.getElementById('ring-arc').setAttribute('stroke-dashoffset', offset);
  document.getElementById('ring-pct').textContent = pct.toFixed(1)+'%';
  document.getElementById('prog-ger').textContent = 'GerÃ§ekleÅŸen: '+money(toplam);
  document.getElementById('prog-hed').textContent = 'Hedef: '+money(DB.cfg.hedef);
  document.getElementById('prog-fill').style.width = pct+'%';
  document.getElementById('hedef-sub').textContent = money(DB.cfg.hedef)+' hedef Â· Kalan: '+money(Math.max(0,DB.cfg.hedef-toplam));
  document.getElementById('hedef-detay').innerHTML = `
    <div style="flex:1;text-align:center;padding:8px;background:rgba(11,122,110,.07);border-radius:8px">
      <div style="font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:4px">Toplam Gelir</div>
      <div style="font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:700;color:var(--gold2)">${money(toplam)}</div>
    </div>
    <div style="flex:1;text-align:center;padding:8px;background:rgba(21,107,58,.07);border-radius:8px;margin-left:8px">
      <div style="font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:4px">Net KÃ¢r</div>
      <div style="font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:700;color:${net>=0?'var(--green2)':'var(--red2)'}">${money(net)}</div>
    </div>`;

  // AylÄ±k chart
  const ayMap = {};
  DB.simay.forEach(r=>{ const m=getMonth(r.giris); if(m){ayMap[m]=ayMap[m]||{s:0,a:0}; ayMap[m].s+=r.bedel;}});
  DB.acente.forEach(r=>{ const m=getMonth(r.giris); if(m){ayMap[m]=ayMap[m]||{s:0,a:0}; ayMap[m].a+=r.kar;}});
  const aylar = Object.keys(ayMap).map(Number).sort((a,b)=>a-b);
  const maxM = Math.max(...aylar.map(m=>ayMap[m].s+ayMap[m].a), 1);
  const chart = document.getElementById('dash-chart');
  if(!aylar.length){
    chart.innerHTML='<div style="width:100%;text-align:center;color:var(--ink3);font-size:11px;padding:20px">HenÃ¼z veri yok</div>';
  } else {
    chart.innerHTML = aylar.map(m=>{
      const s=ayMap[m].s; const a=ayMap[m].a; const t=s+a;
      const sh=(s/maxM)*125; const ah=(a/maxM)*125;
      return `<div class="bcc">
        <div class="bc-stack">
          ${a>0?`<div class="bc-seg ace ${s===0?'seg-only':'seg-t'}" style="height:${ah}px;min-height:3px;position:relative">
            <div class="bc-tip">Acente: ${money(a)}</div></div>`:''}
          ${s>0?`<div class="bc-seg sim ${a===0?'seg-only':'seg-b'}" style="height:${sh}px;min-height:3px;${a>0?'margin-top:1px':''}position:relative">
            <div class="bc-tip">Simay: ${money(s)}</div></div>`:''}
        </div>
        <div class="bc-lbl">${MONTHS[m]}</div>
      </div>`;
    }).join('');
  }

  // Tekne bars
  const tkMap = {};
  DB.simay.forEach(r=>{ tkMap[r.tekne]=tkMap[r.tekne]||{c:0,n:0}; tkMap[r.tekne].c+=r.bedel; tkMap[r.tekne].n++; });
  const maxT = Math.max(...Object.values(tkMap).map(v=>v.c),1);
  const TCLR = ['linear-gradient(90deg,#0b7a6e,#18b4a2)','linear-gradient(90deg,#1a4a7a,#60a5fa)','linear-gradient(90deg,#be8a20,#e8b84b)','linear-gradient(90deg,#6c5ce7,#c39bd3)'];
  const tbEl = document.getElementById('dash-tekneler');
  if(!Object.keys(tkMap).length){
    tbEl.innerHTML='<div class="empty-state"><div class="es-icon">â›µ</div><div class="es-text">HenÃ¼z veri yok</div></div>';
  } else {
    tbEl.innerHTML = Object.entries(tkMap).sort((a,b)=>b[1].c-a[1].c).map(([t,v],i)=>`
      <div class="hbar-row">
        <div class="hbar-head">
          <span class="hbar-name">${t}</span>
          <span class="hbar-val" style="color:var(--teal2)">${money(v.c)}</span>
        </div>
        <div class="hbar-bg"><div class="hbar-fill" style="width:${v.c/maxT*100}%;background:${TCLR[i%TCLR.length]}"></div></div>
        <div class="hbar-detail">${v.n} satÄ±ÅŸ Â· Ort. ${money(v.c/v.n)}</div>
      </div>`).join('');
  }

  // Son iÅŸlemler
  const all = [
    ...DB.simay.map(r=>({...r,tip:'sim',gelir:r.bedel})),
    ...DB.acente.map(r=>({...r,tip:'ace',gelir:r.kar})),
  ].sort((a,b)=>b.ts-a.ts).slice(0,10);
  const sonEl = document.getElementById('dash-son');
  if(!all.length){
    sonEl.innerHTML='<div class="empty-state"><div class="es-icon">ğŸ“‹</div><div class="es-text">HenÃ¼z kayÄ±t yok</div></div>';
  } else {
    sonEl.innerHTML = all.map(r=>`
      <div style="display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.03)">
        <span class="badge ${r.tip==='sim'?'b-simay':'b-acente'}" style="flex-shrink:0">${r.tip==='sim'?'SÄ°MAY':'ACT'}</span>
        <div style="flex:1;min-width:0">
          <div style="font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${r.misafir}</div>
          <div style="font-size:9px;color:var(--ink2)">${r.tekne} Â· ${fmtDate(r.giris)}</div>
        </div>
        <div style="font-family:'Cormorant Garamond',serif;font-size:14px;font-weight:700;color:${r.tip==='sim'?'var(--teal2)':'var(--green2)'};flex-shrink:0">${money(r.gelir)}</div>
      </div>`).join('');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SÄ°MAY PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let simayFilter = 'all';

function buildSimayFilters(){
  const bar = document.getElementById('simay-filters');
  const tekneler = (DB.cfg.tekneler||'').split(',').map(t=>t.trim()).filter(Boolean);
  bar.innerHTML = `<button class="fb ${simayFilter==='all'?'on':''}" onclick="setFilter('simay','all',this)">TÃ¼mÃ¼</button>`
    + tekneler.map(t=>`<button class="fb ${simayFilter===t?'on':''}" onclick="setFilter('simay','${t}',this)">${t}</button>`).join('');
}

function setFilter(type, val, btn){
  if(type==='simay'){ simayFilter=val; renderSimayTable(); }
  else { acenteFilter=val; renderAcenteTable(); }
  btn.closest('.filter-bar').querySelectorAll('.fb').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
}

async function renderSimayKPIs(){
  DB=await dbLoad();
  const allSimay = DB.simay.filter(r=>r.giris && r.giris.startsWith(String(activeYil)));
  const data = simayFilter==='all' ? allSimay : allSimay.filter(r=>r.tekne===simayFilter);
  const kdvsizT = data.reduce((a,r)=>a+(r.bedel||0), 0);
  const kdvT    = data.reduce((a,r)=>a+(r.kdvTutar||0), 0);
  const kdvliT  = data.reduce((a,r)=>a+(r.kdvliBedel || (r.bedel+(r.kdvTutar||0))), 0);
  const onT     = data.reduce((a,r)=>a+(r.on||0), 0);
  const kalanT  = data.reduce((a,r)=>a+(r.kalan||0), 0);
  document.getElementById('simay-kpis').innerHTML=`
    <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
      <span class="kpi-icon">ğŸ’¶</span>
      <div class="kpi-lbl">KDV'siz Toplam</div>
      <div class="kpi-val">${money(kdvsizT)}</div>
      <div class="kpi-sub">${data.length} rezervasyon</div>
    </div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
      <span class="kpi-icon">ğŸ§¾</span>
      <div class="kpi-lbl">KDV TutarÄ±</div>
      <div class="kpi-val">${money(kdvT)}</div>
      <div class="kpi-sub">Toplam KDV</div>
    </div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#156b3a,#22c55e);--kc:var(--green2)">
      <span class="kpi-icon">âœ…</span>
      <div class="kpi-lbl">KDV'li Toplam</div>
      <div class="kpi-val">${money(kdvliT)}</div>
      <div class="kpi-sub">BrÃ¼t ciro</div>
    </div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#1a4a7a,#60a5fa);--kc:var(--blue2)">
      <span class="kpi-icon">ğŸ’³</span>
      <div class="kpi-lbl">Ã–n Ã–deme</div>
      <div class="kpi-val">${money(onT)}</div>
      <div class="kpi-sub">Tahsilat</div>
    </div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#b83030,#f87171);--kc:var(--red2)">
      <span class="kpi-icon">â³</span>
      <div class="kpi-lbl">Kalan Tahsilat</div>
      <div class="kpi-val">${money(kalanT)}</div>
      <div class="kpi-sub">Bekleyen Ã¶deme</div>
    </div>`;
}

async function renderSimayTable(){
  DB=await dbLoad();
  const q = (document.getElementById('simay-search')?.value||'').toLowerCase();
  let data = [...DB.simay]
    .filter(r => r.giris && r.giris.startsWith(String(activeYil)))
    .sort((a,b)=>b.ts-a.ts);
  if(simayFilter!=='all') data=data.filter(r=>r.tekne===simayFilter);
  if(q) data=data.filter(r=>(r.misafir+r.tekne+(r.sorumlu||'')).toLowerCase().includes(q));
  
  const tbody = document.getElementById('simay-tbody');
  const empty = document.getElementById('simay-empty');
  if(!data.length){ tbody.innerHTML=''; empty.style.display=''; document.getElementById('simay-total-row').textContent=''; return; }
  empty.style.display='none';
  const ODEME_BADGE = {bekliyor:'â³ Bekliyor',kismi:'ğŸ”¶ KÄ±smi',odendi:'âœ… Ã–dendi',gecikti:'ğŸ”´ Gecikti'};
  const FATURA_BADGE = {kesildi:'<span style="color:var(--green2);font-size:10px;font-weight:600">âœ… Kesildi</span>',kesilmedi:'<span style="color:var(--red2);font-size:10px">âŒ Kesilmedi</span>'};
  tbody.innerHTML = data.map((r,i)=>{
    const oLabel = ODEME_BADGE[r.odemeDurum||'bekliyor'] || r.odemeDurum || 'â€”';
    const fLabel = FATURA_BADGE[r.faturaDurum||'kesilmedi'];
    return `<tr class="clickable" onclick="showSimayDetail('${r.id}')">
      <td style="color:var(--ink3)">${i+1}</td>
      <td class="fw">${r.misafir}</td>
      <td><span class="badge b-simay">${r.tekne}</span></td>
      <td style="color:var(--ink2)">${r.gliman||'â€”'}</td>
      <td style="color:var(--ink2)">${r.climan||'â€”'}</td>
      <td>${fmtDate(r.giris)}</td>
      <td>${fmtDate(r.cikis)||'â€”'}</td>
      <td><span style="font-size:10px;font-weight:600">${oLabel}</span></td>
      <td>${fLabel}</td>
      <td class="td-actions">
        <button class="btn btn-ghost btn-xs" onclick="event.stopPropagation();editSimayForm('${r.id}')">DÃ¼zenle</button>
        <button class="btn btn-danger btn-xs" onclick="event.stopPropagation();deleteRecord('simay','${r.id}')">Sil</button>
      </td>
    </tr>`;
  }).join('');
  const T     = data.reduce((a,r)=>a+(r.bedel||0), 0);
  const kdvliT = data.reduce((a,r)=>a+(r.kdvliBedel||(r.bedel+(r.kdvTutar||0))), 0);
  document.getElementById('simay-total-row').innerHTML = `
    <span style="color:var(--ink3)">${data.length} kayÄ±t &nbsp;|&nbsp;</span>
    <span style="font-weight:600;color:var(--teal2)">KDV'siz: ${money(T)}</span>
    &nbsp;
    <span style="color:var(--ink3)">+KDV â†’</span>
    &nbsp;
    <span style="font-weight:700;color:var(--green2)">KDV'li: ${money(kdvliT)}</span>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ACENTE PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let acenteFilter = 'all';

function buildAcenteFilters(){
  const sorumlular = [...new Set(DB.acente.map(r=>(r.sorumlu||'').trim()).filter(Boolean))].sort();
  const bar = document.getElementById('acente-filters');
  bar.innerHTML = `<button class="fb ${acenteFilter==='all'?'on':''}" onclick="setFilter('acente','all',this)">TÃ¼mÃ¼</button>`
    + sorumlular.map(s=>`<button class="fb ${acenteFilter===s?'on':''}" onclick="setFilter('acente','${s}',this)">${s}</button>`).join('');
}

async function renderAcenteKPIs(){
  DB=await dbLoad();
  const allAcente = DB.acente.filter(r=>r.giris && r.giris.startsWith(String(activeYil)));
  const data = acenteFilter==='all' ? allAcente : allAcente.filter(r=>(r.sorumlu||'').trim()===acenteFilter);
  const karT=data.reduce((a,r)=>a+r.kar,0);
  const bedelT=data.reduce((a,r)=>a+r.bedel,0);
  document.getElementById('acente-kpis').innerHTML=`
    <div class="kpi" style="--ka:linear-gradient(90deg,#156b3a,#22c55e);--kc:var(--green2)">
      <div class="kpi-lbl">Toplam KÃ¢r</div><div class="kpi-val">${money(karT)}</div><div class="kpi-sub">${data.length} rezervasyon</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
      <div class="kpi-lbl">Toplam Tur Bedeli</div><div class="kpi-val">${money(bedelT)}</div><div class="kpi-sub">Misafirden tahsilat</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
      <div class="kpi-lbl">Ort. KÃ¢r</div><div class="kpi-val">${data.length?money(karT/data.length):'â‚¬0'}</div><div class="kpi-sub">SatÄ±ÅŸ baÅŸÄ±na</div></div>`;
}

async function renderAcenteTable(){
  DB=await dbLoad();
  const q=(document.getElementById('acente-search')?.value||'').toLowerCase();
  let data=[...DB.acente]
    .filter(r => r.giris && r.giris.startsWith(String(activeYil)))
    .sort((a,b)=>b.ts-a.ts);
  if(acenteFilter!=='all') data=data.filter(r=>(r.sorumlu||'').trim()===acenteFilter);
  if(q) data=data.filter(r=>(r.misafir+r.tekne+(r.sorumlu||'')).toLowerCase().includes(q));
  const tbody=document.getElementById('acente-tbody');
  const empty=document.getElementById('acente-empty');
  if(!data.length){ tbody.innerHTML=''; empty.style.display=''; return; }
  empty.style.display='none';
  const ODEME_BADGE = {bekliyor:'â³ Bekliyor',kismi:'ğŸ”¶ KÄ±smi',odendi:'âœ… Ã–dendi',gecikti:'ğŸ”´ Gecikti'};
  const FATURA_BADGE = {kesildi:'<span style="color:var(--green2);font-size:10px;font-weight:600">âœ… Kesildi</span>',kesilmedi:'<span style="color:var(--red2);font-size:10px">âŒ Kesilmedi</span>'};
  tbody.innerHTML=data.map((r,i)=>{
    const oLabel = ODEME_BADGE[r.odemeDurum||'bekliyor'] || r.odemeDurum || 'â€”';
    const fLabel = FATURA_BADGE[r.faturaDurum||'kesilmedi'];
    return `<tr class="clickable" onclick="showAcenteDetail('${r.id}')">
      <td style="color:var(--ink3)">${i+1}</td>
      <td class="fw">${r.misafir}</td>
      <td>${r.tekne}</td>
      <td style="color:var(--ink2)">${r.gliman||'â€”'}</td>
      <td style="color:var(--ink2)">${r.climan||'â€”'}</td>
      <td>${fmtDate(r.giris)}</td>
      <td>${fmtDate(r.cikis)||'â€”'}</td>
      <td><span style="font-size:10px;font-weight:600">${oLabel}</span></td>
      <td>${fLabel}</td>
      <td class="td-actions">
        <button class="btn btn-ghost btn-xs" onclick="event.stopPropagation();editAcenteForm('${r.id}')">DÃ¼zenle</button>
        <button class="btn btn-danger btn-xs" onclick="event.stopPropagation();deleteRecord('acente','${r.id}')">Sil</button>
      </td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GÄ°DER PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openGiderModal(tipOnceden){
  // Formu temizle
  ['fg-tarih','fg-acik','fg-tutar','fg-id','fg-kur','fg-eur'].forEach(i=>{
    const el=document.getElementById(i); if(el) el.value='';
  });
  const fp=document.getElementById('fg-para'); if(fp) fp.value='EUR';
  const ft=document.getElementById('fg-tip');
  if(ft) ft.value = tipOnceden || 'simay';
  toggleGiderPara();
  openModal('modal-gider', tipOnceden==='acenta' ? 'Acenta Gider Ekle' : 'Simay Gider Ekle');
}

function editGiderForm(id){
  const r = DB.giderler.find(x=>x.id===id);
  if(!r) return;
  const ft=document.getElementById('fg-tip'); if(ft) ft.value=r.tip||'simay';
  const fd=document.getElementById('fg-tarih'); if(fd) fd.value=r.tarih||'';
  const fk=document.getElementById('fg-kat'); if(fk) fk.value=r.kat||'DiÄŸer';
  const fa=document.getElementById('fg-acik'); if(fa) fa.value=r.aciklama||'';
  const fp=document.getElementById('fg-para'); if(fp) fp.value=r.paraBirimi||'EUR';
  toggleGiderPara();
  // TRY ise orijinal tutarÄ± gÃ¶ster
  const ft2=document.getElementById('fg-tutar');
  if(ft2) ft2.value = r.paraBirimi==='TRY' ? (r.tutarOrijinal||r.tutar) : r.tutar;
  const fkur=document.getElementById('fg-kur'); if(fkur && r.kur) fkur.value=r.kur;
  const feur=document.getElementById('fg-eur'); if(feur && r.paraBirimi==='TRY') feur.value=r.tutar;
  const fi=document.getElementById('fg-id'); if(fi) fi.value=r.id;
  openModal('modal-gider','Gider DÃ¼zenle');
}

function renderGiderTable(data, tbodyId, emptyId, showTip=false){
  const tbody=document.getElementById(tbodyId);
  const empty=document.getElementById(emptyId);
  if(!data.length){ if(tbody)tbody.innerHTML=''; if(empty)empty.style.display=''; return; }
  if(empty)empty.style.display='none';
  tbody.innerHTML=data.map((r,i)=>`
    <tr>
      <td style="color:var(--ink3)">${i+1}</td>
      ${showTip?`<td><span class="badge" style="${r.tip==='acenta'?'background:rgba(190,138,32,.15);color:var(--gold2);border:1px solid rgba(190,138,32,.25)':'background:rgba(11,122,110,.15);color:var(--teal2);border:1px solid rgba(11,122,110,.25)'}">${r.tip==='acenta'?'ğŸ¤ Acenta':'â›µ Simay'}</span></td>`:''}
      <td>${fmtDate(r.tarih)}</td>
      <td><span class="badge b-gider">${r.kat}</span></td>
      <td style="color:var(--ink2)">${r.aciklama||'â€”'}</td>
      <td class="mono" style="color:var(--red2)">${money(r.tutar)}${r.paraBirimi==='TRY'?`<span style='font-size:9px;color:var(--ink3);display:block'>â‚º${Number(r.tutarOrijinal||0).toLocaleString('tr-TR')} / kur:${r.kur?Number(r.kur).toFixed(2):'â€”'}</span>`:''}</td>
      <td class="td-actions">
        <button class="btn btn-ghost btn-xs" onclick="editGiderForm('${r.id}')">DÃ¼zenle</button>
        <button class="btn btn-danger btn-xs" onclick="deleteRecord('giderler','${r.id}')">Sil</button>
      </td>
    </tr>`).join('');
}

async function renderGider(tip='all'){
  DB=await dbLoad();
  const all=[...DB.giderler].sort((a,b)=>new Date(b.tarih)-new Date(a.tarih));
  const simayG = all.filter(r=>!r.tip || r.tip==='simay');
  const acentaG = all.filter(r=>r.tip==='acenta');
  const buAy=new Date().getMonth()+1;

  if(tip==='all'){
    // Toplam page
    const gT=all.reduce((a,r)=>a+r.tutar,0);
    const simayT=simayG.reduce((a,r)=>a+r.tutar,0);
    const acentaT=acentaG.reduce((a,r)=>a+r.tutar,0);
    document.getElementById('gider-kpis').innerHTML=`
      <div class="kpi" style="--ka:linear-gradient(90deg,#b83030,#f87171);--kc:var(--red2)">
        <span class="kpi-icon">ğŸ“Š</span>
        <div class="kpi-lbl">Toplam Gider</div><div class="kpi-val">${money(gT)}</div><div class="kpi-sub">${all.length} kalem</div></div>
      <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
        <span class="kpi-icon">â›µ</span>
        <div class="kpi-lbl">Simay Giderleri</div><div class="kpi-val">${money(simayT)}</div><div class="kpi-sub">${simayG.length} kalem</div></div>
      <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
        <span class="kpi-icon">ğŸ¤</span>
        <div class="kpi-lbl">Acenta Giderleri</div><div class="kpi-val">${money(acentaT)}</div><div class="kpi-sub">${acentaG.length} kalem</div></div>`;
    renderGiderTable(all, 'gider-tbody', 'gider-empty', true);
  } else if(tip==='simay'){
    const gT=simayG.reduce((a,r)=>a+r.tutar,0);
    const buAyG=simayG.filter(r=>getMonth(r.tarih)===buAy).reduce((a,r)=>a+r.tutar,0);
    document.getElementById('gider-simay-kpis').innerHTML=`
      <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
        <span class="kpi-icon">â›µ</span>
        <div class="kpi-lbl">Simay Toplam Gider</div><div class="kpi-val">${money(gT)}</div><div class="kpi-sub">${simayG.length} kalem</div></div>
      <div class="kpi" style="--ka:linear-gradient(90deg,#e17055,#ffeaa7);--kc:#ffd166">
        <div class="kpi-lbl">Bu Ay</div><div class="kpi-val">${money(buAyG)}</div><div class="kpi-sub">${MONTHS_FULL[buAy]}</div></div>`;
    renderGiderTable(simayG, 'gider-simay-tbody', 'gider-simay-empty');
  } else if(tip==='acenta'){
    const gT=acentaG.reduce((a,r)=>a+r.tutar,0);
    const buAyG=acentaG.filter(r=>getMonth(r.tarih)===buAy).reduce((a,r)=>a+r.tutar,0);
    document.getElementById('gider-acenta-kpis').innerHTML=`
      <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
        <span class="kpi-icon">ğŸ¤</span>
        <div class="kpi-lbl">Acenta Toplam Gider</div><div class="kpi-val">${money(gT)}</div><div class="kpi-sub">${acentaG.length} kalem</div></div>
      <div class="kpi" style="--ka:linear-gradient(90deg,#e17055,#ffeaa7);--kc:#ffd166">
        <div class="kpi-lbl">Bu Ay</div><div class="kpi-val">${money(buAyG)}</div><div class="kpi-sub">${MONTHS_FULL[buAy]}</div></div>`;
    renderGiderTable(acentaG, 'gider-acenta-tbody', 'gider-acenta-empty');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REZERVASYon TAKVIM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderRezervasyonPage(){
  DB = await dbLoad();
  const secAy = parseInt(document.getElementById('rez-ay-sel').value)||0;
  const secTip = document.getElementById('rez-tip-sel').value;

  // TÃ¼m rezervasyonlarÄ± birleÅŸtir â€” sadece aktif yÄ±lÄ±n tur tarihleri
  let simayRez = DB.simay
    .filter(r => r.giris && r.giris.startsWith(String(activeYil)))
    .map(r=>({...r,_tip:'simay'}));
  let acenteRez = DB.acente
    .filter(r => r.giris && r.giris.startsWith(String(activeYil)))
    .map(r=>({...r,_tip:'acente'}));
  let tumRez = [...simayRez, ...acenteRez];

  // Tip filtresi
  if(secTip==='simay') tumRez = tumRez.filter(r=>r._tip==='simay');
  else if(secTip==='acente') tumRez = tumRez.filter(r=>r._tip==='acente');

  // Ay filtresi
  if(secAy>0) tumRez = tumRez.filter(r=>getMonth(r.giris)===secAy);

  // KPI
  const simayCount = tumRez.filter(r=>r._tip==='simay').length;
  const acenteCount = tumRez.filter(r=>r._tip==='acente').length;
  const toplamCiro = tumRez.reduce((a,r)=>a+(r._tip==='simay'?r.bedel:r.kar),0);
  const bugunStr = today();
  const aktifRez = tumRez.filter(r=>r.giris<=bugunStr && (!r.cikis||r.cikis>=bugunStr)).length;
  const subEl = document.getElementById('rez-page-sub');
  if(subEl) subEl.textContent = activeYil + ' yÄ±lÄ± rezervasyonlarÄ±'+(isReadOnly?' Â· Salt Okunur':'');
  document.getElementById('rez-kpis').innerHTML=`
    <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
      <span class="kpi-icon">â›µ</span>
      <div class="kpi-lbl">Simay Rezervasyonlar</div>
      <div class="kpi-val">${simayCount}</div>
      <div class="kpi-sub">FiltrelenmiÅŸ</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
      <span class="kpi-icon">ğŸ¤</span>
      <div class="kpi-lbl">Acente Rezervasyonlar</div>
      <div class="kpi-val">${acenteCount}</div>
      <div class="kpi-sub">FiltrelenmiÅŸ</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#156b3a,#22c55e);--kc:var(--green2)">
      <span class="kpi-icon">ğŸ’°</span>
      <div class="kpi-lbl">Toplam Gelir</div>
      <div class="kpi-val">${money(toplamCiro)}</div>
      <div class="kpi-sub">Simay ciro + Acente kÃ¢r</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#1a4a7a,#60a5fa);--kc:var(--blue2)">
      <span class="kpi-icon">ğŸ“…</span>
      <div class="kpi-lbl">Aktif Rezervasyonlar</div>
      <div class="kpi-val">${aktifRez}</div>
      <div class="kpi-sub">Åu an devam eden</div></div>`;

  // Aylara gÃ¶re grupla
  const ayGruplar = {};
  tumRez.forEach(r=>{
    const m = getMonth(r.giris);
    if(!m) return;
    ayGruplar[m] = ayGruplar[m]||[];
    ayGruplar[m].push(r);
  });

  const wrap = document.getElementById('rez-aylar-wrap');
  if(!tumRez.length){
    wrap.innerHTML='<div class="empty-state"><div class="es-icon">ğŸ—“</div><div class="es-text">'+activeYil+' yÄ±lÄ±nda bu kriterlere uygun rezervasyon bulunamadÄ±.</div></div>';
    return;
  }

  const aylarSorted = secAy>0 ? [secAy] : Object.keys(ayGruplar).map(Number).sort((a,b)=>a-b);
  wrap.innerHTML = aylarSorted.map(m=>{
    const rez = (ayGruplar[m]||[]).sort((a,b)=>new Date(a.giris)-new Date(b.giris));
    if(!rez.length) return '';
    const ayToplam = rez.reduce((a,r)=>a+(r._tip==='simay'?r.bedel:r.kar),0);
    return `<div class="rez-month-block">
      <div class="rez-month-title">
        ${MONTHS_FULL[m]}
        <span class="rez-month-count">${rez.length} rezervasyon Â· ${money(ayToplam)}</span>
      </div>
      <div class="rez-cards">
        ${rez.map(r=>{
          const gun = daysBetween(r.giris,r.cikis);
          const gelir = r._tip==='simay' ? r.bedel : r.kar;
          const liman = [r.gliman,r.climan].filter(Boolean).join(' â†’ ');
          const isAcente = r._tip==='acente';
          return `<div class="rez-card ${isAcente?'ace':''}" onclick="${isAcente?`showAcenteDetail('${r.id}')`:`showSimayDetail('${r.id}')`}" style="cursor:pointer;transition:transform .15s,box-shadow .15s" onmouseenter="this.style.transform='translateY(-2px)'" onmouseleave="this.style.transform=''">
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:8px">
              <div style="flex:1;min-width:0">
                <div class="rez-card-name" style="font-size:14px;font-weight:600;color:#e4eef6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${r.misafir}</div>
                <div style="font-size:11px;color:var(--${isAcente?'gold2':'teal2'});margin-top:2px">${isAcente?'ğŸ¤':'â›µ'} ${r.tekne}</div>
              </div>
              <span class="badge ${isAcente?'':'b-simay'}" style="${isAcente?'background:rgba(190,138,32,.15);color:var(--gold2);border:1px solid rgba(190,138,32,.25)':''}">
                ${isAcente?'Acenta':'Simay'}
              </span>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:5px">
              <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--ink2)">
                <span style="color:var(--teal2)">ğŸ“</span>
                <span>${r.gliman||'â€”'}</span>
              </div>
              <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--ink2)">
                <span style="color:var(--gold2)">ğŸ</span>
                <span>${r.climan||'â€”'}</span>
              </div>
              <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--ink2);grid-column:span 2">
                <span>ğŸ“…</span>
                <span style="font-weight:500">${fmtDate(r.giris)}${r.cikis?' â†’ '+fmtDate(r.cikis):''}${gun>0?' ('+gun+' gece)':''}</span>
              </div>
              ${r.sorumlu?`<div style="display:flex;align-items:center;gap:4px;font-size:10px;color:var(--ink2);grid-column:span 2"><span>ğŸ‘¤</span><span style="color:var(--gold3)">${r.sorumlu}</span></div>`:''}
            </div>
          </div>`;
        }).join('')}
      </div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RAPORLAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderRaporlar(){
  DB=await dbLoad();
  const simayT=DB.simay.reduce((a,r)=>a+(r.kdvliBedel||(r.bedel+(r.kdvTutar||0))),0);
  const acenteT=DB.acente.reduce((a,r)=>a+r.kar,0);
  const giderT=DB.giderler.reduce((a,r)=>a+r.tutar,0);
  const giderSimay=DB.giderler.filter(r=>!r.tip||r.tip==='simay').reduce((a,r)=>a+r.tutar,0);
  const giderAcenta=DB.giderler.filter(r=>r.tip==='acenta').reduce((a,r)=>a+r.tutar,0);
  const toplam=simayT+acenteT;
  const net=toplam-giderT;
  const pct=DB.cfg.hedef>0?(toplam/DB.cfg.hedef*100).toFixed(1):0;

  // Net strip
  document.getElementById('net-strip').innerHTML=`
    <div class="ns-item"><div class="ns-lbl">Toplam Gelir</div><div class="ns-val" style="color:var(--gold2)">${money(toplam)}</div><div class="ns-sub">${DB.simay.length+DB.acente.length} toplam satÄ±ÅŸ</div></div>
    <div class="ns-div"></div>
    <div class="ns-item"><div class="ns-lbl">Gider (Toplam)</div><div class="ns-val" style="color:var(--red2)">âˆ’${money(giderT)}</div><div class="ns-sub"><span style="color:var(--teal3)">â›µ ${money(giderSimay)}</span> Â· <span style="color:var(--gold3)">ğŸ¤ ${money(giderAcenta)}</span></div></div>
    <div class="ns-div"></div>
    <div class="ns-item"><div class="ns-lbl">Net KÃ¢r</div><div class="ns-val" style="color:${net>=0?'var(--green2)':'var(--red2)'}">${money(net)}</div><div class="ns-sub">Marj: ${toplam>0?(net/toplam*100).toFixed(1):0}%</div></div>
    <div class="ns-div"></div>
    <div class="ns-item"><div class="ns-lbl">Hedefe UlaÅŸma</div><div class="ns-val" style="color:var(--gold2)">%${pct}</div><div class="ns-sub">Kalan: ${money(Math.max(0,DB.cfg.hedef-toplam))}</div></div>
    <div class="ns-div"></div>
    <div class="ns-item" style="flex:1.5;text-align:left;padding:0 20px">
      <div class="ns-lbl" style="margin-bottom:8px">Gelir / Gider OranÄ±</div>
      <div style="height:8px;background:rgba(255,255,255,0.06);border-radius:4px;overflow:hidden;display:flex">
        <div style="height:100%;width:${toplam>0?Math.min(giderT/toplam*100,100):0}%;background:linear-gradient(90deg,#b83030,#f87171)"></div>
        <div style="height:100%;width:${toplam>0?Math.max(0,net/toplam*100):0}%;background:linear-gradient(90deg,#156b3a,#22c55e);margin-left:1px"></div>
      </div>
      <div style="display:flex;justify-content:space-between;margin-top:5px;font-size:9px;color:var(--ink3)">
        <span style="color:var(--red2)">Gider ${toplam>0?(giderT/toplam*100).toFixed(0):0}%</span>
        <span style="color:var(--green2)">KÃ¢r ${toplam>0?Math.max(0,(net/toplam*100)).toFixed(0):0}%</span>
      </div>
    </div>`;

  // Donut
  const circ=389.6;
  const sPct=toplam>0?simayT/toplam:0;
  const aPct=toplam>0?acenteT/toplam:0;
  const sOffset=circ-(circ*sPct);
  const aOffset=circ*(1-aPct);
  document.getElementById('donut-simay').setAttribute('stroke-dashoffset',sOffset);
  document.getElementById('donut-acente').setAttribute('stroke-dashoffset',aOffset);
  document.getElementById('donut-total').textContent = toplam>=1000000 ? 'â‚¬'+(toplam/1000000).toFixed(2)+'M' : money(toplam);
  document.getElementById('donut-legend').innerHTML=`
    <div class="dl-item"><div class="dl-bar" style="background:linear-gradient(180deg,#18b4a2,#0b7a6e)"></div>
      <div class="dl-info"><div class="dl-name">Simay Tekneleri</div><div class="dl-sub">${money(simayT)} Â· ${DB.simay.length} res.</div></div>
      <div class="dl-pct" style="color:var(--teal2)">${(sPct*100).toFixed(1)}%</div>
    </div>
    <div class="dl-item"><div class="dl-bar" style="background:linear-gradient(180deg,#e8b84b,#be8a20)"></div>
      <div class="dl-info"><div class="dl-name">Acenta</div><div class="dl-sub">${money(acenteT)} Â· ${DB.acente.length} res.</div></div>
      <div class="dl-pct" style="color:var(--gold2)">${(aPct*100).toFixed(1)}%</div>
    </div>`;

  // AylÄ±k tablo
  const ayMap={};
  DB.simay.forEach(r=>{const m=getMonth(r.giris);if(m){ayMap[m]=ayMap[m]||{s:0,a:0,g:0};ayMap[m].s+=r.bedel}});
  DB.acente.forEach(r=>{const m=getMonth(r.giris);if(m){ayMap[m]=ayMap[m]||{s:0,a:0,g:0};ayMap[m].a+=r.kar}});
  DB.giderler.forEach(r=>{const m=getMonth(r.tarih);if(m){ayMap[m]=ayMap[m]||{s:0,a:0,gs:0,ga:0};if(r.tip==='acenta')ayMap[m].ga+=r.tutar;else ayMap[m].gs+=r.tutar;}});
  document.getElementById('rapor-aylik-tbody').innerHTML = Object.keys(ayMap).sort((a,b)=>+a-+b).map(m=>{
    const d=ayMap[m]; const t=d.s+d.a; const g=(d.gs||0)+(d.ga||0); const n=t-g;
    return `<tr>
      <td class="fw">${MONTHS_FULL[m]}</td>
      <td style="color:var(--teal2)">${money(d.s)}</td>
      <td style="color:var(--gold2)">${money(d.a)}</td>
      <td class="fw">${money(t)}</td>
      <td style="color:var(--red2)">${money((d.gs||0)+(d.ga||0))}<div style="font-size:9px;color:var(--ink3)">â›µ${money(d.gs||0)} ğŸ¤${money(d.ga||0)}</div></td>
      <td class="fw" style="color:${n>=0?'var(--green2)':'var(--red2)'}">${money(n)}</td>
    </tr>`;
  }).join('');

  // Tekne bazlÄ±
  const tkMap={};
  DB.simay.forEach(r=>{tkMap[r.tekne]=tkMap[r.tekne]||{c:0,n:0};tkMap[r.tekne].c+=r.bedel;tkMap[r.tekne].n++});
  const maxC=Math.max(...Object.values(tkMap).map(v=>v.c),1);
  document.getElementById('rapor-tekne').innerHTML = Object.entries(tkMap).sort((a,b)=>b[1].c-a[1].c).map(([t,v])=>`
    <div class="hbar-row">
      <div class="hbar-head"><span class="hbar-name">${t}</span><span class="hbar-val" style="color:var(--teal2)">${money(v.c)}</span></div>
      <div class="hbar-bg"><div class="hbar-fill" style="width:${v.c/maxC*100}%;background:linear-gradient(90deg,#0b7a6e,#18b4a2)"></div></div>
      <div class="hbar-detail">${v.n} satÄ±ÅŸ Â· Ort. ${money(v.c/v.n)} Â· %${(v.c/simayT*100).toFixed(1)} pay</div>
    </div>`).join('') || '<div class="empty-state"><div class="es-text">Veri yok</div></div>';

  // Sorumlu
  const sMap={};
  DB.acente.forEach(r=>{const s=(r.sorumlu||'â€”').trim();sMap[s]=sMap[s]||{k:0,n:0};sMap[s].k+=r.kar;sMap[s].n++});
  const topS=Object.values(sMap).reduce((a,v)=>a+v.k,0);
  document.getElementById('rapor-sorumlu').innerHTML = Object.entries(sMap).sort((a,b)=>b[1].k-a[1].k).map(([n,v],i)=>`
    <div class="hbar-row">
      <div class="hbar-head"><span class="hbar-name">${i+1}. ${n}</span><span class="hbar-val" style="color:var(--green2)">${money(v.k)}</span></div>
      <div class="hbar-bg"><div class="hbar-fill" style="width:${topS?v.k/topS*100:0}%;background:linear-gradient(90deg,#156b3a,#22c55e)"></div></div>
      <div class="hbar-detail">${v.n} satÄ±ÅŸ Â· %${topS?(v.k/topS*100).toFixed(1):'0'} pay</div>
    </div>`).join('') || '<div class="empty-state"><div class="es-text">Veri yok</div></div>';

  // Acenta bazlÄ± Simay satÄ±ÅŸlarÄ±
  const acMap={};
  DB.simay.forEach(r=>{
    const a = (r.acente||'').trim();
    if(!a) return;
    acMap[a]=acMap[a]||{c:0,n:0};
    acMap[a].c+=r.bedel;
    acMap[a].n++;
  });
  const dogrudan = DB.simay.filter(r=>!(r.acente||'').trim()).length;
  const dogruCiro = DB.simay.filter(r=>!(r.acente||'').trim()).reduce((a,r)=>a+r.bedel,0);
  const acEl = document.getElementById('rapor-acente-simay');
  if(!Object.keys(acMap).length && !DB.simay.length){
    acEl.innerHTML='<div class="empty-state"><div class="es-text">HenÃ¼z Simay satÄ±ÅŸÄ± yok</div></div>';
  } else {
    const maxAc = Math.max(...Object.values(acMap).map(v=>v.c), dogruCiro, 1);
    const rows = Object.entries(acMap).sort((a,b)=>b[1].c-a[1].c).map(([a,v],i)=>`
      <div class="hbar-row">
        <div class="hbar-head">
          <span class="hbar-name" style="display:flex;align-items:center;gap:6px">
            <span style="background:rgba(108,92,231,.18);color:#c39bd3;border:1px solid rgba(108,92,231,.3);border-radius:20px;padding:1px 8px;font-size:9px;font-weight:700;">${a}</span>
          </span>
          <span class="hbar-val" style="color:#c39bd3">${money(v.c)}</span>
        </div>
        <div class="hbar-bg"><div class="hbar-fill" style="width:${v.c/maxAc*100}%;background:linear-gradient(90deg,#6c5ce7,#c39bd3)"></div></div>
        <div class="hbar-detail">${v.n} satÄ±ÅŸ Â· Ort. ${money(v.c/v.n)} Â· %${simayT?(v.c/simayT*100).toFixed(1):'0'} pay</div>
      </div>`).join('');
    const dogruRow = dogrudan>0 ? `
      <div class="hbar-row">
        <div class="hbar-head">
          <span class="hbar-name" style="display:flex;align-items:center;gap:6px">
            <span style="background:rgba(11,122,110,.18);color:var(--teal2);border:1px solid rgba(11,122,110,.3);border-radius:20px;padding:1px 8px;font-size:9px;font-weight:700;">DoÄŸrudan SatÄ±ÅŸ</span>
          </span>
          <span class="hbar-val" style="color:var(--teal2)">${money(dogruCiro)}</span>
        </div>
        <div class="hbar-bg"><div class="hbar-fill" style="width:${dogruCiro/maxAc*100}%;background:linear-gradient(90deg,#0b7a6e,#18b4a2)"></div></div>
        <div class="hbar-detail">${dogrudan} satÄ±ÅŸ Â· %${simayT?(dogruCiro/simayT*100).toFixed(1):'0'} pay</div>
      </div>` : '';
    acEl.innerHTML = (rows || '') + dogruRow || '<div class="empty-state"><div class="es-text">Acente verisi yok (tÃ¼m satÄ±ÅŸlar doÄŸrudan)</div></div>';
  }

  // Rezervasyon alÄ±m tarihi analizi (ts = sisteme girilen tarih)
  const alisMap = {};
  DB.simay.forEach(r => {
    if(!r.ts) return;
    const d = new Date(r.ts);
    const m = d.getMonth()+1;
    alisMap[m] = alisMap[m] || {s:0,sN:0,a:0,aN:0};
    alisMap[m].s += r.bedel;
    alisMap[m].sN++;
  });
  DB.acente.forEach(r => {
    if(!r.ts) return;
    const d = new Date(r.ts);
    const m = d.getMonth()+1;
    alisMap[m] = alisMap[m] || {s:0,sN:0,a:0,aN:0};
    alisMap[m].a += r.kar;
    alisMap[m].aN++;
  });

  const alisEl = document.getElementById('rapor-alis-tarihi');
  const alisAylar = Object.keys(alisMap).map(Number).sort((a,b)=>a-b);
  if(!alisAylar.length){
    alisEl.innerHTML='<div class="empty-state"><div class="es-text">HenÃ¼z kayÄ±t yok</div></div>';
  } else {
    const maxAlis = Math.max(...alisAylar.map(m=>alisMap[m].sN+alisMap[m].aN),1);
    const toplamRez = alisAylar.reduce((a,m)=>a+alisMap[m].sN+alisMap[m].aN,0);
    const toplamCiro = alisAylar.reduce((a,m)=>a+alisMap[m].s+alisMap[m].a,0);

    alisEl.innerHTML = `
      <div style="display:flex;gap:16px;margin-bottom:18px;flex-wrap:wrap">
        <div style="flex:1;min-width:120px;text-align:center;padding:12px;background:rgba(255,255,255,.03);border-radius:10px;border:1px solid var(--border)">
          <div style="font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:6px">Toplam SatÄ±lan Rezervasyon</div>
          <div style="font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:700;color:var(--teal2)">${toplamRez}</div>
        </div>
        <div style="flex:1;min-width:120px;text-align:center;padding:12px;background:rgba(255,255,255,.03);border-radius:10px;border:1px solid var(--border)">
          <div style="font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:6px">En YoÄŸun Ay</div>
          <div style="font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:700;color:var(--gold2)">${MONTHS_FULL[alisAylar.reduce((best,m)=>(alisMap[m].sN+alisMap[m].aN)>(alisMap[best]?alisMap[best].sN+alisMap[best].aN:0)?m:best, alisAylar[0])]}</div>
        </div>
        <div style="flex:1;min-width:120px;text-align:center;padding:12px;background:rgba(255,255,255,.03);border-radius:10px;border:1px solid var(--border)">
          <div style="font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);margin-bottom:6px">Toplam Ciro (SatÄ±ÅŸ AnÄ±)</div>
          <div style="font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:700;color:var(--green2)">${money(toplamCiro)}</div>
        </div>
      </div>

      <div style="overflow-x:auto">
        <table style="width:100%;border-collapse:collapse;font-size:11px">
          <thead><tr style="background:rgba(255,255,255,0.035)">
            <th style="padding:10px 13px;text-align:left;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600;border-bottom:1px solid var(--border)">Ay</th>
            <th style="padding:10px 13px;text-align:left;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600;border-bottom:1px solid var(--border)">Simay Rez.</th>
            <th style="padding:10px 13px;text-align:left;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600;border-bottom:1px solid var(--border)">Simay Ciro</th>
            <th style="padding:10px 13px;text-align:left;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600;border-bottom:1px solid var(--border)">Acente Rez.</th>
            <th style="padding:10px 13px;text-align:left;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600;border-bottom:1px solid var(--border)">Acente KÃ¢r</th>
            <th style="padding:10px 13px;text-align:left;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600;border-bottom:1px solid var(--border)">Toplam Rez.</th>
            <th style="padding:10px 13px;text-align:left;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--ink3);font-weight:600;border-bottom:1px solid var(--border)">DaÄŸÄ±lÄ±m</th>
          </tr></thead>
          <tbody>
            ${alisAylar.map(m=>{
              const d=alisMap[m];
              const tot=d.sN+d.aN;
              const pct=(tot/maxAlis*100).toFixed(0);
              return `<tr style="border-bottom:1px solid rgba(255,255,255,0.03)">
                <td style="padding:10px 13px;font-weight:600;color:#e4eef6">${MONTHS_FULL[m]}</td>
                <td style="padding:10px 13px"><span style="font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--teal2)">${d.sN}</span> <span style="font-size:9px;color:var(--ink3)">rezervasyon</span></td>
                <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:14px;font-weight:700;color:var(--teal2)">${money(d.s)}</td>
                <td style="padding:10px 13px"><span style="font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--gold2)">${d.aN}</span> <span style="font-size:9px;color:var(--ink3)">rezervasyon</span></td>
                <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:14px;font-weight:700;color:var(--gold2)">${money(d.a)}</td>
                <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:700;color:#e4eef6">${tot}</td>
                <td style="padding:10px 13px;min-width:120px">
                  <div style="height:6px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden;display:flex">
                    <div style="height:100%;width:${d.sN/maxAlis*100}%;background:linear-gradient(90deg,#0b7a6e,#18b4a2)"></div>
                    <div style="height:100%;width:${d.aN/maxAlis*100}%;background:linear-gradient(90deg,#be8a20,#e8b84b);margin-left:1px"></div>
                  </div>
                  <div style="font-size:9px;color:var(--ink3);margin-top:3px">%${(tot/toplamRez*100).toFixed(1)} pay</div>
                </td>
              </tr>`;
            }).join('')}
            <tr style="background:rgba(255,255,255,0.02)">
              <td style="padding:10px 13px;font-weight:700;color:#e4eef6">TOPLAM</td>
              <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--teal2)">${alisAylar.reduce((a,m)=>a+alisMap[m].sN,0)}</td>
              <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:14px;font-weight:700;color:var(--teal2)">${money(alisAylar.reduce((a,m)=>a+alisMap[m].s,0))}</td>
              <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:700;color:var(--gold2)">${alisAylar.reduce((a,m)=>a+alisMap[m].aN,0)}</td>
              <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:14px;font-weight:700;color:var(--gold2)">${money(alisAylar.reduce((a,m)=>a+alisMap[m].a,0))}</td>
              <td style="padding:10px 13px;font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:700;color:var(--green2)">${toplamRez}</td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadSettings(){
  DB=await dbLoad(activeYil);
  const yilGoster = document.getElementById('s-yil-goster');
  if(yilGoster) yilGoster.textContent = activeYil;
  document.getElementById('s-hedef').value=DB.cfg.hedef||1200000;
  document.getElementById('s-tekneler').value=DB.cfg.tekneler||'SÄ°MAY M,SÄ°MAY F,SÄ°MAY S,JR. SÄ°MAY';
  renderSorumluSettings();
  loadBankaSettings();
  // Tema durumu
  const isLight = localStorage.getItem(getThemeKey()) === 'light';
  const chk = document.getElementById('s-tema');
  const lbl = document.getElementById('s-tema-lbl');
  if(chk) chk.checked = isLight;
  if(lbl) lbl.textContent = isLight ? 'â˜€ï¸ GÃ¼ndÃ¼z' : 'ğŸŒ™ Gece';
}
async function saveSettings(){
  DB.cfg.yil=activeYil;
  DB.cfg.hedef=parseFloat(document.getElementById('s-hedef').value)||1200000;
  DB.cfg.tekneler=document.getElementById('s-tekneler').value.trim();
  await dbSave(DB); buildTekneSelect(); await updateSidebar();
  toast('Ayarlar kaydedildi âœ“');
}
async function resetData(){
  if(!confirm('TÃœM VERÄ°LER SÄ°LÄ°NECEK! Emin misiniz?')) return;
  if(!confirm('Son kez onaylayÄ±n â€” bu iÅŸlem geri alÄ±namaz.')) return;
  const cfg=DB.cfg;
  DB=defaultDB(); DB.cfg=cfg;
  await dbSave(DB); await updateSidebar();
  toast('TÃ¼m veriler sÄ±fÄ±rlandÄ±','info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CSV EXPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportCSV(type){
  // DB zaten yÃ¼klenmiÅŸ durumda
  let csv='\ufeff';
  if(!type || type==='simay'){
    csv+='SÄ°MAY TEKNELERÄ°\r\n';
    csv+='SÄ±ra,Misafir,Tekne,GiriÅŸ LimanÄ±,GiriÅŸ Tarihi,Ã‡Ä±kÄ±ÅŸ LimanÄ±,Ã‡Ä±kÄ±ÅŸ Tarihi,SÃ¼re(gece),Tur Bedeli(EUR),Ã–n Ã–deme(EUR),Kalan(EUR),Sorumlu,Acente\r\n';
    DB.simay.forEach((r,i)=>{
      csv+=`${i+1},"${r.misafir}","${r.tekne}","${r.gliman||''}","${fmtDate(r.giris)}","${r.climan||''}","${fmtDate(r.cikis)}",${daysBetween(r.giris,r.cikis)},${r.bedel},${r.on||0},${r.kalan||0},"${r.sorumlu||''}","${r.acente||''}"\r\n`;
    });
    csv+=`,,,,,,,,${DB.simay.reduce((a,r)=>a+r.bedel,0)},,\r\n\r\n`;
  }
  if(!type || type==='acente'){
    csv+='ACENTE / DIÅ SATIÅ\r\n';
    csv+='SÄ±ra,Misafir,Tekne,GiriÅŸ LimanÄ±,Ã‡Ä±kÄ±ÅŸ LimanÄ±,GiriÅŸ Tarihi,Ã‡Ä±kÄ±ÅŸ Tarihi,Tur Bedeli(EUR),Tekneye(EUR),Åirket KÃ¢rÄ±(EUR),Sorumlu\r\n';
    DB.acente.forEach((r,i)=>{
      csv+=`${i+1},"${r.misafir}","${r.tekne}","${r.gliman||''}","${r.climan||''}","${fmtDate(r.giris)}","${fmtDate(r.cikis)}",${r.bedel},${r.todeme||0},${r.kar},"${r.sorumlu||''}"\r\n`;
    });
    csv+=`,,,,,,,${DB.acente.reduce((a,r)=>a+r.kar,0)},\r\n\r\n`;
  }
  if(!type || type==='gider'){
    csv+='GÄ°DER KAYITLARI\r\n';
    csv+='SÄ±ra,Tarih,Kategori,AÃ§Ä±klama,Tutar(EUR)\r\n';
    DB.giderler.forEach((r,i)=>{
      csv+=`${i+1},"${fmtDate(r.tarih)}","${r.kat}","${r.aciklama||''}",${r.tutar}\r\n`;
    });
    csv+=`,,,,${DB.giderler.reduce((a,r)=>a+r.tutar,0)}\r\n\r\n`;
  }
  if(!type){
    const sT=DB.simay.reduce((a,r)=>a+r.bedel,0);
    const aT=DB.acente.reduce((a,r)=>a+r.kar,0);
    const gT=DB.giderler.reduce((a,r)=>a+r.tutar,0);
    csv+=`Ã–ZET\r\nSimay Cirosu,${sT}\r\nAcente KÃ¢rÄ±,${aT}\r\nToplam Gelir,${sT+aT}\r\nToplam Gider,${gT}\r\nNet KÃ¢r,${sT+aT-gT}\r\nHedef,%${DB.cfg.hedef>0?((sT+aT)/DB.cfg.hedef*100).toFixed(1):0}\r\n`;
  }
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
  a.download=`Simay_${type||'TamRapor'}_${DB.cfg.yil||2025}.csv`;
  a.click(); toast('CSV indirildi âœ“');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doLogin(){
  const email = document.getElementById('login-email').value.trim();
  const pass = document.getElementById('login-password').value;
  const btn = document.getElementById('login-btn');
  const err = document.getElementById('login-error');
  if(!email || !pass){ err.textContent='E-posta ve ÅŸifre giriniz.'; err.classList.add('show'); return; }
  btn.disabled = true;
  btn.textContent = 'GiriÅŸ yapÄ±lÄ±yor...';
  err.classList.remove('show');
  try {
    await auth.signInWithEmailAndPassword(email, pass);
    // onAuthStateChanged devreye girecek
  } catch(e) {
    console.error('Login error:', e.code, e.message);
    const msgMap = {
      'auth/invalid-email': 'GeÃ§ersiz e-posta adresi.',
      'auth/user-not-found': 'Bu e-posta ile kayÄ±tlÄ± kullanÄ±cÄ± bulunamadÄ±.',
      'auth/wrong-password': 'Åifre hatalÄ±. LÃ¼tfen tekrar deneyin.',
      'auth/invalid-credential': 'E-posta veya ÅŸifre hatalÄ±.',
      'auth/too-many-requests': 'Ã‡ok fazla baÅŸarÄ±sÄ±z deneme. LÃ¼tfen bekleyin.',
      'auth/network-request-failed': 'Ä°nternet baÄŸlantÄ±sÄ± yok.',
    };
    err.textContent = msgMap[e.code] || ('Hata: ' + (e.code || e.message));
    err.classList.add('show');
    btn.disabled = false;
    btn.textContent = 'GiriÅŸ Yap';
  }
}

async function doLogout(){
  await auth.signOut();
}

// Enter tuÅŸu ile giriÅŸ
document.addEventListener('keydown', e => {
  if(e.key === 'Enter' && !document.getElementById('login-screen').classList.contains('hidden')){
    doLogin();
  }
});

// GiriÅŸ/Ã§Ä±kÄ±ÅŸ durumu takibi
auth.onAuthStateChanged(async (user) => {
  if(user){
    // GiriÅŸ yapÄ±ldÄ±
    document.getElementById('login-screen').classList.add('hidden');
    document.getElementById('app').style.display = 'flex';
    // KullanÄ±cÄ± bilgisini sidebar'a ekle
    const userEl = document.getElementById('sb-user');
    if(userEl) userEl.textContent = user.email;
    activeYil = new Date().getFullYear();
    isReadOnly = false;
    updateYilSelector();
    loadTheme();
    showLoading();
    DB = await dbLoad(activeYil);
    buildTekneSelect();
    buildSorumluSelect();
    buildAllBankaSelects();
    document.getElementById('fg-tarih').value = today();
    await renderDashboard();
    await updateSidebar();
    hideLoading();
  } else {
    // Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±
    document.getElementById('login-screen').classList.remove('hidden');
    document.getElementById('app').style.display = 'none';
    document.getElementById('login-btn').disabled = false;
    document.getElementById('login-btn').textContent = 'GiriÅŸ Yap';
    document.getElementById('login-password').value = '';
  }
});


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DETAY MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSimayDetail(id){
  const r = DB.simay.find(x=>x.id===id); if(!r) return;
  const gun = daysBetween(r.giris,r.cikis);
  document.getElementById('modal-detay-title').textContent = 'â›µ ' + r.misafir;
  document.getElementById('modal-detay-content').innerHTML = `
    <div class="detail-section">Genel Bilgiler</div>
    <div class="detail-grid">
      <div class="detail-item"><div class="detail-lbl">Misafir</div><div class="detail-val">${r.misafir}</div></div>
      <div class="detail-item"><div class="detail-lbl">Tekne</div><div class="detail-val"><span class="badge b-simay">${r.tekne}</span></div></div>
      <div class="detail-item"><div class="detail-lbl">GiriÅŸ LimanÄ±</div><div class="detail-val">${r.gliman||'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">Ã‡Ä±kÄ±ÅŸ LimanÄ±</div><div class="detail-val">${r.climan||'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">GiriÅŸ Tarihi</div><div class="detail-val">${fmtDate(r.giris)}</div></div>
      <div class="detail-item"><div class="detail-lbl">Ã‡Ä±kÄ±ÅŸ Tarihi</div><div class="detail-val">${fmtDate(r.cikis)}</div></div>
      <div class="detail-item"><div class="detail-lbl">SÃ¼re</div><div class="detail-val">${gun>0?gun+' gece':'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">SatÄ±ÅŸ Sorumlusu</div><div class="detail-val">${r.sorumlu||'â€”'}</div></div>
      ${r.acente?`<div class="detail-item"><div class="detail-lbl">Acenta</div><div class="detail-val"><span class="badge" style="background:rgba(108,92,231,.18);color:#c39bd3;border:1px solid rgba(108,92,231,.3)">${r.acente}</span></div></div>`:''}
    </div>
    <div class="detail-section">Ã–deme Bilgileri</div>
    <div class="detail-grid">
      <div class="detail-item"><div class="detail-lbl">Para Birimi</div><div class="detail-val"><span class="badge" style="background:rgba(11,122,110,.15);color:var(--teal2);border:1px solid rgba(11,122,110,.25)">${r.para||'EUR'}</span></div></div>
      <div class="detail-item"><div class="detail-lbl">Tur Bedeli (Orijinal)</div><div class="detail-val mono" style="color:var(--teal2)">${r.para==='USD'?'$ '+(r.bedel||0).toLocaleString('tr-TR',{minimumFractionDigits:2}):r.para==='TRY'?'â‚º '+(r.bedel||0).toLocaleString('tr-TR',{minimumFractionDigits:2}):money(r.bedel)}</div></div>
      ${r.para&&r.para!=='EUR'&&r.bedelEur?`<div class="detail-item"><div class="detail-lbl">Euro KarÅŸÄ±lÄ±ÄŸÄ±</div><div class="detail-val mono" style="color:var(--gold2)">${money(r.bedelEur)}</div></div>`:''}
      <div class="detail-item"><div class="detail-lbl">KDV OranÄ±</div><div class="detail-val">${r.kdvOran?'%'+r.kdvOran:'KDV Yok'}</div></div>
      <div class="detail-item"><div class="detail-lbl">KDV TutarÄ±</div><div class="detail-val mono" style="color:var(--gold2)">${r.kdvTutar?money(r.kdvTutar):'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">KDV'li Toplam</div><div class="detail-val mono" style="color:var(--gold2)">${r.kdvliBedel?money(r.kdvliBedel):'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">Ã–n Ã–deme</div><div class="detail-val mono" style="color:var(--green2)">${money(r.on)}</div></div>
      <div class="detail-item"><div class="detail-lbl">Kalan Tutar</div><div class="detail-val mono" style="color:var(--red2)">${money(r.kalan)}</div></div>
    </div>
    ${r.aciklama?`<div class="detail-section">Not</div><div style="font-size:12px;color:var(--ink2);padding:8px 0">${r.aciklama}</div>`:''}
  `;
  openModal('modal-detay');
}

function showAcenteDetail(id){
  const r = DB.acente.find(x=>x.id===id); if(!r) return;
  const gun = daysBetween(r.giris,r.cikis);
  document.getElementById('modal-detay-title').textContent = 'ğŸ¤ ' + r.misafir;
  document.getElementById('modal-detay-content').innerHTML = `
    <div class="detail-section">Genel Bilgiler</div>
    <div class="detail-grid">
      <div class="detail-item"><div class="detail-lbl">Misafir</div><div class="detail-val">${r.misafir}</div></div>
      <div class="detail-item"><div class="detail-lbl">Tekne</div><div class="detail-val">${r.tekne}</div></div>
      <div class="detail-item"><div class="detail-lbl">GiriÅŸ LimanÄ±</div><div class="detail-val">${r.gliman||'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">Ã‡Ä±kÄ±ÅŸ LimanÄ±</div><div class="detail-val">${r.climan||'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">GiriÅŸ Tarihi</div><div class="detail-val">${fmtDate(r.giris)}</div></div>
      <div class="detail-item"><div class="detail-lbl">Ã‡Ä±kÄ±ÅŸ Tarihi</div><div class="detail-val">${fmtDate(r.cikis)}</div></div>
      <div class="detail-item"><div class="detail-lbl">SÃ¼re</div><div class="detail-val">${gun>0?gun+' gece':'â€”'}</div></div>
      <div class="detail-item"><div class="detail-lbl">SatÄ±ÅŸ Sorumlusu</div><div class="detail-val">${r.sorumlu||'â€”'}</div></div>
    </div>
    <div class="detail-section">Ã–deme Bilgileri</div>
    <div class="detail-grid">
      <div class="detail-item"><div class="detail-lbl">Toplam SatÄ±ÅŸ</div><div class="detail-val mono" style="color:var(--teal2)">${money(r.bedel)}</div></div>
      <div class="detail-item"><div class="detail-lbl">MÃ¼ÅŸteri Ã–n Ã–deme</div><div class="detail-val mono" style="color:var(--green2)">${money(r.on)}</div></div>
      <div class="detail-item"><div class="detail-lbl">MÃ¼ÅŸteri Kalan</div><div class="detail-val mono" style="color:var(--red2)">${money(r.kalan)}</div></div>
      <div class="detail-item"><div class="detail-lbl">Tekne Ã–demesi</div><div class="detail-val mono" style="color:var(--gold2)">${money(r.todeme)}</div></div>
      <div class="detail-item"><div class="detail-lbl">Tekneye Ã–n Ã–deme</div><div class="detail-val mono" style="color:var(--green2)">${money(r.ton||0)}</div></div>
      <div class="detail-item"><div class="detail-lbl">Tekneye Kalan</div><div class="detail-val mono" style="color:var(--gold2)">${money(r.tkalan||0)}</div></div>
      <div class="detail-item"><div class="detail-lbl">Åirket KÃ¢rÄ±</div><div class="detail-val mono" style="color:var(--green2);font-size:20px">${money(r.kar)}</div></div>
    </div>
    ${r.aciklama?`<div class="detail-section">Not</div><div style="font-size:12px;color:var(--ink2);padding:8px 0">${r.aciklama}</div>`:''}
  `;
  openModal('modal-detay');
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TEMA (kullanÄ±cÄ± bazlÄ± localStorage)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getThemeKey(){ return 'simay_tema_' + (auth.currentUser?.uid || 'default'); }

function applyTheme(light){
  if(light){
    document.body.classList.add('light-mode');
  } else {
    document.body.classList.remove('light-mode');
  }
  const lbl = document.getElementById('s-tema-lbl');
  const chk = document.getElementById('s-tema');
  if(lbl) lbl.textContent = light ? 'â˜€ï¸ GÃ¼ndÃ¼z' : 'ğŸŒ™ Gece';
  if(chk) chk.checked = light;
}

function loadTheme(){
  const saved = localStorage.getItem(getThemeKey());
  applyTheme(saved === 'light');
}

function toggleTheme(isLight){
  localStorage.setItem(getThemeKey(), isLight ? 'light' : 'dark');
  applyTheme(isLight);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SATIÅ SORUMLUSU YÃ–NETÄ°MÄ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getSorumlular(){
  return DB.cfg.sorumlular || ['Fatih Tok','Yasin YenigÃ¼n'];
}

function buildSorumluSelect(){
  const list = getSorumlular();
  ['fs-sorumlu','fa-sorumlu'].forEach(id => {
    const sel = document.getElementById(id);
    if(!sel) return;
    const current = sel.value;
    sel.innerHTML = '<option value="">-- SeÃ§in --</option>' +
      list.map(s => `<option value="${s}"${s===current?' selected':''}>${s}</option>`).join('');
  });
}

function renderSorumluSettings(){
  const list = getSorumlular();
  const el = document.getElementById('s-sorumlular-list');
  if(!el) return;
  el.innerHTML = list.map((s,i) => `
    <div style="display:flex;align-items:center;gap:5px;background:rgba(11,122,110,0.1);border:1px solid rgba(11,122,110,0.2);border-radius:20px;padding:4px 10px 4px 12px">
      <span style="font-size:11px;color:var(--teal2);font-weight:500">${s}</span>
      <button onclick="removeSorumlu(${i})" style="background:none;border:none;color:var(--ink3);cursor:pointer;font-size:12px;line-height:1;padding:0 2px" title="Sil">âœ•</button>
    </div>`).join('');
}

async function addSorumlu(){
  const inp = document.getElementById('s-yeni-sorumlu');
  const val = inp.value.trim();
  if(!val){ toast('Ä°sim giriniz','err'); return; }
  if(!DB.cfg.sorumlular) DB.cfg.sorumlular = ['Fatih Tok','Yasin YenigÃ¼n'];
  if(DB.cfg.sorumlular.includes(val)){ toast('Bu sorumlu zaten var','err'); return; }
  DB.cfg.sorumlular.push(val);
  await dbSave(DB);
  inp.value = '';
  renderSorumluSettings();
  buildSorumluSelect();
  toast(val + ' eklendi âœ“');
}

async function removeSorumlu(idx){
  if(!confirm('Bu sorumluyu silmek istiyor musunuz?')) return;
  if(!DB.cfg.sorumlular) DB.cfg.sorumlular = ['Fatih Tok','Yasin YenigÃ¼n'];
  DB.cfg.sorumlular.splice(idx, 1);
  await dbSave(DB);
  renderSorumluSettings();
  buildSorumluSelect();
  toast('Sorumlu silindi','info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TCMB KUR Ã‡EKÄ°MÄ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchKur(){
  const kurInp = document.getElementById('fg-kur');
  if(!kurInp) return;
  try {
    // TCMB XML API - CORS proxy ile
    const res = await fetch('https://api.exchangerate-api.com/v4/latest/EUR');
    if(res.ok){
      const data = await res.json();
      const kurTRY = data.rates && data.rates.TRY;
      if(kurTRY){
        kurInp.value = kurTRY.toFixed(4);
        calcGiderEur();
        toast('GÃ¼ncel kur alÄ±ndÄ±: 1â‚¬ = â‚º' + kurTRY.toFixed(2));
        return;
      }
    }
  } catch(e){}
  // Fallback: manuel giriÅŸ
  toast('Kur otomatik alÄ±namadÄ± â€” lÃ¼tfen manuel girin','info');
}

function toggleGiderPara(){
  const para = document.getElementById('fg-para').value;
  const kurWrap = document.getElementById('fg-kur-wrap');
  const eurWrap = document.getElementById('fg-eur-wrap');
  const lbl = document.getElementById('fg-tutar-lbl');
  if(para === 'TRY'){
    kurWrap.style.display = '';
    eurWrap.style.display = '';
    lbl.textContent = 'Tutar (â‚º) *';
    fetchKur();
  } else {
    kurWrap.style.display = 'none';
    eurWrap.style.display = 'none';
    lbl.textContent = 'Tutar (â‚¬) *';
  }
  calcGiderEur();
}

function calcGiderEur(){
  const para = document.getElementById('fg-para')?.value;
  if(para !== 'TRY') return;
  const tutar = parseFloat(document.getElementById('fg-tutar').value)||0;
  const kur = parseFloat(document.getElementById('fg-kur').value)||0;
  const eur = kur > 0 ? (tutar / kur) : 0;
  const eurInp = document.getElementById('fg-eur');
  if(eurInp) eurInp.value = eur > 0 ? eur.toFixed(2) : '';
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FATURA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcFaturaKdv(){
  const t = parseFloat(document.getElementById('ff-tutar').value)||0;
  const oran = parseFloat(document.getElementById('ff-kdv-oran').value)||0;
  const kdv = t * oran / 100;
  document.getElementById('ff-kdv-tutar').value = kdv>0 ? kdv.toFixed(2) : '';
  document.getElementById('ff-toplam').value = t>0 ? (t+kdv).toFixed(2) : '';
  calcFaturaKalan();
}

function calcFaturaKalan(){
  const top = parseFloat(document.getElementById('ff-toplam').value)||0;
  const ode = parseFloat(document.getElementById('ff-odenen').value)||0;
  document.getElementById('ff-kalan').value = top>0 ? (top-ode).toFixed(2) : '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BANKA YÃ–NETÄ°MÄ°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getBankalar(){
  return DB.cfg.bankalar || ['Garanti Euro','Garanti Dolar','Garanti TL','Ä°ÅŸ BankasÄ± Euro','Ä°ÅŸ BankasÄ± Dolar','Ä°ÅŸ BankasÄ± TL'];
}
function buildBankaSelect(elId){
  const sel = document.getElementById(elId); if(!sel) return;
  const list = getBankalar();
  sel.innerHTML = '<option value="">-- Banka SeÃ§in --</option>' + list.map(b=>`<option value="${b}">${b}</option>`).join('');
}
function buildAllBankaSelects(){
  buildBankaSelect('fs-banka');
  buildBankaSelect('fa-banka');
}
function loadBankaSettings(){
  const list = getBankalar();
  const cont = document.getElementById('s-bankalar-list'); if(!cont) return;
  cont.innerHTML = list.map((b,i)=>`<span style="display:inline-flex;align-items:center;gap:5px;background:rgba(26,74,122,0.15);border:1px solid rgba(96,165,250,0.25);border-radius:20px;padding:4px 10px 4px 12px;font-size:11px;color:var(--blue2)">ğŸ¦ ${b}<button onclick="removeBanka(${i})" style="background:none;border:none;cursor:pointer;color:var(--ink3);font-size:12px;padding:0;line-height:1;margin-left:2px">âœ•</button></span>`).join('');
}
async function addBanka(){
  const input = document.getElementById('s-yeni-banka');
  const val = input.value.trim(); if(!val) return;
  if(!DB.cfg.bankalar) DB.cfg.bankalar = getBankalar();
  if(DB.cfg.bankalar.includes(val)){ toast('Bu banka zaten ekli','info'); return; }
  DB.cfg.bankalar.push(val);
  input.value='';
  await dbSave(DB); loadBankaSettings(); buildAllBankaSelects(); toast('Banka eklendi âœ“');
}
async function removeBanka(idx){
  if(!DB.cfg.bankalar) DB.cfg.bankalar = getBankalar();
  DB.cfg.bankalar.splice(idx,1);
  await dbSave(DB); loadBankaSettings(); buildAllBankaSelects(); toast('Banka silindi','info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OTOMATÄ°K FATURA OLUÅTUR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function autoCreateFatura(r, tip){
  if(!DB.faturalar) DB.faturalar=[];
  const tutar = r.bedel||0;
  const fNo = (tip==='simay'?'SIM':'ACT') + '-' + activeYil + '-' + String(DB.faturalar.length+1).padStart(3,'0');
  const fatura = {
    id: uid(), ts: Date.now(),
    no: fNo, tur: 'gelir',
    tarih: r.giris || today(),
    vade: r.cikis || '',
    musteri: r.misafir,
    aciklama: (tip==='simay'?'Simay Tekneleri â€” ':'Acente/DÄ±ÅŸ SatÄ±ÅŸ â€” ') + r.tekne + (r.gliman?' ('+r.gliman+(r.climan?' â†’ '+r.climan:'')+')'  : ''),
    tutar, kdvOran: r.kdvOran||0, kdv: r.kdvTutar||0,
    toplam: r.kdvliBedel||tutar,
    odenen: r.on||0,
    kalan: r.kalan||(tutar-(r.on||0)),
    durum: (r.odemeDurum==='odendi')?'odendi':(r.on>0?'kismi':'bekliyor'),
    kesimDurum: r.faturaDurum||'kesilmedi',
    para: r.para||'EUR',
    rezervasyon: r.misafir,
    rezervasyonId: r.id,
    not: r.aciklama||'',
  };
  DB.faturalar.push(fatura);
  toast('Fatura otomatik oluÅŸturuldu âœ“');
}

function clearFaturaForm(){
  ['ff-no','ff-tarih','ff-vade','ff-musteri','ff-aciklama','ff-tutar','ff-kdv-tutar','ff-toplam','ff-odenen','ff-kalan','ff-rezervasyon','ff-not','ff-id'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.value='';
  });
  document.getElementById('ff-tur').value='gelir';
  document.getElementById('ff-kdv-oran').value='0';
  document.getElementById('ff-durum').value='bekliyor';
  const fk=document.getElementById('ff-kesim-durum'); if(fk) fk.value='kesilmedi';
  const fp=document.getElementById('ff-para'); if(fp) fp.value='EUR';
}

async function saveFatura(){
  if(isReadOnly){ toast('GeÃ§miÅŸ yÄ±l â€” kayÄ±t eklenemez','err'); closeModal('modal-fatura'); return; }
  const id = document.getElementById('ff-id').value;
  const tutar = parseFloat(document.getElementById('ff-tutar').value)||0;
  const kdvOran = parseFloat(document.getElementById('ff-kdv-oran').value)||0;
  const kdv = tutar*kdvOran/100;
  const r = {
    id: id||uid(), ts: Date.now(),
    no: document.getElementById('ff-no').value.trim(),
    tur: document.getElementById('ff-tur').value,
    tarih: document.getElementById('ff-tarih').value,
    vade: document.getElementById('ff-vade').value,
    musteri: document.getElementById('ff-musteri').value.trim(),
    aciklama: document.getElementById('ff-aciklama').value.trim(),
    tutar, kdvOran, kdv, toplam: tutar+kdv,
    odenen: parseFloat(document.getElementById('ff-odenen').value)||0,
    kalan: parseFloat(document.getElementById('ff-kalan').value)||0,
    durum: document.getElementById('ff-durum').value,
    kesimDurum: document.getElementById('ff-kesim-durum')?.value||'kesilmedi',
    para: document.getElementById('ff-para')?.value||'EUR',
    rezervasyon: document.getElementById('ff-rezervasyon').value.trim(),
    not: document.getElementById('ff-not').value.trim(),
  };
  if(!r.no || !r.tarih || !r.musteri){ toast('Fatura no, tarih ve mÃ¼ÅŸteri zorunlu','err'); return; }
  if(!DB.faturalar) DB.faturalar=[];
  if(id){ DB.faturalar=DB.faturalar.map(x=>x.id===id?r:x); toast('Fatura gÃ¼ncellendi âœ“'); }
  else { DB.faturalar.push(r); toast('Fatura eklendi âœ“'); }
  await dbSave(DB); closeModal('modal-fatura'); clearFaturaForm();
  await updateSidebar(); await refreshCurrentPage();
}

function editFaturaForm(id){
  const r=(DB.faturalar||[]).find(x=>x.id===id); if(!r) return;
  document.getElementById('ff-id').value=r.id;
  document.getElementById('ff-no').value=r.no||'';
  document.getElementById('ff-tur').value=r.tur||'gelir';
  document.getElementById('ff-tarih').value=r.tarih||'';
  document.getElementById('ff-vade').value=r.vade||'';
  document.getElementById('ff-musteri').value=r.musteri||'';
  document.getElementById('ff-aciklama').value=r.aciklama||'';
  document.getElementById('ff-tutar').value=r.tutar||'';
  document.getElementById('ff-kdv-oran').value=r.kdvOran||0;
  document.getElementById('ff-kdv-tutar').value=r.kdv||'';
  document.getElementById('ff-toplam').value=r.toplam||'';
  document.getElementById('ff-odenen').value=r.odened||'';
  document.getElementById('ff-kalan').value=r.kalan||'';
  document.getElementById('ff-durum').value=r.durum||'bekliyor';
  const fk=document.getElementById('ff-kesim-durum'); if(fk) fk.value=r.kesimDurum||'kesilmedi';
  const fp=document.getElementById('ff-para'); if(fp) fp.value=r.para||'EUR';
  document.getElementById('ff-rezervasyon').value=r.rezervasyon||'';
  document.getElementById('ff-not').value=r.not||'';
  openModal('modal-fatura','Fatura DÃ¼zenle');
}

const DURUM_LABEL = {bekliyor:'â³ Bekliyor',kismi:'ğŸ”¶ KÄ±smi',odendi:'âœ… Ã–dendi',gecikti:'ğŸ”´ Gecikti',iptal:'âŒ Ä°ptal'};

async function renderFatura(){
  DB=await dbLoad(activeYil);
  const data=(DB.faturalar||[]).filter(r=>r.tarih&&r.tarih.startsWith(String(activeYil))).sort((a,b)=>b.ts-a.ts);
  const gelir=data.filter(r=>r.tur==='gelir');
  const gider=data.filter(r=>r.tur==='gider');
  const bekleyen=data.filter(r=>r.durum==='bekliyor'||r.durum==='kismi'||r.durum==='gecikti');
  const gelirT=gelir.reduce((a,r)=>a+r.toplam,0);
  const giderT=gider.reduce((a,r)=>a+r.toplam,0);
  const bekleyenT=bekleyen.filter(r=>r.tur==='gelir').reduce((a,r)=>a+r.kalan,0);

  // Fatura sayfasÄ± uyarÄ± paneli
  renderFaturaUyarilariSayfa();

  document.getElementById('fatura-kpis').innerHTML=`
    <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
      <span class="kpi-icon">ğŸ“¥</span>
      <div class="kpi-lbl">Gelir FaturalarÄ±</div><div class="kpi-val">${money(gelirT)}</div><div class="kpi-sub">${gelir.length} fatura</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#b83030,#f87171);--kc:var(--red2)">
      <span class="kpi-icon">ğŸ“¤</span>
      <div class="kpi-lbl">Gider FaturalarÄ±</div><div class="kpi-val">${money(giderT)}</div><div class="kpi-sub">${gider.length} fatura</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#156b3a,#22c55e);--kc:var(--green2)">
      <span class="kpi-icon">ğŸ’°</span>
      <div class="kpi-lbl">Net Fatura Dengesi</div><div class="kpi-val" style="color:${gelirT-giderT>=0?'var(--green2)':'var(--red2)'}">${money(gelirT-giderT)}</div><div class="kpi-sub">Gelir âˆ’ Gider</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
      <span class="kpi-icon">â³</span>
      <div class="kpi-lbl">Tahsil Bekleyen</div><div class="kpi-val">${money(bekleyenT)}</div><div class="kpi-sub">${bekleyen.length} fatura</div></div>`;

  // Filter buttons
  const q=(document.getElementById('fatura-search')?.value||'').toLowerCase();
  let filtered=[...data];
  if(q) filtered=filtered.filter(r=>(r.no+r.musteri+r.aciklama).toLowerCase().includes(q));

  const tbody=document.getElementById('fatura-tbody');
  const empty=document.getElementById('fatura-empty');
  if(!filtered.length){ tbody.innerHTML=''; empty.style.display=''; return; }
  empty.style.display='none';

  const today2=today();
  const PARA_SIMGE = {EUR:'â‚¬',USD:'$',TRY:'â‚º'};
  tbody.innerHTML=filtered.map((r,i)=>{
    const isGecikti = r.durum==='bekliyor' && r.vade && r.vade < today2;
    const durumClass = isGecikti?'gecikti':(r.durum||'bekliyor');
    const durumLabel = isGecikti?'ğŸ”´ Gecikti':DURUM_LABEL[r.durum]||r.durum;
    const paraSimge = PARA_SIMGE[r.para||'EUR']||'â‚¬';
    const faturaKesim = (r.kesimDurum==='kesildi')
      ? '<span style="color:var(--green2);font-size:10px;font-weight:600">âœ… Kesildi</span>'
      : '<span style="color:var(--red2);font-size:10px">âŒ Kesilmedi</span>';
    return `<tr>
      <td style="color:var(--ink3)">${i+1}</td>
      <td class="fw" style="color:var(--teal2)">${r.no||'â€”'}</td>
      <td>${fmtDate(r.tarih)}</td>
      <td style="${r.vade&&r.vade<today2&&r.durum!=='odendi'?'color:var(--red2);font-weight:600':''}">${fmtDate(r.vade)||'â€”'}</td>
      <td><span class="badge ${r.tur==='gelir'?'b-simay':'b-gider'}">${r.tur==='gelir'?'ğŸ“¥ GELÄ°R':'ğŸ“¤ GÄ°DER'}</span></td>
      <td class="fw">${r.musteri||'â€”'}</td>
      <td style="color:var(--ink2);max-width:130px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${r.aciklama||'â€”'}</td>
      <td class="mono">${paraSimge}${Number(r.tutar||0).toLocaleString('tr-TR')}</td>
      <td style="font-size:10px;font-weight:600;color:var(--gold2)">${paraSimge}</td>
      <td class="mono" style="color:var(--gold2)">${r.kdv?paraSimge+Number(r.kdv).toLocaleString('tr-TR'):'â€”'}</td>
      <td class="mono fw">${paraSimge}${Number(r.toplam||0).toLocaleString('tr-TR')}</td>
      <td><span class="badge f-${durumClass}">${durumLabel}</span></td>
      <td>${faturaKesim}</td>
      <td class="td-actions">
        <button class="btn btn-ghost btn-xs" onclick="event.stopPropagation();editFaturaForm('${r.id}')">DÃ¼zenle</button>
        <button class="btn btn-danger btn-xs" onclick="event.stopPropagation();deleteRecord('faturalar','${r.id}')">Sil</button>
      </td>
    </tr>`;
  }).join('');
}

function exportFaturaCSV(){
  const data=(DB.faturalar||[]).filter(r=>r.tarih&&r.tarih.startsWith(String(activeYil)));
  let csv='\uFEFFNumara,Fatura No,Tur,Tarih,Vade,Musteri,Aciklama,Tutar(EUR),KDV(EUR),Toplam(EUR),Odenen(EUR),Kalan(EUR),Durum\r\n';
  data.forEach(r=>{
    csv+=`"${r.no}","${r.tur==='gelir'?'Gelir':'Gider'}","${fmtDate(r.tarih)}","${fmtDate(r.vade)||''}","${r.musteri}","${r.aciklama||''}",${r.tutar},${r.kdv||0},${r.toplam},${r.odenen||0},${r.kalan||0},"${r.durum}"\r\n`;
  });
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download=`Simay_Faturalar_${activeYil}.csv`;a.click();
  toast('Fatura raporu indirildi âœ“');
}



// Acenta: giriÅŸ tarihi seÃ§ilince bitiÅŸ tarihini aynÄ± ayÄ±n ilk gÃ¼nÃ¼ne at + min ayarla
function onAcentaGirisChange(val){
  if(!val) return;
  const cEl = document.getElementById('fa-cikis');
  cEl.min = val;
  // BitiÅŸ tarihini aynÄ± aya yÃ¶nlendir: ay bitimine set et
  const d = new Date(val);
  const yil = d.getFullYear();
  const ay = d.getMonth(); // 0-indexed
  const sonGun = new Date(yil, ay+1, 0).getDate();
  const ayStr = String(ay+1).padStart(2,'0');
  // ay sonu deÄŸil, giriÅŸ tarihini default olarak ata (kullanÄ±cÄ± kendisi seÃ§er)
  // Sadece min=giris, ve ay=giris ayÄ±na odaklan
  if(!cEl.value || cEl.value < val){
    // Set to last day of same month as a default suggestion
    cEl.value = `${yil}-${ayStr}-${String(sonGun).padStart(2,'0')}`;
  }
  setTimeout(()=>cEl.focus(), 50);
}

// Acenta para birimi deÄŸiÅŸince prefix gÃ¼ncelleÅŸir
function onAcentaParaDegis(){
  const para = document.getElementById('fa-para')?.value || 'EUR';
  const simge = para==='EUR'?'â‚¬':para==='USD'?'$':'â‚º';
  ['fa-bedel-prefix','fa-on-prefix','fa-kalan-prefix','fa-todeme-prefix','fa-ton-prefix','fa-tkalan-prefix','fa-kar-prefix'].forEach(id=>{
    const el=document.getElementById(id); if(el) el.textContent=simge;
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TÃœM SATIÅLAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderTumSatislar(){
  DB = await dbLoad();
  const q = (document.getElementById('tum-search')?.value||'').toLowerCase();

  // Simay satÄ±ÅŸlarÄ± - bedelEur kullan (USD/TRY Ã§evrilmiÅŸ)
  const simaylar = DB.simay
    .filter(r => r.giris && r.giris.startsWith(String(activeYil)))
    .map(r => ({
      ...r,
      _tip: 'simay',
      _gelirEur: r.para && r.para !== 'EUR' ? (r.bedelEur || r.bedel) : (r.bedelEur || r.bedel),
      _orijinal: r.para && r.para !== 'EUR'
        ? (r.para === 'USD' ? `$ ${(r.bedel||0).toLocaleString('tr-TR',{minimumFractionDigits:2})}` : `â‚º ${(r.bedel||0).toLocaleString('tr-TR',{minimumFractionDigits:2})}`)
        : null,
    }));

  // Acenta satÄ±ÅŸlarÄ± - para birimi EUR kabul et (bedel zaten EUR)
  const acentalar = DB.acente
    .filter(r => r.giris && r.giris.startsWith(String(activeYil)))
    .map(r => ({
      ...r,
      _tip: 'acenta',
      _gelirEur: r.kar || 0,
      _orijinal: null,
    }));

  let tumData = [...simaylar, ...acentalar].sort((a,b) => (b.giris||'').localeCompare(a.giris||''));
  if(q) tumData = tumData.filter(r => (r.misafir+r.tekne+(r.sorumlu||'')).toLowerCase().includes(q));

  const toplamSimay = simaylar.reduce((a,r) => a + r._gelirEur, 0);
  const toplamAcenta = acentalar.reduce((a,r) => a + r._gelirEur, 0);
  const toplam = toplamSimay + toplamAcenta;

  document.getElementById('tum-kpis').innerHTML = `
    <div class="kpi" style="--ka:linear-gradient(90deg,#0b7a6e,#18b4a2);--kc:var(--teal2)">
      <span class="kpi-icon">â›µ</span>
      <div class="kpi-lbl">Simay Cirosu (â‚¬)</div><div class="kpi-val">${money(toplamSimay)}</div><div class="kpi-sub">${simaylar.length} satÄ±ÅŸ</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#be8a20,#e8b84b);--kc:var(--gold2)">
      <span class="kpi-icon">ğŸ¤</span>
      <div class="kpi-lbl">Acenta KÃ¢rÄ± (â‚¬)</div><div class="kpi-val">${money(toplamAcenta)}</div><div class="kpi-sub">${acentalar.length} satÄ±ÅŸ</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#156b3a,#22c55e);--kc:var(--green2)">
      <span class="kpi-icon">ğŸ’°</span>
      <div class="kpi-lbl">Toplam (â‚¬)</div><div class="kpi-val">${money(toplam)}</div><div class="kpi-sub">${tumData.length} toplam kayÄ±t</div></div>
    <div class="kpi" style="--ka:linear-gradient(90deg,#1a4a7a,#60a5fa);--kc:var(--blue2)">
      <span class="kpi-icon">ğŸ“Š</span>
      <div class="kpi-lbl">Ort. SatÄ±ÅŸ (â‚¬)</div><div class="kpi-val">${tumData.length?money(toplam/tumData.length):'â‚¬0'}</div><div class="kpi-sub">KayÄ±t baÅŸÄ±na</div></div>`;

  const tbody = document.getElementById('tum-tbody');
  const empty = document.getElementById('tum-empty');
  if(!tumData.length){ tbody.innerHTML=''; empty.style.display=''; return; }
  empty.style.display = 'none';

  tbody.innerHTML = tumData.map((r,i) => {
    const gun = daysBetween(r.giris, r.cikis);
    const isSimay = r._tip === 'simay';
    return `<tr class="clickable" onclick="${isSimay ? `showSimayDetail('${r.id}')` : `showAcenteDetail('${r.id}')`}">
      <td style="color:var(--ink3)">${i+1}</td>
      <td><span class="badge" style="${isSimay?'background:rgba(11,122,110,.15);color:var(--teal2);border:1px solid rgba(11,122,110,.25)':'background:rgba(190,138,32,.15);color:var(--gold2);border:1px solid rgba(190,138,32,.25)'}">${isSimay?'â›µ Simay':'ğŸ¤ Acenta'}</span></td>
      <td class="fw">${r.misafir}</td>
      <td>${r.tekne||'â€”'}</td>
      <td style="color:var(--ink2)">${r.gliman||'â€”'}</td>
      <td style="color:var(--ink2)">${r.climan||'â€”'}</td>
      <td>${fmtDate(r.giris)}${r.cikis?' â†’ '+fmtDate(r.cikis):''}</td>
      <td style="color:var(--ink3)">${gun>0?gun+' gece':'â€”'}</td>
      <td style="color:var(--ink2)">${r.sorumlu||'â€”'}</td>
      <td class="mono fw" style="color:var(--teal2)">${money(r._gelirEur)}</td>
      <td style="font-size:10px;color:var(--ink3)">${r._orijinal||'â€”'}</td>
    </tr>`;
  }).join('');
}

function exportTumSatislarCSV(){
  const simaylar = DB.simay.filter(r=>r.giris&&r.giris.startsWith(String(activeYil)));
  const acentalar = DB.acente.filter(r=>r.giris&&r.giris.startsWith(String(activeYil)));
  let csv = 'ï»¿TÃ¼r,Misafir,Tekne,GiriÅŸ LimanÄ±,Ã‡Ä±kÄ±ÅŸ LimanÄ±,Tur BaÅŸlangÄ±Ã§,Tur BitiÅŸ,SÃ¼re,Sorumlu,Tutar EUR,Para Birimi,Orijinal Tutar\r\n';
  simaylar.forEach(r=>{
    const gelirEur = r.para&&r.para!=='EUR'?(r.bedelEur||r.bedel):r.bedel;
    csv+=`"Simay","${r.misafir}","${r.tekne}","${r.gliman||''}","${r.climan||''}","${fmtDate(r.giris)}","${fmtDate(r.cikis)||''}",${daysBetween(r.giris,r.cikis)},"${r.sorumlu||''}",${gelirEur},"${r.para||'EUR'}",${r.bedel}
`;
  });
  acentalar.forEach(r=>{
    csv+=`"Acenta","${r.misafir}","${r.tekne}","${r.gliman||''}","${r.climan||''}","${fmtDate(r.giris)}","${fmtDate(r.cikis)||''}",${daysBetween(r.giris,r.cikis)},"${r.sorumlu||''}",${r.kar||0},"EUR",${r.kar||0}
`;
  });
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download=`Simay_TumSatislar_${activeYil}.csv`;a.click();
  toast('TÃ¼m satÄ±ÅŸlar indirildi âœ“');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WINDOW EXPORTS (module scope fix)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.openModal = openModal;
window.closeModal = closeModal;
window.saveSimay = saveSimay;
window.applyTitleCase = applyTitleCase;
window.fetchUsdEurRate = fetchUsdEurRate;
window.onSimayParaDegis = onSimayParaDegis;
window.saveAcente = saveAcente;
window.saveGider = saveGider;
window.deleteRecord = deleteRecord;
window.editSimayForm = editSimayForm;
window.editAcenteForm = editAcenteForm;
window.calcSimayGun = calcSimayGun;
window.calcSimayKdv = calcSimayKdv;
window.calcSimayKalan = calcSimayKalan;
window.calcAcenteAll = calcAcenteAll;
window.calcAcenteKar = calcAcenteAll;
window.setFilter = setFilter;
window.exportCSV = exportCSV;
window.saveSettings = saveSettings;
window.resetData = resetData;
window.renderRezervasyonPage = renderRezervasyonPage;
window.renderSimayTable = renderSimayTable;
window.renderAcenteTable = renderAcenteTable;
window.doLogin = doLogin;
window.showSimayDetail = showSimayDetail;
window.showAcenteDetail = showAcenteDetail;
window.doLogout = doLogout;
window.switchYear = switchYear;
window.onMisafirInput = onMisafirInput;
window.addSorumlu = addSorumlu;
window.removeSorumlu = removeSorumlu;
window.toggleTheme = toggleTheme;
window.toggleGiderPara = toggleGiderPara;
window.calcGiderEur = calcGiderEur;
window.fetchKur = fetchKur;
window.saveFatura = saveFatura;
window.openGiderModal = openGiderModal;
window.editGiderForm = editGiderForm;
window.renderTumSatislar = renderTumSatislar;
window.exportTumSatislarCSV = exportTumSatislarCSV;
window.onAcentaGirisChange = onAcentaGirisChange;
window.onAcentaParaDegis = onAcentaParaDegis;
window.editFaturaForm = editFaturaForm;
window.calcFaturaKdv = calcFaturaKdv;
window.calcFaturaKalan = calcFaturaKalan;
window.exportFaturaCSV = exportFaturaCSV;
window.addBanka = addBanka;
window.removeBanka = removeBanka;

document.addEventListener('DOMContentLoaded', ()=>{
  // Uygulama baÅŸlangÄ±Ã§ta gizli â€” onAuthStateChanged yÃ¶netir
  document.getElementById('app').style.display = 'none';

  // Login buton listener (module scope gÃ¼venliÄŸi iÃ§in)
  const loginBtn = document.getElementById('login-btn');
  if(loginBtn) loginBtn.addEventListener('click', doLogin);

  // Ã‡Ä±kÄ±ÅŸ butonu
  const logoutBtn = document.querySelector('.logout-btn');
  if(logoutBtn) logoutBtn.addEventListener('click', doLogout);
});
</script>
</body>
</html>
